(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72168,e=>{"use strict";var t=e.i(43476),s=e.i(77572),a=e.i(71645),r=e.i(19455),i=e.i(24687),l=e.i(10204),n=e.i(87486),o=e.i(93479),d=e.i(29592),c=e.i(68148),m=e.i(31278),u=e.i(53339),g=e.i(63209),h=e.i(95468),x=e.i(16715),p=e.i(69074),f=e.i(55436),j=e.i(40160),v=e.i(56909),N=e.i(43531),b=e.i(3116),y=e.i(75157),w=e.i(46696),k=e.i(38162),C=e.i(11795);let S="natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion";function U({aiModels:e}){let[s,U]=(0,a.useState)([]),[I,T]=(0,a.useState)(0),[D,$]=(0,a.useState)(!1),[B,_]=(0,a.useState)(""),[P,z]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1),M=(0,a.useRef)(null),[F,R]=(0,a.useState)(null),[O,E]=(0,a.useState)(null),[V,G]=(0,a.useState)(""),[K,W]=(0,a.useState)(S),[J,Z]=(0,a.useState)(5),[X,q]=(0,a.useState)("idle"),[H,Y]=(0,a.useState)(null),[Q,ee]=(0,a.useState)(0),[et,es]=(0,a.useState)(null),[ea,er]=(0,a.useState)(null),[ei,el]=(0,a.useState)(!1),en=(0,a.useRef)(!1),eo=e.find(e=>e.id===V)||null,ed=eo?.reference_images||[],ec=ed.length>0,em=(0,a.useCallback)(async e=>{$(!0);let t=e?s.length:0,a=await (0,k.getAssetsAction)({file_type:"image",search:B||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:t});e?U(e=>[...e,...a.assets]):U(a.assets),T(a.total),$(!1)},[B,s.length]);(0,a.useEffect)(()=>{em(!1)},[]);let eu=async e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith("image/"))return void w.toast.error("Please select an image file");if(t.size>0x3200000)return void w.toast.error("File exceeds 50MB size limit");L(!0);try{let e=(0,C.createClient)(),{data:{user:s}}=await e.auth.getUser();if(!s)return void w.toast.error("Not authenticated");let a=crypto.randomUUID(),r=t.name.replace(/[^a-zA-Z0-9._-]/g,"_"),i=`${s.id}/image/${a}_${r}`,{error:l}=await e.storage.from("assets").upload(i,t,{contentType:t.type,upsert:!1});if(l)return void w.toast.error(`Upload failed: ${l.message}`);let{data:n,error:o}=await e.from("assets").insert({user_id:s.id,filename:t.name,file_path:i,file_type:"image",mime_type:t.type,file_size:t.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(o){await e.storage.from("assets").remove([i]),w.toast.error(`Database error: ${o.message}`);return}let{data:d}=await e.storage.from("assets").createSignedUrl(i,3600);d?.signedUrl&&(R(n.id),E(d.signedUrl),w.toast.success("Image uploaded!"),em(!1))}catch{w.toast.error("Failed to upload image")}finally{L(!1),M.current&&(M.current.value="")}}};(0,a.useEffect)(()=>()=>{en.current=!1},[]);let eg=(0,a.useCallback)(async e=>{en.current=!0;let t=0,s=0;for(;en.current&&t<200;){ee(++t);try{let t=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(e)}`),a=await t.json();if("completed"===a.status&&a.videoUrl){en.current=!1,es(a.videoUrl),q("completed"),w.toast.success("Dancing reel generated!");return}if("failed"===a.status){en.current=!1,q("failed"),Y(a.error||"Video generation failed");return}s=0,await new Promise(e=>setTimeout(e,5e3))}catch{if(++s>=3){en.current=!1,q("failed"),Y("Network error after multiple retries");return}await new Promise(e=>setTimeout(e,5e3))}}en.current&&(en.current=!1,q("failed"),Y(`Timed out after ${t} polls (~${Math.round(5e3*t/1e3)}s)`))},[]),eh=async()=>{if(!O)return void w.toast.error("Select an image first");if(!K.trim())return void w.toast.error("Enter a prompt");q("submitting"),Y(null),ee(0),es(null),er(null);try{let e=await fetch("/api/dancing-reel/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:O,prompt:K.trim(),duration:J})}),t=await e.json();if(!e.ok){q("failed"),Y(t.error||"Failed to submit dancing reel generation");return}q("polling"),w.toast.info("Dancing reel generation started..."),eg(t.taskId)}catch{q("failed"),Y("Failed to submit dancing reel generation")}},ex=async()=>{if(et){el(!0);try{let e=await fetch("/api/dancing-reel/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:et})}),t=await e.json();e.ok?(er(t.assetId),w.toast.success("Video saved to library!")):w.toast.error(t.error||"Failed to save")}catch{w.toast.error("Failed to save video")}finally{el(!1)}}},ep=()=>{q("idle"),Y(null),ee(0),es(null),er(null),en.current=!1},ef=!P&&ec?ed:s,ej="submitting"===X||"polling"===X,ev=Math.min(Q/200*100,95),eN=5===J?.35:.7;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"1"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:"Select Image"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Choose a portrait image (ideally 9:16 aspect ratio) to animate into a dancing video."})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[e.length>0&&(0,t.jsxs)("select",{value:V,onChange:e=>{G(e.target.value),z(!e.target.value)},className:"h-9 rounded-md border border-input bg-background px-3 text-sm",children:[(0,t.jsx)("option",{value:"",children:"All Images"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.reference_images.length,")"]},e.id))]}),(0,t.jsxs)("div",{className:"ml-auto",children:[(0,t.jsx)("input",{ref:M,type:"file",accept:"image/*",onChange:eu,className:"hidden"}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>M.current?.click(),disabled:A||ej,children:[A?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 mr-1.5 animate-spin"}):(0,t.jsx)(p.Upload,{className:"h-4 w-4 mr-1.5"}),A?"Uploading...":"Upload Image"]})]})]}),(P||!ec)&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(f.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(o.Input,{placeholder:"Search images...",value:B,onChange:e=>{let t;return _(e.target.value),t=setTimeout(()=>em(!1),300),()=>clearTimeout(t)},className:"pl-9"})]}),0!==ef.length||D?(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2",children:ef.map(e=>{let s=F===e.id;return(0,t.jsxs)("button",{type:"button",disabled:ej,className:(0,y.cn)("relative aspect-[9/16] overflow-hidden rounded-md border-2 transition-all",s?"border-accent-blue ring-2 ring-accent-blue/20":"border-transparent hover:border-muted-foreground/30",ej&&"opacity-50 pointer-events-none"),onClick:()=>{var t,s;return t=e.id,s=e.signed_url,void(R(t),E(s))},children:[(0,t.jsx)("img",{src:e.signed_url,alt:e.filename,className:"h-full w-full object-cover",loading:"lazy"}),s&&(0,t.jsx)("div",{className:"absolute inset-0 bg-accent-blue/20 flex items-center justify-center",children:(0,t.jsx)("div",{className:"h-6 w-6 rounded-full bg-accent-blue flex items-center justify-center",children:(0,t.jsx)(N.Check,{className:"h-4 w-4 text-primary-foreground"})})})]},e.id)})}):(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-8",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["No images found. Upload an image above or add images in the"," ",(0,t.jsx)("a",{href:"/dashboard/assets",className:"underline font-medium",children:"Asset Library"}),"."]})}),(P||!ec)&&s.length<I&&(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>em(!0),disabled:D,children:D?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})}),F&&(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(n.Badge,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(N.Check,{className:"h-3 w-3"}),"Image selected"]})})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"2"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:"Prompt & Settings"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Customize the dance prompt and choose video duration. The default prompt works well for most cases."})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{children:"Dance Prompt"}),(0,t.jsx)(i.Textarea,{value:K,onChange:e=>W(e.target.value),placeholder:"Describe the dancing motion...",rows:4,className:"resize-y text-sm",disabled:ej}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[K.trim().split(/\s+/).filter(Boolean).length," words"]}),K!==S&&(0,t.jsx)("button",{type:"button",onClick:()=>W(S),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",disabled:ej,children:"Reset to default"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{children:"Duration"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:5===J?"default":"outline",size:"sm",onClick:()=>Z(5),disabled:ej,className:"flex-1",children:[(0,t.jsx)(b.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"5 seconds (~$0.35)"]}),(0,t.jsxs)(r.Button,{variant:10===J?"default":"outline",size:"sm",onClick:()=>Z(10),disabled:ej,className:"flex-1",children:[(0,t.jsx)(b.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"10 seconds (~$0.70)"]})]})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"3"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:"Generate"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Generate the dancing reel video. This typically takes 2-5 minutes."})]})]}),ej&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin text-accent-blue"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["submitting"===X&&"Submitting to Kling 2.6 Pro...","polling"===X&&"Generating dancing video..."]}),"polling"===X&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:[Math.round(5*Q),"s elapsed"]})]}),(0,t.jsx)(c.Progress,{value:ev,className:"h-2"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["polling"===X&&Q<20&&"Processing your video. This usually takes 2-5 minutes...","polling"===X&&Q>=20&&Q<60&&"Still processing. Kling 2.6 Pro generates high-quality output...","polling"===X&&Q>=60&&"Almost there. Please wait..."]})]}),"completed"===X&&et&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Dancing reel generated!"})]}),(0,t.jsx)("video",{controls:!0,src:et,className:"w-full max-h-[400px] rounded-md bg-black",preload:"metadata"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{let e=document.createElement("a");e.href=et,e.download=`dancing-reel-${J}s.mp4`,e.target="_blank",e.click()},children:[(0,t.jsx)(j.Download,{className:"h-3.5 w-3.5 mr-1"}),"Download"]}),ea?(0,t.jsxs)(n.Badge,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-3 w-3"}),"Saved"]}):(0,t.jsxs)(r.Button,{size:"sm",onClick:ex,disabled:ei,children:[ei?(0,t.jsx)(m.Loader2,{className:"h-3.5 w-3.5 mr-1 animate-spin"}):(0,t.jsx)(v.Save,{className:"h-3.5 w-3.5 mr-1"}),ei?"Saving...":"Save to Library"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:ep,children:[(0,t.jsx)(x.RefreshCw,{className:"h-3.5 w-3.5 mr-1"}),"New Video"]})]})]}),H&&(0,t.jsxs)(d.Alert,{variant:"destructive",children:[(0,t.jsx)(g.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(d.AlertDescription,{children:H})]}),"idle"===X&&(0,t.jsxs)(r.Button,{onClick:eh,className:"w-full",size:"lg",disabled:!F||!K.trim(),children:[(0,t.jsx)(u.Music,{className:"h-4 w-4 mr-2"}),"Generate Dancing Reel (",J,"s) — Est. $",eN.toFixed(2)]}),"failed"===X&&(0,t.jsxs)(r.Button,{onClick:ep,variant:"outline",className:"w-full",children:[(0,t.jsx)(x.RefreshCw,{className:"h-4 w-4 mr-2"}),"Try Again"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Powered by WaveSpeed Kling 2.6 Pro Image-to-Video. Sound is disabled (add music in post)."})]})]})}var I=e.i(76639),T=e.i(7233),D=e.i(27612),$=e.i(35501),B=e.i(37727),_=e.i(52571);let P="natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion";function z({step:e,title:s,description:a,children:r}){return(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:e}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:s}),(0,t.jsx)(_.Info,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:a})]})]}),r]})}function A({aiModels:e}){let[s,d]=(0,a.useState)(P),[x,N]=(0,a.useState)(5),[S,U]=(0,a.useState)([{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}]),[_,A]=(0,a.useState)(!1),M=(0,a.useRef)(new Map),[F,R]=(0,a.useState)(null),[O,E]=(0,a.useState)([]),[V,G]=(0,a.useState)(0),[K,W]=(0,a.useState)(!1),[J,Z]=(0,a.useState)(""),[X,q]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(null),Q=(0,a.useRef)(null),[ee,et]=(0,a.useState)([]),[es,ea]=(0,a.useState)(!1),[er,ei]=(0,a.useState)(!1),el=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{M.current.forEach((e,t)=>M.current.set(t,!1))},[]);let en=(e,t)=>{U(s=>s.map(s=>s.id===e?{...s,...t}:s))},eo=(0,a.useCallback)(async e=>{W(!0);let t=e?O.length:0,s=await (0,k.getAssetsAction)({file_type:"image",search:J||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:t});e?E(e=>[...e,...s.assets]):E(s.assets),G(s.total),W(!1)},[J,O.length]);(0,a.useEffect)(()=>{F&&(Z(""),eo(!1))},[F]);let ed=async(e,t)=>{if(!e||!e.type.startsWith("image/"))return null;if(e.size>0x3200000)return w.toast.error("File exceeds 50MB size limit"),null;q(!0);try{let s=(0,C.createClient)(),{data:{user:a}}=await s.auth.getUser();if(!a)return w.toast.error("Not authenticated"),null;let r=crypto.randomUUID(),i=e.name.replace(/[^a-zA-Z0-9._-]/g,"_"),l=`${a.id}/image/${r}_${i}`,{error:n}=await s.storage.from("assets").upload(l,e,{contentType:e.type,upsert:!1});if(n)return w.toast.error(`Upload failed: ${n.message}`),null;let{data:o,error:d}=await s.from("assets").insert({user_id:a.id,filename:e.name,file_path:l,file_type:"image",mime_type:e.type,file_size:e.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(d)return await s.storage.from("assets").remove([l]),w.toast.error(`Database error: ${d.message}`),null;let{data:c}=await s.storage.from("assets").createSignedUrl(l,3600),m={id:o.id,url:c?.signedUrl||""},u=t||F;return u&&(en(u,{imageId:m.id,imageUrl:m.url}),t||R(null)),m}catch{return w.toast.error("Failed to upload image"),null}finally{q(!1),Q.current&&(Q.current.value="")}},ec=async e=>{let t=e.target.files?.[0];t&&await ed(t)},em=()=>{Y(null)},eu=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),Y(null),_)return;let s=e.dataTransfer.files;if(!s||0===s.length)return;let a=s[0];a.type.startsWith("image/")?await ed(a,t):w.toast.error("Only image files are supported")},eg=async e=>{ea(!0);let t=(0,C.createClient)(),{data:{user:s}}=await t.auth.getUser();if(!s){w.toast.error("Not authenticated"),ea(!1);return}let a=[];for(let t=0;t<e.length;t++){let s=e[t];if(s.type.startsWith("image/")){if(s.size>0x3200000){w.toast.error(`File "${s.name}" exceeds 50MB limit`);continue}a.push(s)}}if(0===a.length)return void ea(!1);let r=[],i=0;for(let e=0;e<a.length;e+=3){let l=a.slice(e,e+3);for(let e of(await Promise.all(l.map(async e=>{try{let a=crypto.randomUUID(),r=e.name.replace(/[^a-zA-Z0-9._-]/g,"_"),i=`${s.id}/image/${a}_${r}`,{error:l}=await t.storage.from("assets").upload(i,e,{contentType:e.type,upsert:!1});if(l)return null;let{data:n,error:o}=await t.from("assets").insert({user_id:s.id,filename:e.name,file_path:i,file_type:"image",mime_type:e.type,file_size:e.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(o)return await t.storage.from("assets").remove([i]),null;let{data:d}=await t.storage.from("assets").createSignedUrl(i,3600);if(!d?.signedUrl)return null;return{id:n.id,url:d.signedUrl}}catch{return null}}))))e?r.push(e):i++}r.length>0?(et(e=>[...e,...r]),w.toast.success(`${r.length} image${1===r.length?"":"s"} uploaded to pool`),i>0&&w.toast.error(`${i} image${1===i?"":"s"} failed to upload`)):w.toast.error("Failed to upload images"),ea(!1)},eh=async e=>{let t=e.target.files;t&&t.length>0&&await eg(t),el.current&&(el.current.value="")},ex=async e=>{if(e.preventDefault(),e.stopPropagation(),ei(!1),_)return;let t=e.dataTransfer.files;if(!t||0===t.length)return;let s=Array.from(t).filter(e=>e.type.startsWith("image/"));0===s.length?w.toast.error("Only image files are supported"):await eg(s)},ep=(0,a.useCallback)(async(e,t)=>{M.current.set(e,!0);let s=0,a=0;for(;M.current.get(e)&&s<200;){en(e,{pollCount:++s});try{let s=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(t)}`),r=await s.json();if("completed"===r.status&&r.videoUrl){M.current.set(e,!1),en(e,{status:"completed",videoUrl:r.videoUrl});return}if("failed"===r.status){M.current.set(e,!1),en(e,{status:"failed",error:r.error||"Video generation failed"});return}a=0,await new Promise(e=>setTimeout(e,5e3))}catch(t){if(a++,console.warn(`Poll error for dancing job ${e} (attempt ${s}):`,t),a>=3){M.current.set(e,!1),en(e,{status:"failed",error:"Network error after multiple retries"});return}await new Promise(e=>setTimeout(e,5e3))}}M.current.get(e)&&(M.current.set(e,!1),en(e,{status:"failed",error:`Timed out after ${s} polls (~${Math.round(5e3*s/1e3)}s)`}))},[]),ef=(0,a.useCallback)(async e=>{en(e.id,{status:"submitting"});try{let t=await fetch("/api/dancing-reel/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl,prompt:s.trim(),duration:x})}),a=await t.json();if(!t.ok)return void en(e.id,{status:"failed",error:a.error||"Submit failed"});en(e.id,{status:"polling",taskId:a.taskId,pollCount:0}),ep(e.id,a.taskId)}catch(t){en(e.id,{status:"failed",error:t instanceof Error?t.message:"Processing failed"})}},[s,x,ep]),ej=async()=>{if(!s.trim())return void w.toast.error("Enter a prompt first");let e=S.filter(e=>"pending"===e.status&&!e.imageId&&!e.imageUrl);if(e.length>0){if(ee.length<e.length)return void w.toast.error(`Not enough images. Need ${e.length} more, have ${ee.length} in pool. Add more images or remove jobs.`);(()=>{let e=S.filter(e=>"pending"===e.status&&!e.imageId&&!e.imageUrl);if(0===e.length||0===ee.length)return;let t=[...ee].sort(()=>Math.random()-.5),s=Math.min(e.length,t.length),a=[];for(let r=0;r<s;r++)a.push({id:e[r].id,imageId:t[r].id,imageUrl:t[r].url});return U(e=>e.map(e=>{let t=a.find(t=>t.id===e.id);return t?{...e,imageId:t.imageId,imageUrl:t.imageUrl}:e}))})(),await new Promise(e=>setTimeout(e,50))}let t=S.filter(e=>"pending"===e.status&&e.imageId&&e.imageUrl);if(0===t.length)return void w.toast.error("No valid jobs to process. Each needs an image.");for(let e of(A(!0),w.toast.info(`Starting ${t.length} dancing reel generation${t.length>1?"s":""}...`),t))ef(e)},ev=async(e,t)=>{try{let s=await fetch("/api/dancing-reel/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:t})}),a=await s.json();s.ok?(en(e,{videoAssetId:a.assetId}),w.toast.success("Video saved to library!")):w.toast.error(a.error||"Failed to save")}catch{w.toast.error("Failed to save video")}},eN=S.filter(e=>"completed"===e.status).length,eb=S.filter(e=>"failed"===e.status).length,ey=S.filter(e=>"submitting"===e.status||"polling"===e.status).length,ew=_&&0===ey,ek=S.filter(e=>"pending"===e.status&&!e.imageId&&!e.imageUrl).length,eC=!_&&s.trim()&&S.some(e=>e.imageId||ee.length>=ek);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(z,{step:1,title:"Prompt & Duration",description:"Set the dance prompt and video duration. These settings apply to all videos in this batch.",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{children:"Dance Prompt"}),(0,t.jsx)(i.Textarea,{value:s,onChange:e=>d(e.target.value),placeholder:"Describe the dancing motion...",rows:4,className:"resize-y text-sm",disabled:_}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[s.trim().split(/\s+/).filter(Boolean).length," words"]}),s!==P&&(0,t.jsx)("button",{type:"button",onClick:()=>d(P),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",disabled:_,children:"Reset to default"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{children:"Duration"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:5===x?"default":"outline",size:"sm",onClick:()=>N(5),disabled:_,className:"flex-1",children:[(0,t.jsx)(b.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"5 seconds (~$0.35/video)"]}),(0,t.jsxs)(r.Button,{variant:10===x?"default":"outline",size:"sm",onClick:()=>N(10),disabled:_,className:"flex-1",children:[(0,t.jsx)(b.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"10 seconds (~$0.70/video)"]})]})]})]})}),(0,t.jsx)(z,{step:2,title:"Upload Images",description:"Upload portrait images for your dancing reels. Images are randomly assigned to jobs that don't have a manually selected image.",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(l.Label,{className:"text-base",children:"Bulk Image Pool"}),ee.length>0&&(0,t.jsx)("button",{type:"button",onClick:()=>{et([])},className:"text-xs text-muted-foreground hover:text-destructive transition-colors",children:"Clear All"})]}),(0,t.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),_||ei(!0)},onDragLeave:()=>{ei(!1)},onDrop:ex,onClick:()=>!_&&!es&&el.current?.click(),className:(0,y.cn)("border-2 border-dashed rounded-lg p-4 transition-all cursor-pointer",er?"border-accent-blue bg-accent-blue/5":"hover:border-accent-blue/50",_?"opacity-50 pointer-events-none":""),children:[(0,t.jsx)("input",{ref:el,type:"file",accept:"image/*",multiple:!0,onChange:eh,className:"hidden"}),0===ee.length?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center gap-2 text-muted-foreground",children:es?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("p",{className:"text-sm",children:"Uploading images..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Upload,{className:"h-8 w-8"}),(0,t.jsx)("p",{className:"text-sm",children:"Drop images here or click to browse"})]})}):(0,t.jsxs)("div",{className:"space-y-2",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ee.length," image",1===ee.length?"":"s"," in pool (randomly assigned to videos without images)"]}),(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:ee.map(e=>(0,t.jsxs)("div",{className:"relative group flex-shrink-0",children:[(0,t.jsx)("img",{src:e.url,alt:"",className:"h-16 w-16 rounded-md object-cover border"}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void et(e=>e.filter(e=>e.id!==t))},className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(B.X,{className:"h-3 w-3"})})]},e.id))}),(0,t.jsxs)("div",{onClick:()=>el.current?.click(),className:"border border-dashed rounded-md px-3 py-1 text-xs text-muted-foreground hover:text-accent-blue cursor-pointer inline-flex items-center gap-1 w-fit",children:[(0,t.jsx)(T.Plus,{className:"h-3 w-3"})," Add more"]})]})]})]})}),(0,t.jsx)(z,{step:3,title:"Videos",description:"Each row becomes a separate dancing reel. Add more rows for more videos. You can manually assign images or let the pool handle it.",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(l.Label,{className:"text-base",children:["Videos (",S.length,")"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{U(e=>[...e,{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}])},disabled:_,children:[(0,t.jsx)(T.Plus,{className:"h-4 w-4 mr-1.5"}),"Add Video"]})]}),S.map((e,s)=>(0,t.jsxs)("div",{className:(0,y.cn)("rounded-lg border p-4 space-y-3","completed"===e.status&&"border-green-500 bg-green-500/5","failed"===e.status&&"border-destructive bg-destructive/5","pending"===e.status&&"border-border"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Video ",s+1]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(L,{status:e.status,pollCount:e.pollCount}),!_&&S.length>1&&(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void(!(S.length<=1)&&(M.current.set(t,!1),U(e=>e.filter(e=>e.id!==t))))},className:"h-7 w-7 p-0",children:(0,t.jsx)(D.Trash2,{className:"h-3.5 w-3.5"})})]})]}),"pending"===e.status&&(0,t.jsxs)("div",{className:"flex items-center gap-3",onDragOver:t=>{var s;return s=e.id,void(t.preventDefault(),t.stopPropagation(),!_&&Y(s))},onDragLeave:em,onDrop:t=>eu(t,e.id),children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{className:"text-xs",children:"Image"}),e.imageUrl?(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:e.imageUrl,alt:"Selected",className:(0,y.cn)("h-[80px] w-[45px] rounded-md object-cover border cursor-pointer",H===e.id?"ring-2 ring-accent-blue ring-offset-2":""),onClick:()=>!_&&R(e.id)}),!_&&(0,t.jsx)("button",{type:"button",onClick:()=>en(e.id,{imageId:null,imageUrl:null}),className:"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(B.X,{className:"h-3 w-3"})})]}):(0,t.jsxs)("button",{type:"button",onClick:()=>R(e.id),disabled:_,className:(0,y.cn)("h-[80px] w-[45px] rounded-md border-2 border-dashed flex flex-col items-center justify-center gap-1 text-muted-foreground transition-colors",H===e.id?"border-accent-blue bg-accent-blue/10":"hover:border-accent-blue/50 hover:text-accent-blue"),children:[(0,t.jsx)($.ImageIcon,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:H===e.id?"Drop":"Select"})]})]}),(0,t.jsx)("div",{className:"flex-1 text-sm text-muted-foreground",children:e.imageId?(0,t.jsxs)(n.Badge,{variant:"secondary",className:"gap-1 text-xs",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-3 w-3"}),"Image ready"]}):(0,t.jsx)("span",{className:"text-xs",children:"No image — will use pool"})})]}),"pending"!==e.status&&"completed"!==e.status&&"failed"!==e.status&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Loader2,{className:"h-3.5 w-3.5 animate-spin text-accent-blue"}),(0,t.jsxs)("span",{className:"text-xs",children:["submitting"===e.status&&"Submitting to Kling 2.6 Pro...","polling"===e.status&&`Generating video... ${Math.round(5*(e.pollCount||0))}s`]})]}),"polling"===e.status&&(0,t.jsx)(c.Progress,{value:Math.min((e.pollCount||0)/200*100,95),className:"h-1.5"})]}),"failed"===e.status&&e.error&&(0,t.jsx)("p",{className:"text-xs text-destructive",children:e.error}),"completed"===e.status&&e.videoUrl&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("video",{controls:!0,src:e.videoUrl,className:"w-full max-h-[200px] rounded-md bg-black",preload:"metadata"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{let t=document.createElement("a");t.href=e.videoUrl,t.download=`dancing-reel-${s+1}.mp4`,t.target="_blank",t.click()},children:[(0,t.jsx)(j.Download,{className:"h-3.5 w-3.5 mr-1"}),"Download"]}),e.videoAssetId?(0,t.jsxs)(n.Badge,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-3 w-3"}),"Saved"]}):(0,t.jsxs)(r.Button,{size:"sm",onClick:()=>ev(e.id,e.videoUrl),children:[(0,t.jsx)(v.Save,{className:"h-3.5 w-3.5 mr-1"}),"Save to Library"]})]})]})]},e.id))]})}),_&&(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[ey>0&&(0,t.jsxs)(n.Badge,{variant:"secondary",children:[(0,t.jsx)(m.Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),ey," processing"]}),eN>0&&(0,t.jsxs)(n.Badge,{variant:"secondary",className:"text-green-600",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-3 w-3 mr-1"}),eN," completed"]}),eb>0&&(0,t.jsxs)(n.Badge,{variant:"destructive",children:[(0,t.jsx)(g.AlertCircle,{className:"h-3 w-3 mr-1"}),eb," failed"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{onClick:ej,disabled:!eC,size:"lg",className:"flex-1",children:[(0,t.jsx)(u.Music,{className:"h-4 w-4 mr-2"}),_?ew?"All Done":`Processing ${ey} video${1!==ey?"s":""}...`:`Generate ${S.filter(e=>e.imageId||ee.length).length} Dancing Reel${S.length>1?"s":""} (${x}s each)`]}),ew&&(0,t.jsx)(r.Button,{variant:"outline",size:"lg",onClick:()=>{A(!1),U([{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}])},children:"Start New Batch"})]}),(0,t.jsx)(I.Dialog,{open:null!==F,onOpenChange:e=>!e&&R(null),children:(0,t.jsxs)(I.DialogContent,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[(0,t.jsx)(I.DialogHeader,{children:(0,t.jsx)(I.DialogTitle,{children:"Select Image"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(f.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(o.Input,{placeholder:"Search images...",value:J,onChange:e=>{let t;return Z(e.target.value),t=setTimeout(()=>eo(!1),300),()=>clearTimeout(t)},className:"pl-9"})]}),(0,t.jsx)("input",{ref:Q,type:"file",accept:"image/*",onChange:ec,className:"hidden"}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>Q.current?.click(),disabled:X,children:[X?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,t.jsx)(p.Upload,{className:"h-4 w-4 mr-1"}),"Upload"]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto min-h-0",children:[0!==O.length||K?(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-2 pb-2",children:O.map(e=>(0,t.jsx)("button",{type:"button",className:"relative aspect-[9/16] overflow-hidden rounded-md border-2 border-transparent hover:border-accent-blue/50 transition-all",onClick:()=>{F&&(en(F,{imageId:e.id,imageUrl:e.signed_url}),R(null))},children:(0,t.jsx)("img",{src:e.signed_url,alt:e.filename,className:"h-full w-full object-cover",loading:"lazy"})},e.id))}):(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No images found."})}),O.length<V&&(0,t.jsx)("div",{className:"flex justify-center py-2",children:(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>eo(!0),disabled:K,children:K?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})})]}),F&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click an image to select it for this video. Uploaded images are auto-saved to your asset library."})]})})]})}function L({status:e,pollCount:s}){switch(e){case"pending":return(0,t.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:"Pending"});case"submitting":return(0,t.jsxs)(n.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(m.Loader2,{className:"h-3 w-3 animate-spin"}),"Submitting"]});case"polling":return(0,t.jsxs)(n.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(m.Loader2,{className:"h-3 w-3 animate-spin"}),Math.round(5*(s||0)),"s"]});case"completed":return(0,t.jsxs)(n.Badge,{variant:"secondary",className:"text-xs gap-1 text-green-600",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-3 w-3"}),"Done"]});case"failed":return(0,t.jsxs)(n.Badge,{variant:"destructive",className:"text-xs gap-1",children:[(0,t.jsx)(g.AlertCircle,{className:"h-3 w-3"}),"Failed"]})}}var M=e.i(52008);function F({aiModels:e}){return(0,t.jsxs)(s.Tabs,{defaultValue:"single",className:"space-y-4",children:[(0,t.jsxs)(s.TabsList,{children:[(0,t.jsxs)(s.TabsTrigger,{value:"single",className:"gap-1.5",children:[(0,t.jsx)(u.Music,{className:"h-3.5 w-3.5"}),"Single Video"]}),(0,t.jsxs)(s.TabsTrigger,{value:"bulk",className:"gap-1.5",children:[(0,t.jsx)(M.Layers,{className:"h-3.5 w-3.5"}),"Bulk Generate"]})]}),(0,t.jsx)(s.TabsContent,{value:"single",children:(0,t.jsx)(U,{aiModels:e})}),(0,t.jsx)(s.TabsContent,{value:"bulk",children:(0,t.jsx)(A,{aiModels:e})})]})}e.s(["DancingReelTabs",()=>F],72168)}]);