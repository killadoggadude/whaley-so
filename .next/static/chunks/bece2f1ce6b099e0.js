(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,76493,e=>{"use strict";var t=e.i(43476),s=e.i(77572),a=e.i(71645),r=e.i(19455),i=e.i(87486),l=e.i(75157),n=e.i(75254);let o=(0,n.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var c=e.i(72520),d=e.i(78583);let u=(0,n.default)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var m=e.i(87951),x=e.i(35501),h=e.i(78716),p=e.i(31343),g=e.i(58524),f=e.i(93479),j=e.i(10204),v=e.i(29592),b=e.i(31278),y=e.i(63209),w=e.i(46696);function N({videoUrl:e,onVideoUrlChange:s,onTranscriptReady:i}){let[l,n]=(0,a.useState)(!1),[o,c]=(0,a.useState)(null),d=async()=>{if(!e.trim())return void w.toast.error("Please enter a video URL");n(!0),c(null);try{let t=await fetch("/api/transcribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urls:[e.trim()]})}),s=await t.json();if(!t.ok)return void c(s.error||"Transcription failed");if(!s.results||0===s.results.length)return void c("No transcription results returned");let a=s.results[0];if(a.error)return void c(a.error);if(!a.transcript||0===a.transcript.trim().length)return void c("No speech detected in the video");w.toast.success(`Transcribed ${a.word_count} words from ${a.platform}`),i(a.transcript)}catch{c("Failed to transcribe video. Check your WaveSpeed API key.")}finally{n(!1)}};return(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(g.Link2,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Enter Video URL"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Paste a video URL to transcribe. Supports Instagram, TikTok, YouTube, and X."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{htmlFor:"video-url",children:"Video URL"}),(0,t.jsx)(f.Input,{id:"video-url",placeholder:"https://www.instagram.com/reel/...",value:e,onChange:e=>s(e.target.value),disabled:l})]}),o&&(0,t.jsxs)(v.Alert,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v.AlertDescription,{children:o})]}),(0,t.jsx)(r.Button,{onClick:d,disabled:l||!e.trim(),className:"w-full",size:"lg",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Transcribing..."]}):"Transcribe Video"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Powered by WaveSpeed AI Whisper. You can also skip this step and type your script manually."}),(0,t.jsx)(r.Button,{variant:"link",className:"w-full text-xs",onClick:()=>i(""),children:"Skip — write script manually"})]})}function C({transcript:e,onUseAsScript:s}){let a=e.trim().split(/\s+/).filter(e=>e.length>0).length;return e.trim()?(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Transcript Ready"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review the transcription below. You'll be able to edit it in the next step."})]}),(0,t.jsxs)("div",{className:"rounded-lg bg-card p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Transcription"}),(0,t.jsxs)(i.Badge,{variant:"secondary",children:[a," ",1===a?"word":"words"]})]}),(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:e})]}),(0,t.jsxs)(r.Button,{onClick:s,className:"w-full",size:"lg",children:["Continue to Edit Script",(0,t.jsx)(c.ArrowRight,{className:"h-4 w-4 ml-2"})]})]}):(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4 text-center",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-muted flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"h-6 w-6 text-muted-foreground"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"No Transcript"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"You skipped transcription. Continue to write your script manually."}),(0,t.jsxs)(r.Button,{onClick:s,size:"lg",children:["Write Script",(0,t.jsx)(c.ArrowRight,{className:"h-4 w-4 ml-2"})]})]})}var k=e.i(24687);function S({script:e,onScriptChange:s}){let a=e.trim().split(/\s+/).filter(e=>e.length>0).length,r=e.length;return(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(u,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Edit Script"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Edit the script that will be converted to speech. Remove filler words, fix errors, or rewrite as needed."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.Label,{htmlFor:"script",children:"Script"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:[a," ",1===a?"word":"words"]}),(0,t.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:[r," chars"]})]})]}),(0,t.jsx)(k.Textarea,{id:"script",value:e,onChange:e=>s(e.target.value),rows:12,placeholder:"Type or paste your script here...",className:"resize-y"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"This text will be spoken by your AI model's voice in the next step. Use the Next button to continue."})]})}var T=e.i(67489),F=e.i(20356),P=e.i(95468);async function U(e){try{if(!(await fetch(e,{method:"HEAD"})).ok)return console.error("Failed to fetch audio file"),null;let t=new Audio(e);return new Promise(e=>{t.addEventListener("loadedmetadata",()=>{let s=t.duration;e(s)}),t.addEventListener("error",()=>{console.error("Failed to load audio metadata"),e(null)}),t.load()})}catch(e){return console.error("Error getting audio duration:",e),null}}function I(e,t){let s=Math.min(e,600),a=Math.max(s*("480p"===t?.03:.06),.15);return{duration:s,cost:parseFloat(a.toFixed(2))}}function A({script:e,aiModels:s,selectedModel:i,onModelChange:l,audioUrl:n,onAudioGenerated:o}){let[c,d]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),g=s.filter(e=>e.voice_id&&e.voice_id.trim()),f=parseFloat((22e-5*e.length).toFixed(2)),N=async()=>{if(!i)return void w.toast.error("Select an AI model first");if(!e.trim())return void w.toast.error("Script is empty");d(!0),p(null);try{let t=await fetch("/api/tts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,voice_id:i.voice_id,settings:i.voice_settings})});if(!t.ok){let e=await t.json().catch(()=>null);p(e?.error||`TTS generation failed (${t.status})`);return}let s=await t.blob(),a=URL.createObjectURL(s);x(!0);let r=new FormData;r.append("file",s,"talking-head-audio.mp3");let l=await fetch("/api/talking-head/upload-audio",{method:"POST",body:r}),n=await l.json();if(!l.ok)return void p(n.error||"Failed to upload audio");w.toast.success("Voice generated and uploaded"),o(a,n.signedUrl)}catch{p("Failed to generate voice. Check your ElevenLabs API key.")}finally{d(!1),x(!1)}};return(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(m.Mic,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Generate Voice"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select an AI model and generate the voiceover for your script."})]}),0===g.length?(0,t.jsxs)(v.Alert,{children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsxs)(v.AlertDescription,{children:["No AI models with voice configured. Add voice settings (ElevenLabs voice ID) to your models in the"," ",(0,t.jsx)("a",{href:"/dashboard/models",className:"underline font-medium",children:"AI Models"})," ","page."]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"AI Model"}),(0,t.jsxs)(T.Select,{value:i?.id||"",onValueChange:e=>{l(g.find(t=>t.id===e)||null)},children:[(0,t.jsx)(T.SelectTrigger,{className:"w-full",children:(0,t.jsx)(T.SelectValue,{placeholder:"Select an AI model..."})}),(0,t.jsx)(T.SelectContent,{children:g.map(e=>(0,t.jsx)(T.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[e.reference_images.length>0?(0,t.jsx)("img",{src:e.reference_images[0].signed_url,alt:"",className:"h-5 w-5 rounded-sm object-cover"}):(0,t.jsx)(m.Mic,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.name]})},e.id))})]})]}),i&&(0,t.jsxs)("div",{className:"rounded-lg bg-card p-3 space-y-1.5",children:[(0,t.jsx)("p",{className:"text-xs font-medium",children:"Voice Settings"}),(0,t.jsxs)("div",{className:"flex gap-3 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Stability: ",i.voice_settings.stability]}),(0,t.jsxs)("span",{children:["Similarity:"," ",i.voice_settings.similarity_boost]}),(0,t.jsxs)("span",{children:["Style: ",i.voice_settings.style]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg bg-card p-3",children:[(0,t.jsx)("p",{className:"text-xs font-medium mb-1",children:"Script Preview"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-3",children:e})]}),(0,t.jsxs)("div",{className:"rounded-lg bg-card p-3 space-y-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium mb-1",children:"Estimated Cost"}),(0,t.jsxs)("div",{className:"flex items-center justify-center py-2 bg-muted/50 rounded",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground mr-2",children:"Total:"}),(0,t.jsxs)("span",{className:"text-2xl font-semibold text-green-600",children:["$",f.toFixed(2)]})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["Based on ",e.length," characters at ~$0.00022/char"]})]}),h&&(0,t.jsxs)(v.Alert,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v.AlertDescription,{children:h})]}),(0,t.jsx)(r.Button,{onClick:N,disabled:c||u||!i,className:"w-full",size:"lg",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating voice..."]}):u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading audio..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Mic,{className:"h-4 w-4 mr-2"}),"Generate Voice — Est. $",f.toFixed(2)]})}),n&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Audio Ready"})]}),(0,t.jsx)(F.AudioPlayer,{audioUrl:n}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use the Next button to continue to image selection."})]})]})]})}var $=e.i(55436),L=e.i(43531),R=e.i(69074),B=e.i(38162);function _({selectedModel:e,selectedImageId:s,onImageSelect:n}){let[o,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(0),[m,h]=(0,a.useState)(!1),[p,g]=(0,a.useState)(""),[j,N]=(0,a.useState)(!1),[C,k]=(0,a.useState)(!1),[S,T]=(0,a.useState)(null),F=(0,a.useRef)(null),P=e?.reference_images||[],U=P.length>0,I=(0,a.useCallback)(async e=>{h(!0);let t=e?o.length:0,s=await (0,B.getAssetsAction)({file_type:"image",search:p||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:t});e?c(e=>[...e,...s.assets]):c(s.assets),u(s.total),h(!1)},[p,o.length]);(0,a.useEffect)(()=>{(j||!U)&&I(!1)},[j,U]);let A=async e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith("image/"))return void w.toast.error("Please select an image file");if(t.size>0x3200000)return void w.toast.error("File exceeds 50MB size limit");k(!0),T(null);try{let e=new FormData;e.append("file",t),e.append("tags",JSON.stringify(["talking-head","portrait"]));let s=await fetch("/api/assets/upload",{method:"POST",body:e}),a=await s.json();if(!s.ok)return void T(a.error||"Upload failed");w.toast.success("Image uploaded!");let r=await (0,B.getAssetsAction)({file_type:"image",sort_by:"created_at",sort_order:"desc",limit:30,offset:0});c(r.assets),u(r.total),N(!0);let i=r.assets.find(e=>e.id===a.asset.id);i&&n(i.id,i.signed_url)}catch{T("Failed to upload image")}finally{k(!1),F.current&&(F.current.value="")}}},_=!j&&U?P:o;return(0,t.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(x.ImageIcon,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Select Portrait Image"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose a portrait image for the talking head video. A clear front-facing photo works best."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[U&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Button,{variant:j?"outline":"default",size:"sm",onClick:()=>N(!1),children:[e?.name,"'s Images (",P.length,")"]}),(0,t.jsx)(r.Button,{variant:j?"default":"outline",size:"sm",onClick:()=>N(!0),children:"All Images"})]}),(0,t.jsxs)("div",{className:"ml-auto",children:[(0,t.jsx)("input",{ref:F,type:"file",accept:"image/*",onChange:A,className:"hidden"}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>F.current?.click(),disabled:C,children:[C?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-1.5 animate-spin"}):(0,t.jsx)(R.Upload,{className:"h-4 w-4 mr-1.5"}),C?"Uploading...":"Upload Image"]})]})]}),S&&(0,t.jsxs)(v.Alert,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v.AlertDescription,{children:S})]}),(j||!U)&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)($.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(f.Input,{placeholder:"Search images...",value:p,onChange:e=>{let t;return g(e.target.value),t=setTimeout(()=>I(!1),300),()=>clearTimeout(t)},className:"pl-9"})]}),0!==_.length||m?(0,t.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:_.map(e=>{let a=s===e.id;return(0,t.jsxs)("button",{type:"button",className:(0,l.cn)("relative aspect-square overflow-hidden rounded-md border-2 transition-all",a?"border-accent-blue ring-2 ring-accent-blue/20":"border-transparent hover:border-muted-foreground/30"),onClick:()=>n(e.id,e.signed_url),children:[(0,t.jsx)("img",{src:e.signed_url,alt:e.filename,className:"h-full w-full object-cover",loading:"lazy"}),a&&(0,t.jsx)("div",{className:"absolute inset-0 bg-accent-blue/20 flex items-center justify-center",children:(0,t.jsx)("div",{className:"h-6 w-6 rounded-full bg-accent-blue flex items-center justify-center",children:(0,t.jsx)(L.Check,{className:"h-4 w-4 text-primary-foreground"})})})]},e.id)})}):(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["No images found. Upload an image above or add images in the"," ",(0,t.jsx)("a",{href:"/dashboard/assets",className:"underline font-medium",children:"Asset Library"}),"."]})}),(j||!U)&&o.length<d&&(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>I(!0),disabled:m,children:m?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})}),s&&(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,t.jsxs)(i.Badge,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(L.Check,{className:"h-3 w-3"}),"Image selected"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use the Next button to continue."})]})]})}var M=e.i(81140),z=e.i(20783),E=e.i(30030),O=e.i(69340),V=e.i(99682),D=e.i(35804),W=e.i(48425),H="Switch",[J,G]=(0,E.createContextScope)(H),[q,Y]=J(H),X=a.forwardRef((e,s)=>{let{__scopeSwitch:r,name:i,checked:l,defaultChecked:n,required:o,disabled:c,value:d="on",onCheckedChange:u,form:m,...x}=e,[h,p]=a.useState(null),g=(0,z.useComposedRefs)(s,e=>p(e)),f=a.useRef(!1),j=!h||m||!!h.closest("form"),[v,b]=(0,O.useControllableState)({prop:l,defaultProp:n??!1,onChange:u,caller:H});return(0,t.jsxs)(q,{scope:r,checked:v,disabled:c,children:[(0,t.jsx)(W.Primitive.button,{type:"button",role:"switch","aria-checked":v,"aria-required":o,"data-state":ee(v),"data-disabled":c?"":void 0,disabled:c,value:d,...x,ref:g,onClick:(0,M.composeEventHandlers)(e.onClick,e=>{b(e=>!e),j&&(f.current=e.isPropagationStopped(),f.current||e.stopPropagation())})}),j&&(0,t.jsx)(Q,{control:h,bubbles:!f.current,name:i,value:d,checked:v,required:o,disabled:c,form:m,style:{transform:"translateX(-100%)"}})]})});X.displayName=H;var K="SwitchThumb",Z=a.forwardRef((e,s)=>{let{__scopeSwitch:a,...r}=e,i=Y(K,a);return(0,t.jsx)(W.Primitive.span,{"data-state":ee(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:s})});Z.displayName=K;var Q=a.forwardRef(({__scopeSwitch:e,control:s,checked:r,bubbles:i=!0,...l},n)=>{let o=a.useRef(null),c=(0,z.useComposedRefs)(o,n),d=(0,V.usePrevious)(r),u=(0,D.useSize)(s);return a.useEffect(()=>{let e=o.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(d!==r&&t){let s=new Event("click",{bubbles:i});t.call(e,r),e.dispatchEvent(s)}},[d,r,i]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:c,style:{...l.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function ee(e){return e?"checked":"unchecked"}Q.displayName="SwitchBubbleInput",e.s(["Root",()=>X,"Switch",()=>X,"SwitchThumb",()=>Z,"Thumb",()=>Z,"createSwitchScope",()=>G],57287);var et=e.i(57287),et=et;function es({className:e,size:s="default",...a}){return(0,t.jsx)(et.Root,{"data-slot":"switch","data-size":s,className:(0,l.cn)("peer data-[state=checked]:bg-accent-blue data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 group/switch inline-flex shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-[1.15rem] data-[size=default]:w-8 data-[size=sm]:h-3.5 data-[size=sm]:w-6",e),...a,children:(0,t.jsx)(et.Thumb,{"data-slot":"switch-thumb",className:(0,l.cn)("bg-background data-[state=unchecked]:bg-foreground data-[state=checked]:bg-accent-blue-foreground pointer-events-none block rounded-full ring-0 transition-transform group-data-[size=default]/switch:size-4 group-data-[size=sm]/switch:size-3 data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var ea=e.i(68148),er=e.i(16715);let ei=(0,n.default)("captions",[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]]);var el=e.i(67692),en=e.i(26330),eo=e.i(10772),ec=e.i(53660),ed=e.i(74606),eu=e.i(96626),em=e.i(91918),ex=e.i(59411),[eh,ep]=(0,E.createContextScope)("Tooltip",[ec.createPopperScope]),eg=(0,ec.createPopperScope)(),ef="TooltipProvider",ej="tooltip.open",[ev,eb]=eh(ef),ey=e=>{let{__scopeTooltip:s,delayDuration:r=700,skipDelayDuration:i=300,disableHoverableContent:l=!1,children:n}=e,o=a.useRef(!0),c=a.useRef(!1),d=a.useRef(0);return a.useEffect(()=>{let e=d.current;return()=>window.clearTimeout(e)},[]),(0,t.jsx)(ev,{scope:s,isOpenDelayedRef:o,delayDuration:r,onOpen:a.useCallback(()=>{window.clearTimeout(d.current),o.current=!1},[]),onClose:a.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.current=!0,i)},[i]),isPointerInTransitRef:c,onPointerInTransitChange:a.useCallback(e=>{c.current=e},[]),disableHoverableContent:l,children:n})};ey.displayName=ef;var ew="Tooltip",[eN,eC]=eh(ew),ek=e=>{let{__scopeTooltip:s,children:r,open:i,defaultOpen:l,onOpenChange:n,disableHoverableContent:o,delayDuration:c}=e,d=eb(ew,e.__scopeTooltip),u=eg(s),[m,x]=a.useState(null),h=(0,eo.useId)(),p=a.useRef(0),g=o??d.disableHoverableContent,f=c??d.delayDuration,j=a.useRef(!1),[v,b]=(0,O.useControllableState)({prop:i,defaultProp:l??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(ej))):d.onClose(),n?.(e)},caller:ew}),y=a.useMemo(()=>v?j.current?"delayed-open":"instant-open":"closed",[v]),w=a.useCallback(()=>{window.clearTimeout(p.current),p.current=0,j.current=!1,b(!0)},[b]),N=a.useCallback(()=>{window.clearTimeout(p.current),p.current=0,b(!1)},[b]),C=a.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{j.current=!0,b(!0),p.current=0},f)},[f,b]);return a.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),(0,t.jsx)(ec.Root,{...u,children:(0,t.jsx)(eN,{scope:s,contentId:h,open:v,stateAttribute:y,trigger:m,onTriggerChange:x,onTriggerEnter:a.useCallback(()=>{d.isOpenDelayedRef.current?C():w()},[d.isOpenDelayedRef,C,w]),onTriggerLeave:a.useCallback(()=>{g?N():(window.clearTimeout(p.current),p.current=0)},[N,g]),onOpen:w,onClose:N,disableHoverableContent:g,children:r})})};ek.displayName=ew;var eS="TooltipTrigger",eT=a.forwardRef((e,s)=>{let{__scopeTooltip:r,...i}=e,l=eC(eS,r),n=eb(eS,r),o=eg(r),c=a.useRef(null),d=(0,z.useComposedRefs)(s,c,l.onTriggerChange),u=a.useRef(!1),m=a.useRef(!1),x=a.useCallback(()=>u.current=!1,[]);return a.useEffect(()=>()=>document.removeEventListener("pointerup",x),[x]),(0,t.jsx)(ec.Anchor,{asChild:!0,...o,children:(0,t.jsx)(W.Primitive.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...i,ref:d,onPointerMove:(0,M.composeEventHandlers)(e.onPointerMove,e=>{"touch"!==e.pointerType&&(m.current||n.isPointerInTransitRef.current||(l.onTriggerEnter(),m.current=!0))}),onPointerLeave:(0,M.composeEventHandlers)(e.onPointerLeave,()=>{l.onTriggerLeave(),m.current=!1}),onPointerDown:(0,M.composeEventHandlers)(e.onPointerDown,()=>{l.open&&l.onClose(),u.current=!0,document.addEventListener("pointerup",x,{once:!0})}),onFocus:(0,M.composeEventHandlers)(e.onFocus,()=>{u.current||l.onOpen()}),onBlur:(0,M.composeEventHandlers)(e.onBlur,l.onClose),onClick:(0,M.composeEventHandlers)(e.onClick,l.onClose)})})});eT.displayName=eS;var eF="TooltipPortal",[eP,eU]=eh(eF,{forceMount:void 0}),eI=e=>{let{__scopeTooltip:s,forceMount:a,children:r,container:i}=e,l=eC(eF,s);return(0,t.jsx)(eP,{scope:s,forceMount:a,children:(0,t.jsx)(eu.Presence,{present:a||l.open,children:(0,t.jsx)(ed.Portal,{asChild:!0,container:i,children:r})})})};eI.displayName=eF;var eA="TooltipContent",e$=a.forwardRef((e,s)=>{let a=eU(eA,e.__scopeTooltip),{forceMount:r=a.forceMount,side:i="top",...l}=e,n=eC(eA,e.__scopeTooltip);return(0,t.jsx)(eu.Presence,{present:r||n.open,children:n.disableHoverableContent?(0,t.jsx)(eM,{side:i,...l,ref:s}):(0,t.jsx)(eL,{side:i,...l,ref:s})})}),eL=a.forwardRef((e,s)=>{let r=eC(eA,e.__scopeTooltip),i=eb(eA,e.__scopeTooltip),l=a.useRef(null),n=(0,z.useComposedRefs)(s,l),[o,c]=a.useState(null),{trigger:d,onClose:u}=r,m=l.current,{onPointerInTransitChange:x}=i,h=a.useCallback(()=>{c(null),x(!1)},[x]),p=a.useCallback((e,t)=>{let s,a=e.currentTarget,r={x:e.clientX,y:e.clientY},i=function(e,t){let s=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),r=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(s,a,r,i)){case i:return"left";case r:return"right";case s:return"top";case a:return"bottom";default:throw Error("unreachable")}}(r,a.getBoundingClientRect());c(((s=[...function(e,t,s=5){let a=[];switch(t){case"top":a.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":a.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":a.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":a.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s})}return a}(r,i),...function(e){let{top:t,right:s,bottom:a,left:r}=e;return[{x:r,y:t},{x:s,y:t},{x:s,y:a},{x:r,y:a}]}(t.getBoundingClientRect())].slice()).sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:1*!!(e.y>t.y)),function(e){if(e.length<=1)return e.slice();let t=[];for(let s=0;s<e.length;s++){let a=e[s];for(;t.length>=2;){let e=t[t.length-1],s=t[t.length-2];if((e.x-s.x)*(a.y-s.y)>=(e.y-s.y)*(a.x-s.x))t.pop();else break}t.push(a)}t.pop();let s=[];for(let t=e.length-1;t>=0;t--){let a=e[t];for(;s.length>=2;){let e=s[s.length-1],t=s[s.length-2];if((e.x-t.x)*(a.y-t.y)>=(e.y-t.y)*(a.x-t.x))s.pop();else break}s.push(a)}return(s.pop(),1===t.length&&1===s.length&&t[0].x===s[0].x&&t[0].y===s[0].y)?t:t.concat(s)}(s))),x(!0)},[x]);return a.useEffect(()=>()=>h(),[h]),a.useEffect(()=>{if(d&&m){let e=e=>p(e,m),t=e=>p(e,d);return d.addEventListener("pointerleave",e),m.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),m.removeEventListener("pointerleave",t)}}},[d,m,p,h]),a.useEffect(()=>{if(o){let e=e=>{let t=e.target,s={x:e.clientX,y:e.clientY},a=d?.contains(t)||m?.contains(t),r=!function(e,t){let{x:s,y:a}=e,r=!1;for(let e=0,i=t.length-1;e<t.length;i=e++){let l=t[e],n=t[i],o=l.x,c=l.y,d=n.x,u=n.y;c>a!=u>a&&s<(d-o)*(a-c)/(u-c)+o&&(r=!r)}return r}(s,o);a?h():r&&(h(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,m,o,u,h]),(0,t.jsx)(eM,{...e,ref:n})}),[eR,eB]=eh(ew,{isInside:!1}),e_=(0,em.createSlottable)("TooltipContent"),eM=a.forwardRef((e,s)=>{let{__scopeTooltip:r,children:i,"aria-label":l,onEscapeKeyDown:n,onPointerDownOutside:o,...c}=e,d=eC(eA,r),u=eg(r),{onClose:m}=d;return a.useEffect(()=>(document.addEventListener(ej,m),()=>document.removeEventListener(ej,m)),[m]),a.useEffect(()=>{if(d.trigger){let e=e=>{let t=e.target;t?.contains(d.trigger)&&m()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,m]),(0,t.jsx)(en.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:m,children:(0,t.jsxs)(ec.Content,{"data-state":d.stateAttribute,...u,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,t.jsx)(e_,{children:i}),(0,t.jsx)(eR,{scope:r,isInside:!0,children:(0,t.jsx)(ex.Root,{id:d.contentId,role:"tooltip",children:l||i})})]})})});e$.displayName=eA;var ez="TooltipArrow",eE=a.forwardRef((e,s)=>{let{__scopeTooltip:a,...r}=e,i=eg(a);return eB(ez,a).isInside?null:(0,t.jsx)(ec.Arrow,{...i,...r,ref:s})});eE.displayName=ez,e.s(["Arrow",()=>eE,"Content",()=>e$,"Portal",()=>eI,"Provider",()=>ey,"Root",()=>ek,"Tooltip",()=>ek,"TooltipArrow",()=>eE,"TooltipContent",()=>e$,"TooltipPortal",()=>eI,"TooltipProvider",()=>ey,"TooltipTrigger",()=>eT,"Trigger",()=>eT,"createTooltipScope",()=>ep],86336);var eO=e.i(86336),eO=eO;function eV({delayDuration:e=0,...s}){return(0,t.jsx)(eO.Provider,{"data-slot":"tooltip-provider",delayDuration:e,...s})}function eD({...e}){return(0,t.jsx)(eO.Root,{"data-slot":"tooltip",...e})}function eW({...e}){return(0,t.jsx)(eO.Trigger,{"data-slot":"tooltip-trigger",...e})}function eH({className:e,sideOffset:s=0,children:a,...r}){return(0,t.jsx)(eO.Portal,{children:(0,t.jsxs)(eO.Content,{"data-slot":"tooltip-content",sideOffset:s,className:(0,l.cn)("bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",e),...r,children:[a,(0,t.jsx)(eO.Arrow,{className:"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}let eJ=(0,n.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),eG=(0,n.default)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),eq=(0,n.default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var eY=e.i(37727),eX=e.i(56909);let eK=["Arial","Helvetica","Impact","Georgia","Verdana","Trebuchet MS","Courier New","Comic Sans MS","Futura","Tahoma"],eZ={fontFamily:"Arial",fontSize:60,textColor:"#FFFFFF",highlightColor:"#FFFF00",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:3,bold:!0,italic:!1,wordsPerPage:3,position:"center",verticalPosition:50},eQ=[{id:"classic-tiktok",name:"Classic TikTok",settings:{fontFamily:"Impact",fontSize:60,textColor:"#FFFFFF",highlightColor:"#FFFF00",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:3,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-yellow-400"},{id:"capcut-pop",name:"CapCut Pop",settings:{fontFamily:"Arial",fontSize:64,textColor:"#FFFFFF",highlightColor:"#00D9FF",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:4,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-cyan-400"},{id:"neon-highlight",name:"Neon Highlight",settings:{fontFamily:"Arial",fontSize:58,textColor:"#FFFFFF",highlightColor:"#39FF14",backgroundColor:"",backgroundOpacity:60,outlineColor:"#00FF00",outlineWidth:2,bold:!0,italic:!1,wordsPerPage:3,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-lime-400"},{id:"bold-minimal",name:"Bold Minimal",settings:{fontFamily:"Arial",fontSize:56,textColor:"#FFFFFF",highlightColor:"#FFFFFF",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:1,bold:!0,italic:!1,wordsPerPage:3,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-white"},{id:"warm-viral",name:"Warm Viral",settings:{fontFamily:"Arial",fontSize:62,textColor:"#FFFFFF",highlightColor:"#FF6B35",backgroundColor:"",backgroundOpacity:60,outlineColor:"#4A2C2A",outlineWidth:3,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-orange-500"},{id:"clean-subtitle",name:"Clean Subtitle",settings:{fontFamily:"Arial",fontSize:52,textColor:"#FFFFFF",highlightColor:"#87CEEB",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:2,bold:!1,italic:!1,wordsPerPage:3,position:"bottom",verticalPosition:70},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-sky-400"}];function e0(e,t=0){let s=e.replace("#","");if(6!==s.length)return"&H00FFFFFF";let a=s.substring(0,2),r=s.substring(2,4),i=s.substring(4,6),l=Math.round(t/100*255).toString(16).padStart(2,"0").toUpperCase();return`&H${l}${i}${r}${a}`.toUpperCase()}eQ.map(e=>(function(e,t,s,a="bg-black",r="text-white",i="text-yellow-400"){let l=Math.round((1-s.verticalPosition/100)*1920),n=s.verticalPosition<=33?8:s.verticalPosition<=66?5:2;return{id:e,name:t,fontFamily:s.fontFamily,fontSize:s.fontSize,primaryColor:e0(s.textColor),highlightColor:e0(s.highlightColor),outlineColor:e0(s.outlineColor),shadowColor:s.backgroundColor?e0(s.backgroundColor,100-s.backgroundOpacity):e0("#000000",80),backgroundColor:s.backgroundColor?e0(s.backgroundColor,100-s.backgroundOpacity):"",outlineWidth:s.outlineWidth,shadowDepth:2*!s.backgroundColor,bold:s.bold,italic:s.italic,alignment:n,marginV:l,wordsPerPage:s.wordsPerPage,previewBg:a,previewText:r,previewHighlight:i}})(e.id,e.name,e.settings,e.previewBg,e.previewText,e.previewHighlight));var e1=e.i(95187);let e2=(0,e1.createServerReference)("00fa4820aecc0a3e59611bf0b7744355af8d4e27c0",e1.callServer,void 0,e1.findSourceMapURL,"getCaptionPresetsAction"),e5=(0,e1.createServerReference)("60f71fc9dc241bb13bca925648e5296866a1ae1431",e1.callServer,void 0,e1.findSourceMapURL,"saveCaptionPresetAction"),e3=(0,e1.createServerReference)("40d147172e8c74ea711433ab0c509a91c9d71086bc",e1.callServer,void 0,e1.findSourceMapURL,"deleteCaptionPresetAction");function e4({presetSettings:e}){return(0,t.jsx)("div",{className:"relative rounded-lg overflow-hidden bg-gradient-to-b from-gray-800 via-gray-900 to-black",style:{width:"70px",height:"120px"},children:(0,t.jsx)("div",{className:"absolute left-0 right-0 flex items-center justify-center px-2",style:{top:`${e.verticalPosition}%`,transform:"translateY(-50%)"},children:(0,t.jsx)("div",{className:"inline-block px-1.5 py-0.5 rounded",style:{backgroundColor:e.backgroundColor?`${e.backgroundColor}${Math.round(e.backgroundOpacity/100*255).toString(16).padStart(2,"0")}`:"transparent"},children:(0,t.jsx)("p",{className:"text-center leading-tight",style:{fontFamily:e.fontFamily,fontSize:`${Math.max(8,.18*e.fontSize)}px`,fontWeight:e.bold?700:400,fontStyle:e.italic?"italic":"normal",textShadow:e.outlineWidth>0?`0 0 ${1.5*e.outlineWidth}px ${e.outlineColor},
                   ${e.outlineWidth}px ${e.outlineWidth}px 0 ${e.outlineColor},
                   -${e.outlineWidth}px -${e.outlineWidth}px 0 ${e.outlineColor},
                   ${e.outlineWidth}px -${e.outlineWidth}px 0 ${e.outlineColor},
                   -${e.outlineWidth}px ${e.outlineWidth}px 0 ${e.outlineColor}`:"none",letterSpacing:"0.02em"},children:["Hello","World"].map((s,a)=>(0,t.jsxs)("span",{style:{color:1===a?e.highlightColor:e.textColor},children:[s," "]},a))})})})})}function e6({settings:e,onChange:s,compact:i=!1}){let[n,o]=(0,a.useState)("classic-tiktok"),c=t=>{o(null),s({...e,...t})},d=["This","is","a","caption","preview"],u=d.slice(0,Math.min(e.wordsPerPage,d.length)),m=Math.min(2,u.length-1),[x,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(!1),[v,b]=(0,a.useState)(""),[y,w]=(0,a.useState)(!1),[N,C]=(0,a.useState)(null),[k,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e2().then(({presets:e})=>h(e))},[]);let F=async()=>{if(v.trim()){w(!0);try{let{preset:t}=await e5(v.trim(),e);if(t){g(!1),b(""),S(!0);let{presets:e}=await e2();h(e),S(!1)}}catch{}finally{w(!1)}}},U=async e=>{C(e);try{await e3(e),h(t=>t.filter(t=>t.id!==e))}catch{}finally{C(null)}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.Label,{className:"text-xs font-medium",children:"Presets"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>g(!0),className:"h-6 px-2 text-xs text-muted-foreground",disabled:y||k,children:[(0,t.jsx)(eX.Save,{className:"h-3 w-3 mr-1"}),"Save"]}),(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{o("classic-tiktok"),s({...eZ})},className:"h-6 px-2 text-xs text-muted-foreground",children:[(0,t.jsx)(eJ,{className:"h-3 w-3 mr-1"}),"Reset"]})]})]}),p&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Input,{placeholder:"Preset name...",value:v,onChange:e=>b(e.target.value),className:"h-8 text-xs",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&F(),"Escape"===e.key&&g(!1)}}),(0,t.jsx)(r.Button,{size:"sm",onClick:F,disabled:!v.trim()||y,className:"h-8",children:y?"Saving...":"Save"}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{g(!1),b("")},className:"h-8",children:"Cancel"})]}),(0,t.jsx)(eV,{children:(0,t.jsxs)("div",{className:"flex gap-1.5 overflow-x-auto pb-1",children:[eQ.map(a=>{let r=n===a.id||JSON.stringify(e)===JSON.stringify(a.settings);return(0,t.jsxs)(eD,{children:[(0,t.jsx)(eW,{asChild:!0,children:(0,t.jsxs)("button",{type:"button",onClick:()=>{var e;let t;return e=a.id,void((t=eQ.find(t=>t.id===e))&&(o(e),s({...t.settings})))},className:(0,l.cn)("relative flex-shrink-0 rounded-md border-2 px-2.5 py-1.5 text-xs font-medium transition-all",r?"border-accent-blue bg-accent-blue/5":"border-solid border-border bg-muted/50 hover:border-muted-foreground/30"),children:[r&&(0,t.jsx)(P.CheckCircle2,{className:"absolute -top-1 -right-1 h-3.5 w-3.5 text-accent-blue"}),a.name]})}),(0,t.jsx)(eH,{className:"p-0",children:(0,t.jsx)(e4,{presetSettings:a.settings})})]},a.id)}),x.map(a=>{let r=a.settings,i=n===`saved-${a.id}`||JSON.stringify(e)===JSON.stringify(r);return(0,t.jsxs)(eD,{children:[(0,t.jsx)(eW,{asChild:!0,children:(0,t.jsxs)("button",{type:"button",onClick:()=>{o(`saved-${a.id}`),s({...r})},className:(0,l.cn)("relative flex-shrink-0 rounded-md border-2 px-2.5 py-1.5 text-xs font-medium transition-all group",i?"border-accent-blue bg-accent-blue/5":"border-dashed border-border bg-muted/50 hover:border-muted-foreground/30"),children:[i&&(0,t.jsx)(P.CheckCircle2,{className:"absolute -top-1 -right-1 h-3.5 w-3.5 text-accent-blue"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eq,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{children:a.name})]}),N===a.id?(0,t.jsx)(er.RefreshCw,{className:"absolute -top-1 -right-1 h-3 w-3 text-muted-foreground animate-spin"}):(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),U(a.id)},className:"hidden group-hover:flex absolute -top-1 -right-1 h-4 w-4 rounded-full bg-destructive text-destructive-foreground items-center justify-center transition-opacity",children:(0,t.jsx)(eY.X,{className:"h-2.5 w-2.5"})})]})}),(0,t.jsx)(eH,{className:"p-0",children:(0,t.jsx)(e4,{presetSettings:r})})]},a.id)})]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{className:"text-xs font-medium",children:"Preview"}),(0,t.jsxs)("div",{className:"relative rounded-lg overflow-hidden",style:{aspectRatio:"9/16",maxHeight:i?"180px":"240px"},children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-gray-800 via-gray-900 to-black"}),(0,t.jsx)("div",{className:"absolute left-0 right-0 flex items-center justify-center px-4",style:{top:`${e.verticalPosition}%`,transform:"translateY(-50%)"},children:(0,t.jsx)("div",{className:"inline-block px-3 py-1.5 rounded",style:{backgroundColor:e.backgroundColor?`${e.backgroundColor}${Math.round(e.backgroundOpacity/100*255).toString(16).padStart(2,"0")}`:"transparent"},children:(0,t.jsx)("p",{className:"text-center leading-tight",style:{fontFamily:e.fontFamily,fontSize:`${Math.max(10,e.fontSize*(i?.22:.28))}px`,fontWeight:e.bold?700:400,fontStyle:e.italic?"italic":"normal",textShadow:e.outlineWidth>0?`0 0 ${1.5*e.outlineWidth}px ${e.outlineColor},
                       ${e.outlineWidth}px ${e.outlineWidth}px 0 ${e.outlineColor},
                       -${e.outlineWidth}px -${e.outlineWidth}px 0 ${e.outlineColor},
                       ${e.outlineWidth}px -${e.outlineWidth}px 0 ${e.outlineColor},
                       -${e.outlineWidth}px ${e.outlineWidth}px 0 ${e.outlineColor}`:"none",letterSpacing:"0.02em"},children:u.map((s,a)=>(0,t.jsxs)("span",{style:{color:a===m?e.highlightColor:e.textColor},children:[s," "]},a))})})})]})]}),(0,t.jsxs)("div",{className:(0,l.cn)("space-y-3",i&&"grid grid-cols-2 gap-x-4 gap-y-3 space-y-0"),children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Font"}),(0,t.jsxs)(T.Select,{value:e.fontFamily,onValueChange:e=>c({fontFamily:e}),children:[(0,t.jsx)(T.SelectTrigger,{className:"h-8 text-xs",children:(0,t.jsx)(T.SelectValue,{})}),(0,t.jsx)(T.SelectContent,{children:eK.map(e=>(0,t.jsx)(T.SelectItem,{value:e,children:(0,t.jsx)("span",{style:{fontFamily:e},children:e})},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Size"}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[e.fontSize,"px"]})]}),(0,t.jsx)(el.Slider,{value:[e.fontSize],onValueChange:([e])=>c({fontSize:e}),min:24,max:80,step:2,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Text Color"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"color",value:e.textColor,onChange:e=>c({textColor:e.target.value}),className:"opacity-0 absolute inset-0 cursor-pointer"}),(0,t.jsx)("div",{className:"h-6 w-8 rounded border border-border",style:{backgroundColor:e.textColor}})]}),(0,t.jsx)(f.Input,{type:"text",value:e.textColor,onChange:e=>c({textColor:e.target.value}),className:"w-20 h-8 text-xs font-mono"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Highlight"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"color",value:e.highlightColor,onChange:e=>c({highlightColor:e.target.value}),className:"opacity-0 absolute inset-0 cursor-pointer"}),(0,t.jsx)("div",{className:"h-6 w-8 rounded border border-border",style:{backgroundColor:e.highlightColor}})]}),(0,t.jsx)(f.Input,{type:"text",value:e.highlightColor,onChange:e=>c({highlightColor:e.target.value}),className:"w-20 h-8 text-xs font-mono"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Background"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"color",value:e.backgroundColor||"#000000",onChange:e=>c({backgroundColor:e.target.value}),className:"opacity-0 absolute inset-0 cursor-pointer"}),(0,t.jsx)("div",{className:"h-6 w-8 rounded border border-border",style:{backgroundColor:e.backgroundColor||"#000000"}})]}),(0,t.jsx)(f.Input,{type:"text",value:e.backgroundColor,onChange:e=>c({backgroundColor:e.target.value}),className:"w-20 h-8 text-xs font-mono"}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[e.backgroundOpacity,"%"]}),(0,t.jsx)(el.Slider,{value:[e.backgroundOpacity],onValueChange:([e])=>c({backgroundOpacity:e}),min:10,max:100,step:5,className:"flex-1"})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Outline"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"color",value:e.outlineColor,onChange:e=>c({outlineColor:e.target.value}),className:"opacity-0 absolute inset-0 cursor-pointer"}),(0,t.jsx)("div",{className:"h-6 w-8 rounded border border-border",style:{backgroundColor:e.outlineColor}})]}),(0,t.jsx)(el.Slider,{value:[e.outlineWidth],onValueChange:([e])=>c({outlineWidth:e}),min:0,max:5,step:1,className:"flex-1"}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[e.outlineWidth,"px"]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Words per Page"}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:e.wordsPerPage})]}),(0,t.jsx)(el.Slider,{value:[e.wordsPerPage],onValueChange:([e])=>c({wordsPerPage:e}),min:2,max:8,step:1,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Position"}),(0,t.jsxs)(T.Select,{value:e.position,onValueChange:e=>{c({position:e,verticalPosition:"top"===e?20:"center"===e?50:70})},children:[(0,t.jsx)(T.SelectTrigger,{className:"h-8 text-xs",children:(0,t.jsx)(T.SelectValue,{})}),(0,t.jsxs)(T.SelectContent,{children:[(0,t.jsx)(T.SelectItem,{value:"bottom",children:"Bottom"}),(0,t.jsx)(T.SelectItem,{value:"center",children:"Center"}),(0,t.jsx)(T.SelectItem,{value:"top",children:"Top"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground w-3",children:"Top"}),(0,t.jsx)(el.Slider,{value:[e.verticalPosition],onValueChange:([e])=>{c({verticalPosition:e,position:e<=33?"top":e<=66?"center":"bottom"}),n&&o(null)},min:0,max:100,step:1,className:"flex-1"}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground w-3",children:"Btm"})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[Math.round(e.verticalPosition),"%"]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(es,{checked:e.bold,onCheckedChange:e=>c({bold:e}),className:"scale-75"}),(0,t.jsx)(j.Label,{className:"text-xs font-bold",children:"Bold"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(es,{checked:e.italic,onCheckedChange:e=>c({italic:e}),className:"scale-75"}),(0,t.jsx)(j.Label,{className:"text-xs italic",children:"Italic"})]})]})]}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(eG,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:["Using preset: ",eQ.find(e=>e.id===n)?.name]})]})]})}function e7({settings:e,onChange:s}){return(0,t.jsx)(e6,{settings:e,onChange:s,compact:!0})}function e8({audioSignedUrl:e,imageSignedUrl:s,selectedImageUrl:i,audioUrl:l,script:n,onVideoReady:o}){let c,d,[u,m]=(0,a.useState)("480p"),[x,p]=(0,a.useState)("idle"),[g,f]=(0,a.useState)(null),[N,C]=(0,a.useState)(null),[k,S]=(0,a.useState)(0),F=(0,a.useRef)(!1),[A,$]=(0,a.useState)(!1),[L,R]=(0,a.useState)({...eZ}),[B,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{l&&(_(null),_(await U(l)))})()},[l]);let M=(0,a.useCallback)(async t=>{p("transcribing");try{let s=await fetch("/api/talking-head/transcribe-audio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioUrl:e})}),a=await s.json();if(!s.ok||!a.words?.length){console.error("Caption transcription failed:",a.error),w.toast.warning("Could not transcribe audio for captions. Video saved without captions."),p("completed"),o(t);return}p("burning");let r=await fetch("/api/talking-head/add-captions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:t,words:a.words,customSettings:L})}),i=await r.json();if(!r.ok){console.error("Caption burn-in failed:",i.error),w.toast.warning("Could not add captions. Video saved without captions."),p("completed"),o(t);return}p("completed"),w.toast.success("Video generated with captions!"),o(t,i.signedUrl,i.assetId)}catch(e){console.error("Caption error:",e),w.toast.warning("Caption processing failed. Video saved without captions."),p("completed"),o(t)}},[e,L,o]),z=(0,a.useCallback)(async e=>{F.current=!0;let t=0;for(;F.current&&t<100;){S(++t);try{let t=await fetch(`/api/talking-head/queue-status?queueId=${encodeURIComponent(e)}`),s=await t.json();if(!t.ok){p("failed"),C(s.error||"Failed to check status"),F.current=!1;return}if("completed"===s.status&&s.taskId){F.current=!1,f(s.taskId),await E(s.taskId);return}if("failed"===s.status){p("failed"),C(s.error||"Video generation failed"),F.current=!1;return}await new Promise(e=>setTimeout(e,3e3))}catch{p("failed"),C("Network error while checking status"),F.current=!1;return}}F.current&&(p("failed"),C("Video generation timed out. Please try again."),F.current=!1)},[A,o,M]),E=(0,a.useCallback)(async e=>{F.current=!0;let t=0;for(;F.current&&t<100;){S(++t);try{let t=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(e)}`),s=await t.json();if(!t.ok){p("failed"),C(s.error||"Failed to check status"),F.current=!1;return}if("completed"===s.status&&s.videoUrl){F.current=!1,A?M(s.videoUrl):(p("completed"),w.toast.success("Video generated successfully!"),o(s.videoUrl));return}if("failed"===s.status){p("failed"),C(s.error||"Video generation failed"),F.current=!1;return}await new Promise(e=>setTimeout(e,3e3))}catch{p("failed"),C("Network error while checking status"),F.current=!1;return}}F.current&&(p("failed"),C("Video generation timed out. Please try again."),F.current=!1)},[A,o,M]);(0,a.useEffect)(()=>()=>{F.current=!1},[]);let O=async()=>{p("submitting"),C(null),S(0);try{let t=await fetch("/api/talking-head/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioSignedUrl:e,imageSignedUrl:s,resolution:u})}),a=await t.json();if(!t.ok){p("failed"),C(a.error||"Failed to queue video generation");return}p("polling"),w.toast.info("Job queued. You'll be notified when it starts..."),z(a.queueItem.id)}catch{p("failed"),C("Failed to queue video generation")}},V=null!==B?I(B,u).cost:null,D="transcribing"===x?85:"burning"===x?92:Math.min(k/100*100,80);return(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(h.Video,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Generate Talking Head Video"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review your selections and generate the lip-synced video."})]}),(0,t.jsx)("div",{className:"rounded-lg bg-card p-4 space-y-3",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("img",{src:i,alt:"Selected portrait",className:"h-20 w-20 rounded-md object-cover border"}),(0,t.jsxs)("div",{className:"flex-1 space-y-1.5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-medium mb-1",children:"Audio"}),(0,t.jsx)("audio",{controls:!0,src:l,className:"w-full h-8"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-medium",children:"Script"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:n})]})]})]})}),"idle"===x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"Resolution"}),(0,t.jsxs)(T.Select,{value:u,onValueChange:m,children:[(0,t.jsx)(T.SelectTrigger,{className:"w-full",children:(0,t.jsx)(T.SelectValue,{})}),(0,t.jsxs)(T.SelectContent,{children:[(0,t.jsx)(T.SelectItem,{value:"480p",children:"480p — $0.03/sec (Recommended)"}),(0,t.jsx)(T.SelectItem,{value:"720p",children:"720p — $0.06/sec"})]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum charge: $0.15. Max duration: 10 minutes."})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ei,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(j.Label,{children:"Add Captions"})]}),(0,t.jsx)(es,{checked:A,onCheckedChange:$})]}),A&&(0,t.jsx)(e7,{settings:L,onChange:R})]}),(0,t.jsxs)("div",{className:"rounded-lg bg-card p-4 space-y-2",children:[(0,t.jsx)("p",{className:"text-xs font-medium",children:"Estimated Cost"}),null===B?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Estimating..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-end gap-1",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Duration: "}),(0,t.jsx)("span",{className:"text-xs font-medium",children:(c=Math.floor(B/60),d=Math.floor(B%60),`${c}:${d.toString().padStart(2,"0")}`)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center py-2 bg-muted/50 rounded",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground mr-2",children:"Total:"}),(0,t.jsxs)("span",{className:"text-2xl font-semibold text-green-600",children:["$",I(B,u).cost.toFixed(2)]})]}),B<5&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"⚠️ Minimum charge: $0.15 applies"})]})]})]}),("submitting"===x||"polling"===x||"transcribing"===x||"burning"===x)&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin text-accent-blue"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["submitting"===x&&"Submitting...","polling"===x&&"Generating video...","transcribing"===x&&"Transcribing audio for captions...","burning"===x&&"Burning captions into video..."]}),"polling"===x&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:[Math.round(3*k),"s elapsed"]})]}),(0,t.jsx)(ea.Progress,{value:D,className:"h-2"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["polling"===x&&k<20&&"Processing your video. This usually takes 1-3 minutes...","polling"===x&&k>=20&&k<60&&"Still processing. Longer scripts take more time...","polling"===x&&k>=60&&"Almost there. Please wait...","transcribing"===x&&"Detecting word-level timing from your TTS audio...","burning"===x&&"Rendering video with styled captions (this may take a minute)..."]})]}),"completed"===x&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-4 w-4 text-green-500"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Video generated",A?" with captions":"","!"]})]}),N&&(0,t.jsxs)(v.Alert,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v.AlertDescription,{children:N})]}),"idle"===x&&(0,t.jsxs)(r.Button,{onClick:O,className:"w-full",size:"lg",children:[(0,t.jsx)(h.Video,{className:"h-4 w-4 mr-2"}),"Generate Video",A?" with Captions":"",null!==V&&` — Est. $${V.toFixed(2)}`]}),"failed"===x&&(0,t.jsxs)(r.Button,{onClick:()=>{p("idle"),C(null),f(null),S(0)},variant:"outline",className:"w-full",children:[(0,t.jsx)(er.RefreshCw,{className:"h-4 w-4 mr-2"}),"Try Again"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Powered by WaveSpeed InfiniteTalk."})]})}var e9=e.i(40160);function te({videoUrl:e,videoAssetId:s,onSaved:i,onStartNew:l}){let[n,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),u=async()=>{o(!0),d(null);try{let t=await fetch("/api/talking-head/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:e})}),s=await t.json();if(!t.ok)return void d(s.error||"Failed to save video");w.toast.success("Video saved to asset library!"),i(s.assetId)}catch{d("Failed to save video")}finally{o(!1)}};return(0,t.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-accent-blue/10 flex items-center justify-center",children:(0,t.jsx)(p.Play,{className:"h-6 w-6 text-accent-blue"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Video Ready"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Preview your talking head video below. Download or save it to your asset library."})]}),(0,t.jsx)("div",{className:"rounded-lg overflow-hidden bg-black",children:(0,t.jsx)("video",{controls:!0,src:e,className:"w-full max-h-[500px]",autoPlay:!1,preload:"metadata"})}),c&&(0,t.jsxs)(v.Alert,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v.AlertDescription,{children:c})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",onClick:()=>{let t=document.createElement("a");t.href=e,t.download=`talking-head-${Date.now()}.mp4`,t.target="_blank",t.click()},className:"flex-1",children:[(0,t.jsx)(e9.Download,{className:"h-4 w-4 mr-2"}),"Download"]}),s?(0,t.jsxs)(r.Button,{disabled:!0,className:"flex-1",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Saved to Library"]}):(0,t.jsx)(r.Button,{onClick:u,disabled:n,className:"flex-1",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.Save,{className:"h-4 w-4 mr-2"}),"Save to Library"]})})]}),(0,t.jsxs)(r.Button,{variant:"outline",onClick:l,className:"w-full",children:[(0,t.jsx)(er.RefreshCw,{className:"h-4 w-4 mr-2"}),"Start New Video"]})]})}let tt=[{label:"Video URL",icon:g.Link2},{label:"Transcript",icon:d.FileText},{label:"Edit Script",icon:u},{label:"Voice",icon:m.Mic},{label:"Image",icon:x.ImageIcon},{label:"Generate",icon:h.Video},{label:"Preview",icon:p.Play}];function ts({aiModels:e,prefillVideoUrl:s}){let[n,d]=(0,a.useState)(1),[u,m]=(0,a.useState)(s||""),[x,h]=(0,a.useState)(""),[p,g]=(0,a.useState)(""),[f,j]=(0,a.useState)(null),[v,b]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),[k,T]=(0,a.useState)(null),[F,P]=(0,a.useState)(null),[U,I]=(0,a.useState)(null),[$,L]=(0,a.useState)(null),[R,B]=(0,a.useState)(null),[M,z]=(0,a.useState)(null),E=(0,a.useCallback)(()=>{switch(n){case 1:return x.length>0;case 2:case 3:return p.length>0;case 4:return null!==v&&null!==y;case 5:return null!==k;case 6:return null!==U;case 7:return!0;default:return!1}},[n,x,p,v,y,k,U]),O=(0,a.useCallback)(()=>{n<7&&E()&&d(e=>e+1)},[n,E]),V=(0,a.useCallback)(()=>{n>1&&d(e=>e-1)},[n]),D=(0,a.useCallback)(()=>{d(1),m(""),h(""),g(""),j(null),b(null),w(null),T(null),P(null),I(null),L(null),B(null),z(null)},[]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:tt.map((e,s)=>{let a=s+1,r=n===a,o=n>a,c=e.icon;return(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[s>0&&(0,t.jsx)("div",{className:(0,l.cn)("h-px w-4 sm:w-8",o?"bg-accent-blue":"bg-border")}),(0,t.jsxs)("button",{type:"button",onClick:()=>{o&&d(a)},disabled:!o&&!r,className:(0,l.cn)("flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-medium transition-colors whitespace-nowrap",r&&"bg-accent-blue text-white",o&&"bg-accent-blue/10 text-accent-blue hover:bg-accent-blue/20 cursor-pointer",!r&&!o&&"bg-muted text-muted-foreground cursor-default"),children:[(0,t.jsx)(c,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:e.label}),(0,t.jsx)(i.Badge,{variant:r?"secondary":"outline",className:"h-4 w-4 p-0 flex items-center justify-center text-[10px]",children:a})]})]},a)})}),(0,t.jsxs)("div",{className:"min-h-[400px]",children:[1===n&&(0,t.jsx)(N,{videoUrl:u,onVideoUrlChange:m,onTranscriptReady:e=>{h(e),g(e),d(2)}}),2===n&&(0,t.jsx)(C,{transcript:x,onUseAsScript:()=>{g(x),d(3)}}),3===n&&(0,t.jsx)(S,{script:p,onScriptChange:g}),4===n&&(0,t.jsx)(A,{script:p,aiModels:e,selectedModel:f,onModelChange:j,audioUrl:v,onAudioGenerated:(e,t)=>{b(e),w(t)}}),5===n&&(0,t.jsx)(_,{selectedModel:f,selectedImageId:F,onImageSelect:(e,t)=>{P(e),T(t)}}),6===n&&(0,t.jsx)(e8,{audioSignedUrl:y,imageSignedUrl:k,selectedImageUrl:k,audioUrl:v,script:p,onVideoReady:(e,t,s)=>{I(e),t&&L(t),s&&B(s),d(7)}}),7===n&&(0,t.jsx)(te,{videoUrl:$||U,videoAssetId:R||M,onSaved:e=>z(e),onStartNew:D})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between border-t pt-4",children:[(0,t.jsxs)(r.Button,{variant:"outline",onClick:V,disabled:1===n,children:[(0,t.jsx)(o,{className:"h-4 w-4 mr-2"}),"Back"]}),n<7&&6!==n&&(0,t.jsxs)(r.Button,{onClick:O,disabled:!E(),children:["Next",(0,t.jsx)(c.ArrowRight,{className:"h-4 w-4 ml-2"})]})]})]})}var ta=e.i(7233),tr=e.i(27612),ti=e.i(52571),tl=e.i(76639),tn=e.i(11795);function to({step:e,title:s,description:a,children:r}){return(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:e}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:s}),(0,t.jsx)(ti.Info,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:a})]})]}),r]})}function tc({aiModels:e}){let s=e.filter(e=>e.voice_id&&e.voice_id.trim()),[n,o]=(0,a.useState)(""),[c,d]=(0,a.useState)("480p"),[u,p]=(0,a.useState)(!1),[g,N]=(0,a.useState)({...eZ}),[C,S]=(0,a.useState)([{id:crypto.randomUUID(),script:"",imageId:null,imageUrl:null,status:"pending"}]),[F,U]=(0,a.useState)(!1),I=(0,a.useRef)(new Map),[A,L]=(0,a.useState)(null),[_,M]=(0,a.useState)([]),[z,E]=(0,a.useState)(0),[O,V]=(0,a.useState)(!1),[D,W]=(0,a.useState)(""),[H,J]=(0,a.useState)(!1),[G,q]=(0,a.useState)(null),Y=(0,a.useRef)(null),[X,K]=(0,a.useState)([]),[Z,Q]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(!1),er=(0,a.useRef)(null),[el,en]=(0,a.useState)(null),[eo,ec]=(0,a.useState)({...eZ}),[ed,eu]=(0,a.useState)(!1),em=s.find(e=>e.id===n)||null;(0,a.useEffect)(()=>()=>{I.current.forEach((e,t)=>I.current.set(t,!1))},[]);let ex=(e,t)=>{S(s=>s.map(s=>s.id===e?{...s,...t}:s))},eh=(0,a.useCallback)(async e=>{V(!0);let t=e?_.length:0,s=await (0,B.getAssetsAction)({file_type:"image",search:D||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:t});e?M(e=>[...e,...s.assets]):M(s.assets),E(s.total),V(!1)},[D,_.length]);(0,a.useEffect)(()=>{A&&(W(""),eh(!1))},[A]);let ep=e=>{A&&(ex(A,{imageId:e.id,imageUrl:e.signed_url}),L(null))},eg=async(e,t)=>{if(!e||!e.type.startsWith("image/"))return null;if(e.size>0x3200000)return w.toast.error("File exceeds 50MB size limit"),null;J(!0);try{let s=(0,tn.createClient)(),{data:{user:a}}=await s.auth.getUser();if(!a)return w.toast.error("Not authenticated"),null;let r=crypto.randomUUID(),i=e.name.replace(/[^a-zA-Z0-9._-]/g,"_"),l=`${a.id}/image/${r}_${i}`,{error:n}=await s.storage.from("assets").upload(l,e,{contentType:e.type,upsert:!1});if(n)return w.toast.error(`Upload failed: ${n.message}`),null;let{data:o,error:c}=await s.from("assets").insert({user_id:a.id,filename:e.name,file_path:l,file_type:"image",mime_type:e.type,file_size:e.size,tags:["talking-head","portrait"],metadata:{}}).select("id").single();if(c)return await s.storage.from("assets").remove([l]),w.toast.error(`Database error: ${c.message}`),null;let{data:d}=await s.storage.from("assets").createSignedUrl(l,3600),u={id:o.id,url:d?.signedUrl||""},m=t||A;return m&&(ex(m,{imageId:u.id,imageUrl:u.url}),t||L(null)),u}catch{return w.toast.error("Failed to upload image"),null}finally{J(!1),Y.current&&(Y.current.value="")}},ef=async e=>{let t=e.target.files?.[0];t&&await eg(t)},ej=()=>{q(null)},ev=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),q(null),F)return;let s=e.dataTransfer.files;if(!s||0===s.length)return;let a=s[0];a.type.startsWith("image/")?await eg(a,t):w.toast.error("Only image files are supported")},eb=async e=>{Q(!0);let t=(0,tn.createClient)(),{data:{user:s}}=await t.auth.getUser();if(!s){w.toast.error("Not authenticated"),Q(!1);return}let a=[];for(let t=0;t<e.length;t++){let s=e[t];if(s.type.startsWith("image/")){if(s.size>0x3200000){w.toast.error(`File "${s.name}" exceeds 50MB limit`);continue}a.push(s)}}if(0===a.length)return void Q(!1);let r=[],i=0;for(let e=0;e<a.length;e+=3){let l=a.slice(e,e+3);for(let e of(await Promise.all(l.map(async e=>{try{let a=crypto.randomUUID(),r=e.name.replace(/[^a-zA-Z0-9._-]/g,"_"),i=`${s.id}/image/${a}_${r}`,{error:l}=await t.storage.from("assets").upload(i,e,{contentType:e.type,upsert:!1});if(l)return null;let{data:n,error:o}=await t.from("assets").insert({user_id:s.id,filename:e.name,file_path:i,file_type:"image",mime_type:e.type,file_size:e.size,tags:["talking-head","portrait"],metadata:{}}).select("id").single();if(o)return await t.storage.from("assets").remove([i]),null;let{data:c}=await t.storage.from("assets").createSignedUrl(i,3600);if(!c?.signedUrl)return null;return{id:n.id,url:c.signedUrl}}catch{return null}}))))e?r.push(e):i++}r.length>0?(K(e=>[...e,...r]),w.toast.success(`${r.length} image${1===r.length?"":"s"} uploaded to pool`),i>0&&w.toast.error(`${i} image${1===i?"":"s"} failed to upload`)):w.toast.error("Failed to upload images"),Q(!1)},ey=async e=>{let t=e.target.files;t&&t.length>0&&await eb(t),er.current&&(er.current.value="")},ew=async e=>{if(e.preventDefault(),e.stopPropagation(),et(!1),F)return;let t=e.dataTransfer.files;if(!t||0===t.length)return;let s=Array.from(t).filter(e=>e.type.startsWith("image/"));0===s.length?w.toast.error("Only image files are supported"):await eb(s)},eN=(0,a.useCallback)(async(e,t,s,a)=>{ex(e,{status:"captioning"});try{let r=await fetch("/api/talking-head/transcribe-audio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioUrl:s})}),i=await r.json();if(!r.ok||!i.words?.length){let s=i.error||"No word timestamps returned";console.error("Caption transcription failed:",s),w.toast.warning(`Captions skipped: transcription failed — ${s}`),ex(e,{status:"completed",videoUrl:t});return}let l=await fetch("/api/talking-head/add-captions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:t,words:i.words,customSettings:a||g})}),n=await l.json();if(!l.ok){let s=n.error||"Unknown error";console.error("Caption burn-in failed:",s),w.toast.warning(`Captions skipped: burn-in failed — ${s}`),ex(e,{status:"completed",videoUrl:t,words:i.words});return}ex(e,{status:"completed",captionedVideoUrl:n.signedUrl,videoAssetId:n.assetId,words:i.words})}catch(a){let s=a instanceof Error?a.message:"Unknown error";console.error("Caption error:",a),w.toast.warning(`Captions skipped: ${s}`),ex(e,{status:"completed",videoUrl:t})}},[g]),eC=async()=>{if(!el)return;let e=C.find(e=>e.id===el);if(!e||!e.videoUrl||!e.words||!e.words.length){w.toast.error("Cannot re-caption: missing video or word timestamps"),en(null);return}eu(!0);try{let t=await fetch("/api/talking-head/add-captions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:e.videoUrl,words:e.words,customSettings:eo})}),s=await t.json();if(!t.ok){w.toast.error(s.error||"Failed to re-caption video"),eu(!1);return}ex(e.id,{captionedVideoUrl:s.signedUrl,videoAssetId:s.assetId}),w.toast.success("Captions updated successfully"),en(null)}catch(e){console.error("Re-caption error:",e),w.toast.error("Failed to re-caption video")}finally{eu(!1)}},ek=(0,a.useCallback)(async(e,t,s,a)=>{I.current.set(e,!0);let r=0,i=0;for(;I.current.get(e)&&r<200;){ex(e,{pollCount:++r});try{let r=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(t)}`),l=await r.json();if("completed"===l.status&&l.videoUrl){I.current.set(e,!1),s?eN(e,l.videoUrl,a):ex(e,{status:"completed",videoUrl:l.videoUrl});return}if("failed"===l.status){I.current.set(e,!1),ex(e,{status:"failed",error:l.error||"Video generation failed"});return}i=0,await new Promise(e=>setTimeout(e,5e3))}catch(t){if(i++,console.warn(`Poll error for job ${e} (attempt ${r}):`,t),i>=3){I.current.set(e,!1),ex(e,{status:"failed",error:"Network error after multiple retries"});return}await new Promise(e=>setTimeout(e,5e3))}}I.current.get(e)&&(I.current.set(e,!1),ex(e,{status:"failed",error:`Timed out after ${r} polls (${Math.round(5e3*r/1e3)}s)`}))},[eN]),eS=(0,a.useCallback)(async(e,t)=>{ex(e.id,{status:"generating_voice"});try{let s=await fetch("/api/tts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e.script,voice_id:t.voice_id,settings:t.voice_settings})});if(!s.ok){let t=await s.json().catch(()=>({error:"TTS failed"}));ex(e.id,{status:"failed",error:t.error||"TTS failed"});return}let a=await s.blob(),r=URL.createObjectURL(a);ex(e.id,{audioUrl:r}),ex(e.id,{status:"uploading_audio"});let i=new FormData;i.append("file",a,"talking-head-audio.mp3");let l=await fetch("/api/talking-head/upload-audio",{method:"POST",body:i}),n=await l.json();if(!l.ok)return void ex(e.id,{status:"failed",error:n.error||"Audio upload failed"});ex(e.id,{audioSignedUrl:n.signedUrl}),ex(e.id,{status:"submitting"});let o=await fetch("/api/talking-head/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioSignedUrl:n.signedUrl,imageSignedUrl:e.imageUrl,resolution:c})}),d=await o.json();if(!o.ok)return void ex(e.id,{status:"failed",error:d.error||"Submit failed"});ex(e.id,{status:"polling",taskId:d.taskId,pollCount:0}),ek(e.id,d.taskId,u,n.signedUrl)}catch(t){ex(e.id,{status:"failed",error:t instanceof Error?t.message:"Processing failed"})}},[c,u,ek]),eT=async()=>{if(!em)return void w.toast.error("Select an AI model first");let e=C.filter(e=>"pending"===e.status&&e.script.trim()&&!e.imageId&&!e.imageUrl);if(e.length>0){if(X.length<e.length)return void w.toast.error(`Not enough images in pool. Need ${e.length} image${1===e.length?"":"s"}, have ${X.length}. Add more images or select manually.`);let{assignedCount:t,assignedJobIds:s}=(()=>{let e=C.filter(e=>"pending"===e.status&&e.script.trim()&&!e.imageId&&!e.imageUrl);if(0===e.length||0===X.length)return{assignedCount:0,assignedJobIds:[]};let t=[...X].sort(()=>Math.random()-.5),s=Math.min(e.length,t.length),a=[],r=[];for(let i=0;i<s;i++){let s=e[i].id;a.push({id:s,imageId:t[i].id,imageUrl:t[i].url}),r.push(s)}return S(e=>e.map(e=>{let t=a.find(t=>t.id===e.id);return t?{...e,imageId:t.imageId,imageUrl:t.imageUrl}:e})),{assignedCount:s,assignedJobIds:r}})();if(0===t)return void w.toast.error("Failed to assign images from pool");await new Promise(e=>setTimeout(e,50));let a=C.filter(e=>e.script.trim()&&e.imageId&&e.imageUrl&&"pending"===e.status);if(0===a.length)return void w.toast.error("No valid jobs to process. Each needs a script and image.");for(let e of(U(!0),w.toast.info(`Starting ${a.length} video generation${a.length>1?"s":""}...`),a))eS(e,em)}else{let e=C.filter(e=>e.script.trim()&&e.imageId&&e.imageUrl&&"pending"===e.status);if(0===e.length)return void w.toast.error("No valid jobs to process. Each needs a script and image.");for(let t of(U(!0),w.toast.info(`Starting ${e.length} video generation${e.length>1?"s":""}...`),e))eS(t,em)}},eF=async(e,t)=>{try{let s=await fetch("/api/talking-head/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:t})}),a=await s.json();s.ok?(ex(e,{videoAssetId:a.assetId}),w.toast.success("Video saved to library!")):w.toast.error(a.error||"Failed to save")}catch{w.toast.error("Failed to save video")}},eP=C.filter(e=>"completed"===e.status).length,eU=C.filter(e=>"failed"===e.status).length,eI=C.filter(e=>"generating_voice"===e.status||"uploading_audio"===e.status||"submitting"===e.status||"polling"===e.status||"captioning"===e.status).length,eA=F&&0===eI,e$=C.filter(e=>"pending"===e.status&&e.script.trim()&&!e.imageId&&!e.imageUrl).length,eL=!F&&n&&C.some(e=>e.script.trim()&&(e.imageId||X.length>=e$));return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(to,{step:1,title:"Select AI Model & Resolution",description:"Choose which AI model voice to use for narration and the output video resolution. Models need voice settings configured in the AI Models page.",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"AI Model (Voice)"}),0===s.length?(0,t.jsxs)(v.Alert,{children:[(0,t.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,t.jsxs)(v.AlertDescription,{children:["No AI models with voice configured. ",(0,t.jsx)("a",{href:"/dashboard/models",className:"underline font-medium",children:"Add voice settings"})]})]}):(0,t.jsxs)(T.Select,{value:n,onValueChange:o,children:[(0,t.jsx)(T.SelectTrigger,{children:(0,t.jsx)(T.SelectValue,{placeholder:"Select AI model..."})}),(0,t.jsx)(T.SelectContent,{children:s.map(e=>(0,t.jsx)(T.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[e.reference_images.length>0?(0,t.jsx)("img",{src:e.reference_images[0].signed_url,alt:"",className:"h-5 w-5 rounded-sm object-cover"}):(0,t.jsx)(m.Mic,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.name]})},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(j.Label,{children:"Resolution"}),(0,t.jsxs)(T.Select,{value:c,onValueChange:d,children:[(0,t.jsx)(T.SelectTrigger,{children:(0,t.jsx)(T.SelectValue,{})}),(0,t.jsxs)(T.SelectContent,{children:[(0,t.jsx)(T.SelectItem,{value:"480p",children:"480p — $0.03/sec"}),(0,t.jsx)(T.SelectItem,{value:"720p",children:"720p — $0.06/sec"})]})]})]})]})}),(0,t.jsx)(to,{step:2,title:"Captions (Optional)",description:"Add auto-synced captions to your videos. Choose from TikTok-style presets or customize the look.",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ei,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(j.Label,{children:"Add Captions"})]}),(0,t.jsx)(es,{checked:u,onCheckedChange:p,disabled:F})]}),u&&!F&&(0,t.jsx)(e7,{settings:g,onChange:N})]})}),(0,t.jsx)(to,{step:3,title:"Upload Images",description:"Upload portrait images for your videos. Images are randomly assigned to scripts that don't have a manually selected image.",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.Label,{className:"text-base",children:"Bulk Image Pool"}),X.length>0&&(0,t.jsx)("button",{type:"button",onClick:()=>{K([])},className:"text-xs text-muted-foreground hover:text-destructive transition-colors",children:"Clear All"})]}),(0,t.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),F||et(!0)},onDragLeave:()=>{et(!1)},onDrop:ew,className:(0,l.cn)("border-2 border-dashed rounded-lg p-4 transition-all",ee?"border-accent-blue bg-accent-blue/5":"hover:border-accent-blue/50",F?"opacity-50 pointer-events-none":""),children:[(0,t.jsx)("input",{ref:er,type:"file",accept:"image/*",multiple:!0,onChange:ey,className:"hidden"}),0===X.length?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center gap-2 text-muted-foreground",children:Z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("p",{className:"text-sm",children:"Uploading images..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.Upload,{className:"h-8 w-8"}),(0,t.jsx)("p",{className:"text-sm",children:"Drop images here or click to browse"})]})}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[X.length," image",1===X.length?"":"s"," in pool (randomly assigned to videos without images)"]}),(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:X.map(e=>(0,t.jsxs)("div",{className:"relative group flex-shrink-0",children:[(0,t.jsx)("img",{src:e.url,alt:"",className:"h-16 w-16 rounded-md object-cover border"}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void K(e=>e.filter(e=>e.id!==t))},className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(eY.X,{className:"h-3 w-3"})})]},e.id))}),(0,t.jsxs)("div",{onClick:()=>er.current?.click(),className:"border border-dashed rounded-md px-3 py-1 text-xs text-muted-foreground hover:text-accent-blue cursor-pointer inline-flex items-center gap-1 w-fit",children:[(0,t.jsx)(ta.Plus,{className:"h-3 w-3"})," Add more"]})]})]})]})}),(0,t.jsx)(to,{step:4,title:"Add Scripts",description:"Add one or more scripts. Each script becomes a separate video. You can manually assign images or let the pool handle it.",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(j.Label,{className:"text-base",children:["Videos (",C.length,")"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{S(e=>[...e,{id:crypto.randomUUID(),script:"",imageId:null,imageUrl:null,status:"pending"}])},disabled:F,children:[(0,t.jsx)(ta.Plus,{className:"h-4 w-4 mr-1.5"}),"Add Video"]})]}),C.map((e,s)=>(0,t.jsxs)("div",{className:(0,l.cn)("rounded-lg p-4 space-y-3","completed"===e.status&&"border border-green-500 bg-green-500/5","failed"===e.status&&"border border-destructive bg-destructive/5"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Video ",s+1]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(td,{status:e.status,pollCount:e.pollCount}),!F&&C.length>1&&(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void(!(C.length<=1)&&(I.current.set(t,!1),S(e=>e.filter(e=>e.id!==t))))},className:"h-7 w-7 p-0",children:(0,t.jsx)(tr.Trash2,{className:"h-3.5 w-3.5"})})]})]}),"pending"===e.status&&(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Script"}),(0,t.jsx)(k.Textarea,{value:e.script,onChange:t=>ex(e.id,{script:t.target.value}),placeholder:"Paste the script for this video...",rows:4,className:"resize-y text-sm",disabled:F}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.script.trim().split(/\s+/).filter(Boolean).length," words"]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",onDragOver:t=>{var s;return s=e.id,void(t.preventDefault(),t.stopPropagation(),!F&&q(s))},onDragLeave:ej,onDrop:t=>ev(t,e.id),children:[(0,t.jsx)(j.Label,{className:"text-xs",children:"Portrait"}),e.imageUrl?(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:e.imageUrl,alt:"Selected",className:(0,l.cn)("h-[106px] w-[106px] rounded-md object-cover border cursor-pointer",G===e.id?"ring-2 ring-accent-blue ring-offset-2":""),onClick:()=>!F&&L(e.id)}),!F&&(0,t.jsx)("button",{type:"button",onClick:()=>ex(e.id,{imageId:null,imageUrl:null}),className:"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(eY.X,{className:"h-3 w-3"})})]}):(0,t.jsxs)("button",{type:"button",onClick:()=>L(e.id),disabled:F,className:(0,l.cn)("h-[106px] w-[106px] rounded-md border-2 border-dashed flex flex-col items-center justify-center gap-1 text-muted-foreground transition-colors",G===e.id?"border-accent-blue bg-accent-blue/10":"hover:border-accent-blue/50 hover:text-accent-blue"),children:[(0,t.jsx)(x.ImageIcon,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:G===e.id?"Drop image":"Select"})]})]})]}),"pending"!==e.status&&"completed"!==e.status&&"failed"!==e.status&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Loader2,{className:"h-3.5 w-3.5 animate-spin text-accent-blue"}),(0,t.jsxs)("span",{className:"text-xs",children:["generating_voice"===e.status&&"Generating voice...","uploading_audio"===e.status&&"Uploading audio...","submitting"===e.status&&"Submitting video job...","polling"===e.status&&`Generating video... ${Math.round(3*(e.pollCount||0))}s`,"captioning"===e.status&&"Adding captions..."]})]}),"polling"===e.status&&(0,t.jsx)(ea.Progress,{value:Math.min((e.pollCount||0)/200*100,95),className:"h-1.5"})]}),"failed"===e.status&&e.error&&(0,t.jsx)("p",{className:"text-xs text-destructive",children:e.error}),"completed"===e.status&&(e.captionedVideoUrl||e.videoUrl)&&(0,t.jsxs)("div",{className:"space-y-2",children:[e.captionedVideoUrl&&(0,t.jsxs)(i.Badge,{variant:"secondary",className:"gap-1 text-xs mb-1",children:[(0,t.jsx)(ei,{className:"h-3 w-3"}),"Captioned"]}),(0,t.jsx)("video",{controls:!0,src:e.captionedVideoUrl||e.videoUrl,className:"w-full max-h-[200px] rounded-md bg-black",preload:"metadata"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{let t=document.createElement("a");t.href=e.captionedVideoUrl||e.videoUrl,t.download=`talking-head-${s+1}.mp4`,t.target="_blank",t.click()},children:[(0,t.jsx)(e9.Download,{className:"h-3.5 w-3.5 mr-1"}),"Download"]}),e.words&&e.words.length>0&&e.videoUrl&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{en(e.id),ec({...eZ})},children:[(0,t.jsx)(ei,{className:"h-3.5 w-3.5 mr-1"}),"Re-caption"]}),e.videoAssetId?(0,t.jsxs)(i.Badge,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-3 w-3"}),"Saved"]}):(0,t.jsxs)(r.Button,{size:"sm",onClick:()=>eF(e.id,e.captionedVideoUrl||e.videoUrl),children:[(0,t.jsx)(eX.Save,{className:"h-3.5 w-3.5 mr-1"}),"Save to Library"]})]})]})]},e.id))]})}),F&&(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[eI>0&&(0,t.jsxs)(i.Badge,{variant:"secondary",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),eI," processing"]}),eP>0&&(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-green-600",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-3 w-3 mr-1"}),eP," completed"]}),eU>0&&(0,t.jsxs)(i.Badge,{variant:"destructive",children:[(0,t.jsx)(y.AlertCircle,{className:"h-3 w-3 mr-1"}),eU," failed"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{onClick:eT,disabled:!eL,size:"lg",className:"flex-1",children:[(0,t.jsx)(h.Video,{className:"h-4 w-4 mr-2"}),F?eA?"All Done":`Processing ${eI} video${1!==eI?"s":""}...`:`Generate ${C.filter(e=>e.script.trim()&&(e.imageId||X.length)).length} Video${e$>0?` (${e$} from pool)`:""}`]}),eA&&(0,t.jsx)(r.Button,{variant:"outline",size:"lg",onClick:()=>{U(!1),S([{id:crypto.randomUUID(),script:"",imageId:null,imageUrl:null,status:"pending"}])},children:"Start New Batch"})]}),(0,t.jsx)(tl.Dialog,{open:null!==A,onOpenChange:e=>!e&&L(null),children:(0,t.jsxs)(tl.DialogContent,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[(0,t.jsx)(tl.DialogHeader,{children:(0,t.jsx)(tl.DialogTitle,{children:"Select Portrait Image"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)($.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(f.Input,{placeholder:"Search images...",value:D,onChange:e=>{let t;return W(e.target.value),t=setTimeout(()=>eh(!1),300),()=>clearTimeout(t)},className:"pl-9"})]}),(0,t.jsx)("input",{ref:Y,type:"file",accept:"image/*",onChange:ef,className:"hidden"}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>Y.current?.click(),disabled:H,children:[H?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,t.jsx)(R.Upload,{className:"h-4 w-4 mr-1"}),"Upload"]})]}),em&&em.reference_images.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-xs font-medium mb-1.5",children:[em.name,"'s Reference Images"]}),(0,t.jsx)("div",{className:"flex gap-1.5 overflow-x-auto pb-1",children:em.reference_images.map(e=>(0,t.jsx)("button",{type:"button",className:"h-14 w-14 rounded-md overflow-hidden border-2 border-transparent hover:border-accent-blue/50 transition-all flex-shrink-0",onClick:()=>ep(e),children:(0,t.jsx)("img",{src:e.signed_url,alt:"",className:"h-full w-full object-cover"})},e.id))})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto min-h-0",children:[0!==_.length||O?(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-2 pb-2",children:_.map(e=>(0,t.jsx)("button",{type:"button",className:"relative aspect-square overflow-hidden rounded-md border-2 border-transparent hover:border-accent-blue/50 transition-all",onClick:()=>ep(e),children:(0,t.jsx)("img",{src:e.signed_url,alt:e.filename,className:"h-full w-full object-cover",loading:"lazy"})},e.id))}):(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No images found."})}),_.length<z&&(0,t.jsx)("div",{className:"flex justify-center py-2",children:(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>eh(!0),disabled:O,children:O?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})})]}),A&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click an image to select it for this video. Uploaded images are auto-saved to your asset library."})]})}),(0,t.jsx)(tl.Dialog,{open:null!==el,onOpenChange:e=>!e&&en(null),children:(0,t.jsxs)(tl.DialogContent,{className:"max-w-lg",children:[(0,t.jsx)(tl.DialogHeader,{children:(0,t.jsx)(tl.DialogTitle,{children:"Re-caption Video"})}),(0,t.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose new caption styles. This will regenerate the captioned video with your new settings."}),(0,t.jsx)(e7,{settings:eo,onChange:ec}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end pt-2",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>en(null),disabled:ed,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:eC,disabled:ed,children:[ed?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(ei,{className:"h-4 w-4 mr-2"}),ed?"Recaptioning...":"Apply New Captions"]})]})]})]})})]})}function td({status:e,pollCount:s}){switch(e){case"pending":return(0,t.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:"Pending"});case"generating_voice":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 animate-spin"}),"Voice"]});case"uploading_audio":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 animate-spin"}),"Upload"]});case"submitting":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 animate-spin"}),"Submit"]});case"polling":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 animate-spin"}),Math.round(3*(s||0)),"s"]});case"captioning":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,t.jsx)(b.Loader2,{className:"h-3 w-3 animate-spin"}),"Captions"]});case"completed":return(0,t.jsxs)(i.Badge,{variant:"secondary",className:"text-xs gap-1 text-green-600",children:[(0,t.jsx)(P.CheckCircle2,{className:"h-3 w-3"}),"Done"]});case"failed":return(0,t.jsxs)(i.Badge,{variant:"destructive",className:"text-xs gap-1",children:[(0,t.jsx)(y.AlertCircle,{className:"h-3 w-3"}),"Failed"]})}}var tu=e.i(52008);function tm({aiModels:e,prefillVideoUrl:a}){return(0,t.jsxs)(s.Tabs,{defaultValue:"single",className:"space-y-4",children:[(0,t.jsxs)(s.TabsList,{children:[(0,t.jsxs)(s.TabsTrigger,{value:"single",className:"gap-1.5",children:[(0,t.jsx)(h.Video,{className:"h-3.5 w-3.5"}),"Single Video"]}),(0,t.jsxs)(s.TabsTrigger,{value:"bulk",className:"gap-1.5",children:[(0,t.jsx)(tu.Layers,{className:"h-3.5 w-3.5"}),"Bulk Generate"]})]}),(0,t.jsx)(s.TabsContent,{value:"single",children:(0,t.jsx)(ts,{aiModels:e,prefillVideoUrl:a})}),(0,t.jsx)(s.TabsContent,{value:"bulk",children:(0,t.jsx)(tc,{aiModels:e})})]})}e.s(["TalkingHeadTabs",()=>tm],76493)}]);