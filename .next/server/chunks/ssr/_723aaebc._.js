module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},3006,a=>{"use strict";var b=a.i(16349);let c="assets";async function d(a){let d=await (0,b.createClient)(),{data:e,error:f}=await d.storage.from(c).createSignedUrl(a,3600);if(f)throw Error(`Failed to create signed URL: ${f.message}`);return e.signedUrl}async function e(a){let d=await (0,b.createClient)(),{error:e}=await d.storage.from(c).remove([a]);if(e)throw Error(`Failed to delete file: ${e.message}`)}a.s(["deleteStorageFile",()=>e,"getSignedUrl",()=>d])},35113,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(3006);async function f(a,b,c){if(0===c.length)return[];let{data:d}=await a.from("assets").select("*").in("id",c).eq("user_id",b);if(!d||0===d.length)return[];let f=new Map((await Promise.all(d.map(async a=>{try{let b=await (0,e.getSignedUrl)(a.file_path);return{...a,signed_url:b}}catch{return{...a,signed_url:""}}}))).map(a=>[a.id,a]));return c.map(a=>f.get(a)).filter(Boolean)}async function g(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return{models:[],error:"Not authenticated"};let{data:c,error:e}=await a.from("ai_models").select("*").eq("user_id",b.id).order("created_at",{ascending:!1});if(e)return{models:[],error:e.message};return{models:await Promise.all((c||[]).map(async c=>{let d=await f(a,b.id,c.reference_image_ids);return{...c,reference_images:d}}))}}catch(a){return{models:[],error:a instanceof Error?a.message:"Failed to fetch models"}}}async function h(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{model:null,error:"Not authenticated"};let{data:e,error:g}=await b.from("ai_models").select("*").eq("id",a).eq("user_id",c.id).single();if(g)return{model:null,error:g.message};let h=await f(b,c.id,e.reference_image_ids);return{model:{...e,reference_images:h}}}catch(a){return{model:null,error:a instanceof Error?a.message:"Failed to fetch model"}}}async function i(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};if(!a.name.trim())return{success:!1,error:"Name is required"};if(a.reference_image_ids.length>0){let{data:c}=await b.from("assets").select("id").in("id",a.reference_image_ids).eq("user_id",e.id),d=new Set((c||[]).map(a=>a.id));a.reference_image_ids=a.reference_image_ids.filter(a=>d.has(a))}let{data:f,error:g}=await b.from("ai_models").insert({user_id:e.id,name:a.name.trim(),description:a.description.trim(),voice_id:a.voice_id.trim(),voice_settings:a.voice_settings,reference_image_ids:a.reference_image_ids}).select("id").single();if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/models"),{success:!0,modelId:f.id}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to create model"}}}async function j(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};if(!b.name.trim())return{success:!1,error:"Name is required"};if(b.reference_image_ids.length>0){let{data:a}=await e.from("assets").select("id").in("id",b.reference_image_ids).eq("user_id",f.id),c=new Set((a||[]).map(a=>a.id));b.reference_image_ids=b.reference_image_ids.filter(a=>c.has(a))}let{error:g}=await e.from("ai_models").update({name:b.name.trim(),description:b.description.trim(),voice_id:b.voice_id.trim(),voice_settings:b.voice_settings,reference_image_ids:b.reference_image_ids}).eq("id",a).eq("user_id",f.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/models"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update model"}}}async function k(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{error:f}=await b.from("ai_models").delete().eq("id",a).eq("user_id",e.id);if(f)return{success:!1,error:f.message};return(0,c.revalidatePath)("/dashboard/models"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete model"}}}async function l(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{data:f}=await b.from("ai_models").select("is_active").eq("id",a).eq("user_id",e.id).single();if(!f)return{success:!1,error:"Model not found"};let{error:g}=await b.from("ai_models").update({is_active:!f.is_active}).eq("id",a).eq("user_id",e.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/models"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to toggle model status"}}}(0,a.i(13095).ensureServerEntryExports)([g,h,i,j,k,l]),(0,b.registerServerReference)(g,"00daf52c11f2eafb32fbc5c1eb4185448d8497a782",null),(0,b.registerServerReference)(h,"405cfc2af01e2d19d080c1147fcdb2e003d8c4b87f",null),(0,b.registerServerReference)(i,"40a12f5381cb8fa9c0774270bbd644b7eeb489d194",null),(0,b.registerServerReference)(j,"605196c9e523bbfc5703794187d894c25dca1bcbd7",null),(0,b.registerServerReference)(k,"4004454e18a9865c0fd1f4ee66dbff7625eac79992",null),(0,b.registerServerReference)(l,"40a63ee65ce74884b7964547b99c47cc0aab018fe1",null),a.s(["createModelAction",()=>i,"deleteModelAction",()=>k,"getModelAction",()=>h,"getModelsAction",()=>g,"toggleModelActiveAction",()=>l,"updateModelAction",()=>j])},73370,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(3006);async function f(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{assets:[],total:0,error:"Not authenticated"};let f=b.from("assets").select("*",{count:"exact"}).eq("user_id",c.id);if(a?.file_type&&(f=f.eq("file_type",a.file_type)),a?.is_favorite!==void 0&&(f=f.eq("is_favorite",a.is_favorite)),a?.tags&&a.tags.length>0&&(f=f.contains("tags",a.tags)),a?.search&&(f=f.ilike("filename",`%${a.search}%`)),a?.ai_model_id!==void 0&&(f=null===a.ai_model_id?f.is("ai_model_id",null):f.eq("ai_model_id",a.ai_model_id)),a?.ids){let b=a.ids.split(",");f=f.in("id",b)}let g=a?.sort_by||"created_at",h=a?.sort_order||"desc";f=f.order(g,{ascending:"asc"===h});let i=a?.limit||24,j=a?.offset||0;f=f.range(j,j+i-1);let{data:k,error:l,count:m}=await f;if(l)return{assets:[],total:0,error:l.message};return{assets:await Promise.all((k||[]).map(async a=>{try{let b=await (0,e.getSignedUrl)(a.file_path);return{...a,signed_url:b}}catch{return{...a,signed_url:""}}})),total:m||0}}catch(a){return{assets:[],total:0,error:a instanceof Error?a.message:"Failed to fetch assets"}}}async function g(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{data:f}=await b.from("assets").select("is_favorite").eq("id",a).eq("user_id",e.id).single();if(!f)return{success:!1,error:"Asset not found"};let{error:g}=await b.from("assets").update({is_favorite:!f.is_favorite}).eq("id",a).eq("user_id",e.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to toggle favorite"}}}async function h(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};let{error:g}=await e.from("assets").update({tags:b}).eq("id",a).eq("user_id",f.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update tags"}}}async function i(a){try{let b=await (0,d.createClient)(),{data:{user:f}}=await b.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};let{data:g}=await b.from("assets").select("file_path").eq("id",a).eq("user_id",f.id).single();if(!g)return{success:!1,error:"Asset not found"};try{await (0,e.deleteStorageFile)(g.file_path)}catch{console.error("Failed to delete storage file:",g.file_path)}let{error:h}=await b.from("assets").delete().eq("id",a).eq("user_id",f.id);if(h)return{success:!1,error:h.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete asset"}}}async function j(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return[];let{data:c}=await a.from("assets").select("tags").eq("user_id",b.id);if(!c)return[];let e=c.flatMap(a=>a.tags||[]);return[...new Set(e)].sort()}catch{return[]}}async function k(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,deletedCount:0,error:"Not authenticated"};if(0===a.length)return{success:!1,deletedCount:0,error:"No assets specified"};let{data:f}=await b.from("assets").select("id, file_path").in("id",a).eq("user_id",e.id);if(!f||0===f.length)return{success:!1,deletedCount:0,error:"No assets found"};let g=f.map(a=>a.file_path);try{await b.storage.from("assets").remove(g)}catch{console.error("Failed to batch-delete storage files")}let h=f.map(a=>a.id),{error:i}=await b.from("assets").delete().in("id",h).eq("user_id",e.id);if(i)return{success:!1,deletedCount:0,error:i.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0,deletedCount:h.length}}catch(a){return{success:!1,deletedCount:0,error:a instanceof Error?a.message:"Failed to bulk delete assets"}}}async function l(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};if(0===a.length)return{success:!1,error:"No assets specified"};if(b){let{data:a}=await e.from("ai_models").select("id").eq("id",b).eq("user_id",f.id).single();if(!a)return{success:!1,error:"Model not found"}}let{error:g}=await e.from("assets").update({ai_model_id:b}).in("id",a).eq("user_id",f.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to assign model to assets"}}}async function m(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{urls:[],error:"Not authenticated"};if(0===a.length)return{urls:[],error:"No assets specified"};let{data:f}=await b.from("assets").select("id, filename, file_path").in("id",a).eq("user_id",c.id);if(!f||0===f.length)return{urls:[],error:"No assets found"};return{urls:(await Promise.all(f.map(async a=>{try{let b=await (0,e.getSignedUrl)(a.file_path);return{id:a.id,filename:a.filename,url:b}}catch{return{id:a.id,filename:a.filename,url:""}}}))).filter(a=>a.url)}}catch(a){return{urls:[],error:a instanceof Error?a.message:"Failed to get download URLs"}}}async function n(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return{models:[],error:"Not authenticated"};let{data:c,error:e}=await a.from("ai_models").select("id, name").eq("user_id",b.id).eq("is_active",!0).order("name",{ascending:!0});if(e)return{models:[],error:e.message};return{models:c||[]}}catch(a){return{models:[],error:a instanceof Error?a.message:"Failed to fetch models"}}}(0,a.i(13095).ensureServerEntryExports)([f,g,h,i,j,k,l,m,n]),(0,b.registerServerReference)(f,"40053fe9a2f7c6e98c710addb551de7b067aafee8f",null),(0,b.registerServerReference)(g,"400f9cd13317e2cd5ffcd01c986e487acfed902af0",null),(0,b.registerServerReference)(h,"602e1c845f8630f5f412531edc4cf883cf93a23a97",null),(0,b.registerServerReference)(i,"401a61d277e1e8de37b642ff39d23bca1ab85e7ae1",null),(0,b.registerServerReference)(j,"00e62f429024c16383a5ef0f4854051bd69a26996f",null),(0,b.registerServerReference)(k,"40b258e326f20bb2dbc968a496bcf015cdae5e7353",null),(0,b.registerServerReference)(l,"607eee48e074499ac9911884e2acd0c8a36b9c8806",null),(0,b.registerServerReference)(m,"4066e82f12aa11473234b4a7222a4f5877a074ce8b",null),(0,b.registerServerReference)(n,"00dbb8c71377858bf5f6437fd9bbf73a69066a70b9",null),a.s(["bulkAssignModelAction",()=>l,"bulkDeleteAssetsAction",()=>k,"deleteAssetAction",()=>i,"getAssetsAction",()=>f,"getModelsListAction",()=>n,"getSignedUrlsAction",()=>m,"getUserTagsAction",()=>j,"toggleFavoriteAction",()=>g,"updateTagsAction",()=>h])},80422,a=>{"use strict";var b=a.i(73370),c=a.i(35113);a.s([],57478),a.i(57478),a.s(["00daf52c11f2eafb32fbc5c1eb4185448d8497a782",()=>c.getModelsAction,"4004454e18a9865c0fd1f4ee66dbff7625eac79992",()=>c.deleteModelAction,"40053fe9a2f7c6e98c710addb551de7b067aafee8f",()=>b.getAssetsAction,"405cfc2af01e2d19d080c1147fcdb2e003d8c4b87f",()=>c.getModelAction,"40a12f5381cb8fa9c0774270bbd644b7eeb489d194",()=>c.createModelAction,"40a63ee65ce74884b7964547b99c47cc0aab018fe1",()=>c.toggleModelActiveAction,"605196c9e523bbfc5703794187d894c25dca1bcbd7",()=>c.updateModelAction],80422)}];

//# sourceMappingURL=_723aaebc._.js.map