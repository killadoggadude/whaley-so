module.exports=[97978,a=>{"use strict";var b=a.i(87924),c=a.i(75083),d=a.i(72131),e=a.i(99570),f=a.i(29246),g=a.i(70430),h=a.i(86304),i=a.i(66718),j=a.i(24348),k=a.i(73390),l=a.i(96221),m=a.i(16686),n=a.i(92e3),o=a.i(67453),p=a.i(69520),q=a.i(73320),r=a.i(87532),s=a.i(84505),t=a.i(14548),u=a.i(33441),v=a.i(41710),w=a.i(68114),x=a.i(23292),y=a.i(50558),z=a.i(95445);let A="natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion";function B({aiModels:a}){let[c,B]=(0,d.useState)([]),[C,D]=(0,d.useState)(0),[E,F]=(0,d.useState)(!1),[G,H]=(0,d.useState)(""),[I,J]=(0,d.useState)(!1),[K,L]=(0,d.useState)(!1),M=(0,d.useRef)(null),[N,O]=(0,d.useState)(null),[P,Q]=(0,d.useState)(null),[R,S]=(0,d.useState)(""),[T,U]=(0,d.useState)(A),[V,W]=(0,d.useState)(5),[X,Y]=(0,d.useState)("idle"),[Z,$]=(0,d.useState)(null),[_,aa]=(0,d.useState)(0),[ab,ac]=(0,d.useState)(null),[ad,ae]=(0,d.useState)(null),[af,ag]=(0,d.useState)(!1),ah=(0,d.useRef)(!1),ai=a.find(a=>a.id===R)||null,aj=ai?.reference_images||[],ak=aj.length>0,al=(0,d.useCallback)(async a=>{F(!0);let b=a?c.length:0,d=await (0,y.getAssetsAction)({file_type:"image",search:G||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:b});a?B(a=>[...a,...d.assets]):B(d.assets),D(d.total),F(!1)},[G,c.length]);(0,d.useEffect)(()=>{al(!1)},[]);let am=async a=>{let b=a.target.files?.[0];if(b){if(!b.type.startsWith("image/"))return void x.toast.error("Please select an image file");if(b.size>0x3200000)return void x.toast.error("File exceeds 50MB size limit");L(!0);try{let a=(0,z.createClient)(),{data:{user:c}}=await a.auth.getUser();if(!c)return void x.toast.error("Not authenticated");let d=crypto.randomUUID(),e=b.name.replace(/[^a-zA-Z0-9._-]/g,"_"),f=`${c.id}/image/${d}_${e}`,{error:g}=await a.storage.from("assets").upload(f,b,{contentType:b.type,upsert:!1});if(g)return void x.toast.error(`Upload failed: ${g.message}`);let{data:h,error:i}=await a.from("assets").insert({user_id:c.id,filename:b.name,file_path:f,file_type:"image",mime_type:b.type,file_size:b.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(i){await a.storage.from("assets").remove([f]),x.toast.error(`Database error: ${i.message}`);return}let{data:j}=await a.storage.from("assets").createSignedUrl(f,3600);j?.signedUrl&&(O(h.id),Q(j.signedUrl),x.toast.success("Image uploaded!"),al(!1))}catch{x.toast.error("Failed to upload image")}finally{L(!1),M.current&&(M.current.value="")}}};(0,d.useEffect)(()=>()=>{ah.current=!1},[]);let an=(0,d.useCallback)(async a=>{ah.current=!0;let b=0,c=0;for(;ah.current&&b<200;){aa(++b);try{let b=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(a)}`),d=await b.json();if("completed"===d.status&&d.videoUrl){ah.current=!1,ac(d.videoUrl),Y("completed"),x.toast.success("Dancing reel generated!");return}if("failed"===d.status){ah.current=!1,Y("failed"),$(d.error||"Video generation failed");return}c=0,await new Promise(a=>setTimeout(a,5e3))}catch{if(++c>=3){ah.current=!1,Y("failed"),$("Network error after multiple retries");return}await new Promise(a=>setTimeout(a,5e3))}}ah.current&&(ah.current=!1,Y("failed"),$(`Timed out after ${b} polls (~${Math.round(5e3*b/1e3)}s)`))},[]),ao=async()=>{if(!P)return void x.toast.error("Select an image first");if(!T.trim())return void x.toast.error("Enter a prompt");Y("submitting"),$(null),aa(0),ac(null),ae(null);try{let a=await fetch("/api/dancing-reel/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:P,prompt:T.trim(),duration:V})}),b=await a.json();if(!a.ok){Y("failed"),$(b.error||"Failed to submit dancing reel generation");return}Y("polling"),x.toast.info("Dancing reel generation started..."),an(b.taskId)}catch{Y("failed"),$("Failed to submit dancing reel generation")}},ap=async()=>{if(ab){ag(!0);try{let a=await fetch("/api/dancing-reel/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:ab})}),b=await a.json();a.ok?(ae(b.assetId),x.toast.success("Video saved to library!")):x.toast.error(b.error||"Failed to save")}catch{x.toast.error("Failed to save video")}finally{ag(!1)}}},aq=()=>{Y("idle"),$(null),aa(0),ac(null),ae(null),ah.current=!1},ar=!I&&ak?aj:c,as="submitting"===X||"polling"===X,at=Math.min(_/200*100,95),au=5===V?.35:.7;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"1"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"text-base font-semibold",children:"Select Image"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Choose a portrait image (ideally 9:16 aspect ratio) to animate into a dancing video."})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[a.length>0&&(0,b.jsxs)("select",{value:R,onChange:a=>{S(a.target.value),J(!a.target.value)},className:"h-9 rounded-md border border-input bg-background px-3 text-sm",children:[(0,b.jsx)("option",{value:"",children:"All Images"}),a.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.reference_images.length,")"]},a.id))]}),(0,b.jsxs)("div",{className:"ml-auto",children:[(0,b.jsx)("input",{ref:M,type:"file",accept:"image/*",onChange:am,className:"hidden"}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>M.current?.click(),disabled:K||as,children:[K?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 mr-1.5 animate-spin"}):(0,b.jsx)(q.Upload,{className:"h-4 w-4 mr-1.5"}),K?"Uploading...":"Upload Image"]})]})]}),(I||!ak)&&(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(r.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(i.Input,{placeholder:"Search images...",value:G,onChange:a=>{let b;return H(a.target.value),b=setTimeout(()=>al(!1),300),()=>clearTimeout(b)},className:"pl-9"})]}),0!==ar.length||E?(0,b.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2",children:ar.map(a=>{let c=N===a.id;return(0,b.jsxs)("button",{type:"button",disabled:as,className:(0,w.cn)("relative aspect-[9/16] overflow-hidden rounded-md border-2 transition-all",c?"border-accent-blue ring-2 ring-accent-blue/20":"border-transparent hover:border-muted-foreground/30",as&&"opacity-50 pointer-events-none"),onClick:()=>{var b,c;return b=a.id,c=a.signed_url,void(O(b),Q(c))},children:[(0,b.jsx)("img",{src:a.signed_url,alt:a.filename,className:"h-full w-full object-cover",loading:"lazy"}),c&&(0,b.jsx)("div",{className:"absolute inset-0 bg-accent-blue/20 flex items-center justify-center",children:(0,b.jsx)("div",{className:"h-6 w-6 rounded-full bg-accent-blue flex items-center justify-center",children:(0,b.jsx)(u.Check,{className:"h-4 w-4 text-primary-foreground"})})})]},a.id)})}):(0,b.jsx)("div",{className:"flex flex-col items-center justify-center py-8",children:(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["No images found. Upload an image above or add images in the"," ",(0,b.jsx)("a",{href:"/dashboard/assets",className:"underline font-medium",children:"Asset Library"}),"."]})}),(I||!ak)&&c.length<C&&(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>al(!0),disabled:E,children:E?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})}),N&&(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(h.Badge,{variant:"secondary",className:"gap-1",children:[(0,b.jsx)(u.Check,{className:"h-3 w-3"}),"Image selected"]})})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"2"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"text-base font-semibold",children:"Prompt & Settings"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Customize the dance prompt and choose video duration. The default prompt works well for most cases."})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(g.Label,{children:"Dance Prompt"}),(0,b.jsx)(f.Textarea,{value:T,onChange:a=>U(a.target.value),placeholder:"Describe the dancing motion...",rows:4,className:"resize-y text-sm",disabled:as}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[T.trim().split(/\s+/).filter(Boolean).length," words"]}),T!==A&&(0,b.jsx)("button",{type:"button",onClick:()=>U(A),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",disabled:as,children:"Reset to default"})]})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(g.Label,{children:"Duration"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:5===V?"default":"outline",size:"sm",onClick:()=>W(5),disabled:as,className:"flex-1",children:[(0,b.jsx)(v.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"5 seconds (~$0.35)"]}),(0,b.jsxs)(e.Button,{variant:10===V?"default":"outline",size:"sm",onClick:()=>W(10),disabled:as,className:"flex-1",children:[(0,b.jsx)(v.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"10 seconds (~$0.70)"]})]})]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:"3"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"text-base font-semibold",children:"Generate"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Generate the dancing reel video. This typically takes 2-5 minutes."})]})]}),as&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin text-accent-blue"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:["submitting"===X&&"Submitting to Kling 2.6 Pro...","polling"===X&&"Generating dancing video..."]}),"polling"===X&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:[Math.round(5*_),"s elapsed"]})]}),(0,b.jsx)(k.Progress,{value:at,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["polling"===X&&_<20&&"Processing your video. This usually takes 2-5 minutes...","polling"===X&&_>=20&&_<60&&"Still processing. Kling 2.6 Pro generates high-quality output...","polling"===X&&_>=60&&"Almost there. Please wait..."]})]}),"completed"===X&&ab&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-4 w-4 text-green-500"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Dancing reel generated!"})]}),(0,b.jsx)("video",{controls:!0,src:ab,className:"w-full max-h-[400px] rounded-md bg-black",preload:"metadata"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{let a=document.createElement("a");a.href=ab,a.download=`dancing-reel-${V}s.mp4`,a.target="_blank",a.click()},children:[(0,b.jsx)(s.Download,{className:"h-3.5 w-3.5 mr-1"}),"Download"]}),ad?(0,b.jsxs)(h.Badge,{variant:"secondary",className:"gap-1",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3"}),"Saved"]}):(0,b.jsxs)(e.Button,{size:"sm",onClick:ap,disabled:af,children:[af?(0,b.jsx)(l.Loader2,{className:"h-3.5 w-3.5 mr-1 animate-spin"}):(0,b.jsx)(t.Save,{className:"h-3.5 w-3.5 mr-1"}),af?"Saving...":"Save to Library"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:aq,children:[(0,b.jsx)(p.RefreshCw,{className:"h-3.5 w-3.5 mr-1"}),"New Video"]})]})]}),Z&&(0,b.jsxs)(j.Alert,{variant:"destructive",children:[(0,b.jsx)(n.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(j.AlertDescription,{children:Z})]}),"idle"===X&&(0,b.jsxs)(e.Button,{onClick:ao,className:"w-full",size:"lg",disabled:!N||!T.trim(),children:[(0,b.jsx)(m.Music,{className:"h-4 w-4 mr-2"}),"Generate Dancing Reel (",V,"s) — Est. $",au.toFixed(2)]}),"failed"===X&&(0,b.jsxs)(e.Button,{onClick:aq,variant:"outline",className:"w-full",children:[(0,b.jsx)(p.RefreshCw,{className:"h-4 w-4 mr-2"}),"Try Again"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Powered by WaveSpeed Kling 2.6 Pro Image-to-Video. Sound is disabled (add music in post)."})]})]})}var C=a.i(14574),D=a.i(15618),E=a.i(81560),F=a.i(79165),G=a.i(33508),H=a.i(97063);let I="natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion";function J({step:a,title:c,description:d,children:e}){return(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold",children:a}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{className:"text-base font-semibold",children:c}),(0,b.jsx)(H.Info,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:d})]})]}),e]})}function K({aiModels:a}){let[c,j]=(0,d.useState)(I),[p,u]=(0,d.useState)(5),[A,B]=(0,d.useState)([{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}]),[H,K]=(0,d.useState)(!1),M=(0,d.useRef)(new Map),[N,O]=(0,d.useState)(null),[P,Q]=(0,d.useState)([]),[R,S]=(0,d.useState)(0),[T,U]=(0,d.useState)(!1),[V,W]=(0,d.useState)(""),[X,Y]=(0,d.useState)(!1),[Z,$]=(0,d.useState)(null),_=(0,d.useRef)(null),[aa,ab]=(0,d.useState)([]),[ac,ad]=(0,d.useState)(!1),[ae,af]=(0,d.useState)(!1),ag=(0,d.useRef)(null);(0,d.useEffect)(()=>()=>{M.current.forEach((a,b)=>M.current.set(b,!1))},[]);let ah=(a,b)=>{B(c=>c.map(c=>c.id===a?{...c,...b}:c))},ai=(0,d.useCallback)(async a=>{U(!0);let b=a?P.length:0,c=await (0,y.getAssetsAction)({file_type:"image",search:V||void 0,sort_by:"created_at",sort_order:"desc",limit:30,offset:b});a?Q(a=>[...a,...c.assets]):Q(c.assets),S(c.total),U(!1)},[V,P.length]);(0,d.useEffect)(()=>{N&&(W(""),ai(!1))},[N]);let aj=async(a,b)=>{if(!a||!a.type.startsWith("image/"))return null;if(a.size>0x3200000)return x.toast.error("File exceeds 50MB size limit"),null;Y(!0);try{let c=(0,z.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return x.toast.error("Not authenticated"),null;let e=crypto.randomUUID(),f=a.name.replace(/[^a-zA-Z0-9._-]/g,"_"),g=`${d.id}/image/${e}_${f}`,{error:h}=await c.storage.from("assets").upload(g,a,{contentType:a.type,upsert:!1});if(h)return x.toast.error(`Upload failed: ${h.message}`),null;let{data:i,error:j}=await c.from("assets").insert({user_id:d.id,filename:a.name,file_path:g,file_type:"image",mime_type:a.type,file_size:a.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(j)return await c.storage.from("assets").remove([g]),x.toast.error(`Database error: ${j.message}`),null;let{data:k}=await c.storage.from("assets").createSignedUrl(g,3600),l={id:i.id,url:k?.signedUrl||""},m=b||N;return m&&(ah(m,{imageId:l.id,imageUrl:l.url}),b||O(null)),l}catch{return x.toast.error("Failed to upload image"),null}finally{Y(!1),_.current&&(_.current.value="")}},ak=async a=>{let b=a.target.files?.[0];b&&await aj(b)},al=()=>{$(null)},am=async(a,b)=>{if(a.preventDefault(),a.stopPropagation(),$(null),H)return;let c=a.dataTransfer.files;if(!c||0===c.length)return;let d=c[0];d.type.startsWith("image/")?await aj(d,b):x.toast.error("Only image files are supported")},an=async a=>{ad(!0);let b=(0,z.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c){x.toast.error("Not authenticated"),ad(!1);return}let d=[];for(let b=0;b<a.length;b++){let c=a[b];if(c.type.startsWith("image/")){if(c.size>0x3200000){x.toast.error(`File "${c.name}" exceeds 50MB limit`);continue}d.push(c)}}if(0===d.length)return void ad(!1);let e=[],f=0;for(let a=0;a<d.length;a+=3){let g=d.slice(a,a+3);for(let a of(await Promise.all(g.map(async a=>{try{let d=crypto.randomUUID(),e=a.name.replace(/[^a-zA-Z0-9._-]/g,"_"),f=`${c.id}/image/${d}_${e}`,{error:g}=await b.storage.from("assets").upload(f,a,{contentType:a.type,upsert:!1});if(g)return null;let{data:h,error:i}=await b.from("assets").insert({user_id:c.id,filename:a.name,file_path:f,file_type:"image",mime_type:a.type,file_size:a.size,tags:["dancing-reel","portrait"],metadata:{}}).select("id").single();if(i)return await b.storage.from("assets").remove([f]),null;let{data:j}=await b.storage.from("assets").createSignedUrl(f,3600);if(!j?.signedUrl)return null;return{id:h.id,url:j.signedUrl}}catch{return null}}))))a?e.push(a):f++}e.length>0?(ab(a=>[...a,...e]),x.toast.success(`${e.length} image${1===e.length?"":"s"} uploaded to pool`),f>0&&x.toast.error(`${f} image${1===f?"":"s"} failed to upload`)):x.toast.error("Failed to upload images"),ad(!1)},ao=async a=>{let b=a.target.files;b&&b.length>0&&await an(b),ag.current&&(ag.current.value="")},ap=async a=>{if(a.preventDefault(),a.stopPropagation(),af(!1),H)return;let b=a.dataTransfer.files;if(!b||0===b.length)return;let c=Array.from(b).filter(a=>a.type.startsWith("image/"));0===c.length?x.toast.error("Only image files are supported"):await an(c)},aq=(0,d.useCallback)(async(a,b)=>{M.current.set(a,!0);let c=0,d=0;for(;M.current.get(a)&&c<200;){ah(a,{pollCount:++c});try{let c=await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(b)}`),e=await c.json();if("completed"===e.status&&e.videoUrl){M.current.set(a,!1),ah(a,{status:"completed",videoUrl:e.videoUrl});return}if("failed"===e.status){M.current.set(a,!1),ah(a,{status:"failed",error:e.error||"Video generation failed"});return}d=0,await new Promise(a=>setTimeout(a,5e3))}catch(b){if(d++,console.warn(`Poll error for dancing job ${a} (attempt ${c}):`,b),d>=3){M.current.set(a,!1),ah(a,{status:"failed",error:"Network error after multiple retries"});return}await new Promise(a=>setTimeout(a,5e3))}}M.current.get(a)&&(M.current.set(a,!1),ah(a,{status:"failed",error:`Timed out after ${c} polls (~${Math.round(5e3*c/1e3)}s)`}))},[]),ar=(0,d.useCallback)(async a=>{ah(a.id,{status:"submitting"});try{let b=await fetch("/api/dancing-reel/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:a.imageUrl,prompt:c.trim(),duration:p})}),d=await b.json();if(!b.ok)return void ah(a.id,{status:"failed",error:d.error||"Submit failed"});ah(a.id,{status:"polling",taskId:d.taskId,pollCount:0}),aq(a.id,d.taskId)}catch(b){ah(a.id,{status:"failed",error:b instanceof Error?b.message:"Processing failed"})}},[c,p,aq]),as=async()=>{if(!c.trim())return void x.toast.error("Enter a prompt first");let a=A.filter(a=>"pending"===a.status&&!a.imageId&&!a.imageUrl);if(a.length>0){if(aa.length<a.length)return void x.toast.error(`Not enough images. Need ${a.length} more, have ${aa.length} in pool. Add more images or remove jobs.`);(()=>{let a=A.filter(a=>"pending"===a.status&&!a.imageId&&!a.imageUrl);if(0===a.length||0===aa.length)return;let b=[...aa].sort(()=>Math.random()-.5),c=Math.min(a.length,b.length),d=[];for(let e=0;e<c;e++)d.push({id:a[e].id,imageId:b[e].id,imageUrl:b[e].url});return B(a=>a.map(a=>{let b=d.find(b=>b.id===a.id);return b?{...a,imageId:b.imageId,imageUrl:b.imageUrl}:a}))})(),await new Promise(a=>setTimeout(a,50))}let b=A.filter(a=>"pending"===a.status&&a.imageId&&a.imageUrl);if(0===b.length)return void x.toast.error("No valid jobs to process. Each needs an image.");for(let a of(K(!0),x.toast.info(`Starting ${b.length} dancing reel generation${b.length>1?"s":""}...`),b))ar(a)},at=async(a,b)=>{try{let c=await fetch("/api/dancing-reel/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:b})}),d=await c.json();c.ok?(ah(a,{videoAssetId:d.assetId}),x.toast.success("Video saved to library!")):x.toast.error(d.error||"Failed to save")}catch{x.toast.error("Failed to save video")}},au=A.filter(a=>"completed"===a.status).length,av=A.filter(a=>"failed"===a.status).length,aw=A.filter(a=>"submitting"===a.status||"polling"===a.status).length,ax=H&&0===aw,ay=A.filter(a=>"pending"===a.status&&!a.imageId&&!a.imageUrl).length,az=!H&&c.trim()&&A.some(a=>a.imageId||aa.length>=ay);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(J,{step:1,title:"Prompt & Duration",description:"Set the dance prompt and video duration. These settings apply to all videos in this batch.",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(g.Label,{children:"Dance Prompt"}),(0,b.jsx)(f.Textarea,{value:c,onChange:a=>j(a.target.value),placeholder:"Describe the dancing motion...",rows:4,className:"resize-y text-sm",disabled:H}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.trim().split(/\s+/).filter(Boolean).length," words"]}),c!==I&&(0,b.jsx)("button",{type:"button",onClick:()=>j(I),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",disabled:H,children:"Reset to default"})]})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(g.Label,{children:"Duration"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:5===p?"default":"outline",size:"sm",onClick:()=>u(5),disabled:H,className:"flex-1",children:[(0,b.jsx)(v.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"5 seconds (~$0.35/video)"]}),(0,b.jsxs)(e.Button,{variant:10===p?"default":"outline",size:"sm",onClick:()=>u(10),disabled:H,className:"flex-1",children:[(0,b.jsx)(v.Clock,{className:"h-3.5 w-3.5 mr-1.5"}),"10 seconds (~$0.70/video)"]})]})]})]})}),(0,b.jsx)(J,{step:2,title:"Upload Images",description:"Upload portrait images for your dancing reels. Images are randomly assigned to jobs that don't have a manually selected image.",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.Label,{className:"text-base",children:"Bulk Image Pool"}),aa.length>0&&(0,b.jsx)("button",{type:"button",onClick:()=>{ab([])},className:"text-xs text-muted-foreground hover:text-destructive transition-colors",children:"Clear All"})]}),(0,b.jsxs)("div",{onDragOver:a=>{a.preventDefault(),a.stopPropagation(),H||af(!0)},onDragLeave:()=>{af(!1)},onDrop:ap,onClick:()=>!H&&!ac&&ag.current?.click(),className:(0,w.cn)("border-2 border-dashed rounded-lg p-4 transition-all cursor-pointer",ae?"border-accent-blue bg-accent-blue/5":"hover:border-accent-blue/50",H?"opacity-50 pointer-events-none":""),children:[(0,b.jsx)("input",{ref:ag,type:"file",accept:"image/*",multiple:!0,onChange:ao,className:"hidden"}),0===aa.length?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center gap-2 text-muted-foreground",children:ac?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin"}),(0,b.jsx)("p",{className:"text-sm",children:"Uploading images..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Upload,{className:"h-8 w-8"}),(0,b.jsx)("p",{className:"text-sm",children:"Drop images here or click to browse"})]})}):(0,b.jsxs)("div",{className:"space-y-2",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[aa.length," image",1===aa.length?"":"s"," in pool (randomly assigned to videos without images)"]}),(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:aa.map(a=>(0,b.jsxs)("div",{className:"relative group flex-shrink-0",children:[(0,b.jsx)("img",{src:a.url,alt:"",className:"h-16 w-16 rounded-md object-cover border"}),(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void ab(a=>a.filter(a=>a.id!==b))},className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(G.X,{className:"h-3 w-3"})})]},a.id))}),(0,b.jsxs)("div",{onClick:()=>ag.current?.click(),className:"border border-dashed rounded-md px-3 py-1 text-xs text-muted-foreground hover:text-accent-blue cursor-pointer inline-flex items-center gap-1 w-fit",children:[(0,b.jsx)(D.Plus,{className:"h-3 w-3"})," Add more"]})]})]})]})}),(0,b.jsx)(J,{step:3,title:"Videos",description:"Each row becomes a separate dancing reel. Add more rows for more videos. You can manually assign images or let the pool handle it.",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(g.Label,{className:"text-base",children:["Videos (",A.length,")"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{B(a=>[...a,{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}])},disabled:H,children:[(0,b.jsx)(D.Plus,{className:"h-4 w-4 mr-1.5"}),"Add Video"]})]}),A.map((a,c)=>(0,b.jsxs)("div",{className:(0,w.cn)("rounded-lg border p-4 space-y-3","completed"===a.status&&"border-green-500 bg-green-500/5","failed"===a.status&&"border-destructive bg-destructive/5","pending"===a.status&&"border-border"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Video ",c+1]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L,{status:a.status,pollCount:a.pollCount}),!H&&A.length>1&&(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.id,void(!(A.length<=1)&&(M.current.set(b,!1),B(a=>a.filter(a=>a.id!==b))))},className:"h-7 w-7 p-0",children:(0,b.jsx)(E.Trash2,{className:"h-3.5 w-3.5"})})]})]}),"pending"===a.status&&(0,b.jsxs)("div",{className:"flex items-center gap-3",onDragOver:b=>{var c;return c=a.id,void(b.preventDefault(),b.stopPropagation(),!H&&$(c))},onDragLeave:al,onDrop:b=>am(b,a.id),children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(g.Label,{className:"text-xs",children:"Image"}),a.imageUrl?(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("img",{src:a.imageUrl,alt:"Selected",className:(0,w.cn)("h-[80px] w-[45px] rounded-md object-cover border cursor-pointer",Z===a.id?"ring-2 ring-accent-blue ring-offset-2":""),onClick:()=>!H&&O(a.id)}),!H&&(0,b.jsx)("button",{type:"button",onClick:()=>ah(a.id,{imageId:null,imageUrl:null}),className:"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(G.X,{className:"h-3 w-3"})})]}):(0,b.jsxs)("button",{type:"button",onClick:()=>O(a.id),disabled:H,className:(0,w.cn)("h-[80px] w-[45px] rounded-md border-2 border-dashed flex flex-col items-center justify-center gap-1 text-muted-foreground transition-colors",Z===a.id?"border-accent-blue bg-accent-blue/10":"hover:border-accent-blue/50 hover:text-accent-blue"),children:[(0,b.jsx)(F.ImageIcon,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-[9px]",children:Z===a.id?"Drop":"Select"})]})]}),(0,b.jsx)("div",{className:"flex-1 text-sm text-muted-foreground",children:a.imageId?(0,b.jsxs)(h.Badge,{variant:"secondary",className:"gap-1 text-xs",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3"}),"Image ready"]}):(0,b.jsx)("span",{className:"text-xs",children:"No image — will use pool"})})]}),"pending"!==a.status&&"completed"!==a.status&&"failed"!==a.status&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Loader2,{className:"h-3.5 w-3.5 animate-spin text-accent-blue"}),(0,b.jsxs)("span",{className:"text-xs",children:["submitting"===a.status&&"Submitting to Kling 2.6 Pro...","polling"===a.status&&`Generating video... ${Math.round(5*(a.pollCount||0))}s`]})]}),"polling"===a.status&&(0,b.jsx)(k.Progress,{value:Math.min((a.pollCount||0)/200*100,95),className:"h-1.5"})]}),"failed"===a.status&&a.error&&(0,b.jsx)("p",{className:"text-xs text-destructive",children:a.error}),"completed"===a.status&&a.videoUrl&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("video",{controls:!0,src:a.videoUrl,className:"w-full max-h-[200px] rounded-md bg-black",preload:"metadata"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{let b=document.createElement("a");b.href=a.videoUrl,b.download=`dancing-reel-${c+1}.mp4`,b.target="_blank",b.click()},children:[(0,b.jsx)(s.Download,{className:"h-3.5 w-3.5 mr-1"}),"Download"]}),a.videoAssetId?(0,b.jsxs)(h.Badge,{variant:"secondary",className:"gap-1",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3"}),"Saved"]}):(0,b.jsxs)(e.Button,{size:"sm",onClick:()=>at(a.id,a.videoUrl),children:[(0,b.jsx)(t.Save,{className:"h-3.5 w-3.5 mr-1"}),"Save to Library"]})]})]})]},a.id))]})}),H&&(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[aw>0&&(0,b.jsxs)(h.Badge,{variant:"secondary",children:[(0,b.jsx)(l.Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),aw," processing"]}),au>0&&(0,b.jsxs)(h.Badge,{variant:"secondary",className:"text-green-600",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3 mr-1"}),au," completed"]}),av>0&&(0,b.jsxs)(h.Badge,{variant:"destructive",children:[(0,b.jsx)(n.AlertCircle,{className:"h-3 w-3 mr-1"}),av," failed"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{onClick:as,disabled:!az,size:"lg",className:"flex-1",children:[(0,b.jsx)(m.Music,{className:"h-4 w-4 mr-2"}),H?ax?"All Done":`Processing ${aw} video${1!==aw?"s":""}...`:`Generate ${A.filter(a=>a.imageId||aa.length).length} Dancing Reel${A.length>1?"s":""} (${p}s each)`]}),ax&&(0,b.jsx)(e.Button,{variant:"outline",size:"lg",onClick:()=>{K(!1),B([{id:crypto.randomUUID(),imageId:null,imageUrl:null,status:"pending"}])},children:"Start New Batch"})]}),(0,b.jsx)(C.Dialog,{open:null!==N,onOpenChange:a=>!a&&O(null),children:(0,b.jsxs)(C.DialogContent,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[(0,b.jsx)(C.DialogHeader,{children:(0,b.jsx)(C.DialogTitle,{children:"Select Image"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(r.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(i.Input,{placeholder:"Search images...",value:V,onChange:a=>{let b;return W(a.target.value),b=setTimeout(()=>ai(!1),300),()=>clearTimeout(b)},className:"pl-9"})]}),(0,b.jsx)("input",{ref:_,type:"file",accept:"image/*",onChange:ak,className:"hidden"}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>_.current?.click(),disabled:X,children:[X?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,b.jsx)(q.Upload,{className:"h-4 w-4 mr-1"}),"Upload"]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto min-h-0",children:[0!==P.length||T?(0,b.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-2 pb-2",children:P.map(a=>(0,b.jsx)("button",{type:"button",className:"relative aspect-[9/16] overflow-hidden rounded-md border-2 border-transparent hover:border-accent-blue/50 transition-all",onClick:()=>{N&&(ah(N,{imageId:a.id,imageUrl:a.signed_url}),O(null))},children:(0,b.jsx)("img",{src:a.signed_url,alt:a.filename,className:"h-full w-full object-cover",loading:"lazy"})},a.id))}):(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No images found."})}),P.length<R&&(0,b.jsx)("div",{className:"flex justify-center py-2",children:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>ai(!0),disabled:T,children:T?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}):"Load More"})})]}),N&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click an image to select it for this video. Uploaded images are auto-saved to your asset library."})]})})]})}function L({status:a,pollCount:c}){switch(a){case"pending":return(0,b.jsx)(h.Badge,{variant:"outline",className:"text-xs",children:"Pending"});case"submitting":return(0,b.jsxs)(h.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,b.jsx)(l.Loader2,{className:"h-3 w-3 animate-spin"}),"Submitting"]});case"polling":return(0,b.jsxs)(h.Badge,{variant:"secondary",className:"text-xs gap-1",children:[(0,b.jsx)(l.Loader2,{className:"h-3 w-3 animate-spin"}),Math.round(5*(c||0)),"s"]});case"completed":return(0,b.jsxs)(h.Badge,{variant:"secondary",className:"text-xs gap-1 text-green-600",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3"}),"Done"]});case"failed":return(0,b.jsxs)(h.Badge,{variant:"destructive",className:"text-xs gap-1",children:[(0,b.jsx)(n.AlertCircle,{className:"h-3 w-3"}),"Failed"]})}}var M=a.i(17545);function N({aiModels:a}){return(0,b.jsxs)(c.Tabs,{defaultValue:"single",className:"space-y-4",children:[(0,b.jsxs)(c.TabsList,{children:[(0,b.jsxs)(c.TabsTrigger,{value:"single",className:"gap-1.5",children:[(0,b.jsx)(m.Music,{className:"h-3.5 w-3.5"}),"Single Video"]}),(0,b.jsxs)(c.TabsTrigger,{value:"bulk",className:"gap-1.5",children:[(0,b.jsx)(M.Layers,{className:"h-3.5 w-3.5"}),"Bulk Generate"]})]}),(0,b.jsx)(c.TabsContent,{value:"single",children:(0,b.jsx)(B,{aiModels:a})}),(0,b.jsx)(c.TabsContent,{value:"bulk",children:(0,b.jsx)(K,{aiModels:a})})]})}a.s(["DancingReelTabs",()=>N],97978)}];

//# sourceMappingURL=src_components_dancing-reel_dancing-reel-tabs_tsx_09372f2d._.js.map