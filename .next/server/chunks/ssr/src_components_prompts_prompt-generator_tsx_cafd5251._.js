module.exports=[2109,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(99570),e=a.i(5084),f=a.i(75083),g=a.i(70430),h=a.i(29246),i=a.i(85181),j=a.i(80701),k=a.i(96221),l=a.i(8406),m=a.i(73320),n=a.i(33508),o=a.i(79165),p=a.i(23292);let q=["image/jpeg","image/png","image/webp","image/gif"],r={google:"Google Gemini (Recommended)",openai:"OpenAI (GPT-4o)",anthropic:"Claude (Anthropic)"};function s({onGenerated:a}){let[e,f]=(0,c.useState)("google"),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),E=(0,c.useRef)(null),F=(0,c.useCallback)(a=>{if(!q.includes(a.type))return void p.toast.error("Unsupported format. Use JPEG, PNG, WebP, or GIF.");if(a.size>0x1400000)return void p.toast.error("File too large. Maximum 20MB.");z(a);let b=new FileReader;b.onload=a=>{B(a.target?.result)},b.readAsDataURL(a)},[]),G=(0,c.useCallback)(a=>{a.preventDefault(),D(!1);let b=a.dataTransfer.files[0];b&&F(b)},[F]),H=(0,c.useCallback)(a=>{a.preventDefault(),D(!0)},[]),I=(0,c.useCallback)(a=>{a.preventDefault(),D(!1)},[]),J=async()=>{if(!y||!A)return void p.toast.error("Upload an image first");x(!0);try{let b=null;try{let a=new FormData;a.append("file",y),a.append("tags",JSON.stringify(["prompt-source"]));let c=await fetch("/api/assets/upload",{method:"POST",body:a}),d=await c.json();c.ok&&d.asset?.id&&(b=d.asset.id)}catch{console.warn("Failed to upload source image to asset library")}let c=A.split(",")[1],d=await fetch("/api/prompts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e,image_base64:c,content_type:y.type,custom_instructions:s.trim()||void 0,variation_count:u})});if(!d.ok){let a=await d.json();p.toast.error(a.error||"Generation failed"),x(!1);return}let f=await d.json(),g=f.prompts||[f.prompt];p.toast.success(g.length>1?`${g.length} prompt variations generated!`:"Prompt generated!"),a(g,A,b)}catch{p.toast.error("Failed to generate prompt")}finally{x(!1)}};return(0,b.jsxs)("div",{className:"space-y-4 rounded-lg bg-card border border-border p-6 transition-colors duration-200 hover:bg-card-hover",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Analyze Image"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Upload an inspiration image and AI will generate a detailed prompt to recreate the scene."}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{children:"AI Provider"}),(0,b.jsxs)(j.Select,{value:e,onValueChange:a=>f(a),children:[(0,b.jsx)(j.SelectTrigger,{className:"w-[220px]",children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"google",children:r.google}),(0,b.jsx)(j.SelectItem,{value:"openai",children:r.openai}),(0,b.jsx)(j.SelectItem,{value:"anthropic",children:r.anthropic})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"google"===e?"Best for analyzing photos of people. Fast and reliable.":"openai"===e?"API may decline to analyze photos of real people.":"May decline to analyze photos of real people."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{children:"Image"}),A?(0,b.jsxs)("div",{className:"relative flex gap-3 items-center rounded-md p-3 bg-muted/30",children:[(0,b.jsx)("img",{src:A,alt:"Uploaded",className:"h-24 w-24 rounded-md object-cover"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:y?.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:y?`${(y.size/1024/1024).toFixed(1)} MB`:""}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[r[e]," will analyze this image and generate a detailed recreation prompt."]})]}),(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:()=>{z(null),B(null)},className:"absolute top-2 right-2 h-7 w-7",children:(0,b.jsx)(n.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)("div",{onClick:()=>E.current?.click(),onDrop:G,onDragOver:H,onDragLeave:I,className:`flex flex-col items-center justify-center gap-2 rounded-lg border-2 border-dashed p-8 cursor-pointer transition-colors ${C?"border-accent-blue bg-accent-blue/5":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,children:[C?(0,b.jsx)(m.Upload,{className:"h-8 w-8 text-accent-blue"}):(0,b.jsx)(o.ImageIcon,{className:"h-8 w-8 text-muted-foreground"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:C?"Drop image here":"Click to upload or drag and drop"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP, or GIF (max 20MB)"})]})]}),(0,b.jsx)("input",{ref:E,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:a=>{let b=a.target.files?.[0];b&&F(b),a.target.value=""},className:"hidden"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.Label,{children:"Variations"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:u})]}),(0,b.jsx)(i.Slider,{value:[u],onValueChange:([a])=>v(a),min:1,max:10,step:1,className:"w-full"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:1===u?"Generate 1 prompt from this image.":`Generate ${u} variations — same pose, different outfit colors & backgrounds.`})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(g.Label,{htmlFor:"custom-instructions",children:["Custom Instructions"," ",(0,b.jsx)("span",{className:"text-muted-foreground font-normal",children:"(optional)"})]}),(0,b.jsx)(h.Textarea,{id:"custom-instructions",placeholder:"e.g., Focus on the lighting setup, emphasize the color palette, describe the background in more detail...",value:s,onChange:a=>t(a.target.value),rows:3})]}),(0,b.jsx)(d.Button,{onClick:J,disabled:w||!y,className:"w-full",children:w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing image & generating ",u>1?`${u} prompts`:"prompt","..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Sparkles,{className:"h-4 w-4 mr-2"}),"Analyze Image & Generate ",u>1?`${u} Prompts`:"Prompt"]})})]})}var t=a.i(91119),u=a.i(33441),v=a.i(5151),w=a.i(99464);function x({prompt:a,onPromptChange:e}){let[f,g]=(0,c.useState)(!1),[i,j]=(0,c.useState)(a),[k,l]=(0,c.useState)(!1),m=async()=>{await navigator.clipboard.writeText(a),l(!0),p.toast.success("Prompt copied to clipboard"),setTimeout(()=>l(!1),2e3)};return(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{className:"pb-2 flex-row items-center justify-between space-y-0",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Scene Recreation Prompt"}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:f?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Button,{size:"sm",variant:"ghost",onClick:()=>{e(i),g(!1)},children:(0,b.jsx)(u.Check,{className:"h-4 w-4"})}),(0,b.jsx)(d.Button,{size:"sm",variant:"ghost",onClick:()=>{j(a),g(!1)},children:(0,b.jsx)(n.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Button,{size:"sm",variant:"ghost",onClick:()=>{j(a),g(!0)},children:(0,b.jsx)(w.Pencil,{className:"h-4 w-4"})}),(0,b.jsx)(d.Button,{size:"sm",variant:"ghost",onClick:m,children:k?(0,b.jsx)(u.Check,{className:"h-4 w-4 text-green-500"}):(0,b.jsx)(v.Copy,{className:"h-4 w-4"})})]})})]}),(0,b.jsx)(t.CardContent,{children:f?(0,b.jsx)(h.Textarea,{value:i,onChange:a=>j(a.target.value),rows:12,className:"text-sm font-mono",autoFocus:!0}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap leading-relaxed",children:a})})]})}var y=a.i(86304),z=a.i(86192),A=a.i(35732),B=a.i(81560),C=a.i(5784),D=a.i(67552);let E=(0,a.i(70106).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);var F=a.i(68114),G=a.i(5050);let H=(0,G.createServerReference)("603a2216d6dae2430e450d9d9d8657b8fbef47f05d",G.callServer,void 0,G.findSourceMapURL,"updatePromptAction"),I=(0,G.createServerReference)("40886c4094dc8e7fa94b50409e37b3bd3c23af2705",G.callServer,void 0,G.findSourceMapURL,"deletePromptAction");function J({prompts:a,onPromptsChange:e}){let[f,g]=(0,c.useState)(new Set),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(""),[t,x]=(0,c.useState)(null),G=async(a,b)=>{await navigator.clipboard.writeText(b),g(b=>new Set(b).add(a)),j(a),p.toast.success("Copied to clipboard"),setTimeout(()=>j(null),2e3)},J=async()=>{if(!m)return;let a=await H(m,r);a.success?(p.toast.success("Prompt updated"),e()):p.toast.error(a.error),q(null)},K=async()=>{if(!t)return;let a=await I(t);a.success?(p.toast.success("Prompt deleted"),e()):p.toast.error(a.error),x(null)};return 0===a.length?null:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Saved Prompts"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.length," prompt",1!==a.length?"s":""]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:a.map(a=>{let c=k===a.id,e=m===a.id,g=f.has(a.id),j=i===a.id,p=a.prompt_text.length>80?a.prompt_text.slice(0,80)+"...":a.prompt_text;return(0,b.jsxs)("div",{className:`rounded-lg overflow-hidden transition-all duration-200 ${g?"bg-green-950/30 ring-1 ring-green-800":"bg-card text-card-foreground border border-border hover:bg-card-hover"}`,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:a.source_image?.signed_url?(0,b.jsx)("img",{src:a.source_image.signed_url,alt:"Source",className:"h-16 w-16 rounded-md object-cover"}):(0,b.jsx)("div",{className:"h-16 w-16 rounded-md bg-muted flex items-center justify-center",children:(0,b.jsx)(o.ImageIcon,{className:"h-6 w-6 text-muted-foreground/50"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:p}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 flex-wrap",children:[(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground",children:(0,F.formatDate)(a.created_at)}),a.variation_label&&(0,b.jsx)(y.Badge,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4",children:a.variation_label}),a.is_edited&&(0,b.jsx)(y.Badge,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 text-amber-600",children:"Edited"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[(0,b.jsx)(d.Button,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:b=>{b.stopPropagation(),G(a.id,a.prompt_text)},title:g?"Copied — click to copy again":"Copy prompt",children:j?(0,b.jsx)(u.Check,{className:"h-3.5 w-3.5 text-green-600"}):g?(0,b.jsx)(u.Check,{className:"h-3.5 w-3.5 text-green-500"}):(0,b.jsx)(v.Copy,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(d.Button,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{var b;m!==(b=a.id)&&l(a=>a===b?null:b)},title:c?"Collapse":"Expand",children:c?(0,b.jsx)(D.ChevronUp,{className:"h-3.5 w-3.5"}):(0,b.jsx)(C.ChevronDown,{className:"h-3.5 w-3.5"})}),(0,b.jsxs)(A.DropdownMenu,{children:[(0,b.jsx)(A.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(d.Button,{size:"icon",variant:"ghost",className:"h-7 w-7",children:(0,b.jsx)(E,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(A.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>{q(a.id),s(a.prompt_text),l(a.id)},children:[(0,b.jsx)(w.Pencil,{className:"h-3.5 w-3.5 mr-2"}),"Edit"]}),(0,b.jsxs)(A.DropdownMenuItem,{className:"text-destructive focus:text-destructive",onClick:()=>x(a.id),children:[(0,b.jsx)(B.Trash2,{className:"h-3.5 w-3.5 mr-2"}),"Delete"]})]})]})]})]}),c&&(0,b.jsx)("div",{className:"border-t px-3 pb-3 pt-2",children:e?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Textarea,{value:r,onChange:a=>s(a.target.value),rows:6,className:"text-xs font-mono",autoFocus:!0}),(0,b.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,b.jsxs)(d.Button,{size:"sm",variant:"ghost",onClick:()=>q(null),children:[(0,b.jsx)(n.X,{className:"h-3.5 w-3.5 mr-1"}),"Cancel"]}),(0,b.jsxs)(d.Button,{size:"sm",onClick:J,children:[(0,b.jsx)(u.Check,{className:"h-3.5 w-3.5 mr-1"}),"Save"]})]})]}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap leading-relaxed",children:a.prompt_text})})]},a.id)})}),(0,b.jsx)(z.AlertDialog,{open:!!t,onOpenChange:a=>!a&&x(null),children:(0,b.jsxs)(z.AlertDialogContent,{children:[(0,b.jsxs)(z.AlertDialogHeader,{children:[(0,b.jsx)(z.AlertDialogTitle,{children:"Delete Prompt"}),(0,b.jsx)(z.AlertDialogDescription,{children:"Are you sure you want to delete this prompt? This cannot be undone."})]}),(0,b.jsxs)(z.AlertDialogFooter,{children:[(0,b.jsx)(z.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(z.AlertDialogAction,{onClick:K,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}var K=a.i(73390),L=a.i(67453),M=a.i(92e3);let N=(0,G.createServerReference)("40cc7ce593799f345f22d67d5cee644da005a9b3ab",G.callServer,void 0,G.findSourceMapURL,"savePromptsAction"),O=["image/jpeg","image/png","image/webp","image/gif"];function P({onComplete:a}){let[e,f]=(0,c.useState)("google"),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(1),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),B=(0,c.useRef)(null),C=(0,c.useCallback)(a=>{let b=[];for(let c of Array.from(a)){if(!O.includes(c.type)){p.toast.error(`${c.name}: unsupported format`);continue}if(c.size>0x1400000){p.toast.error(`${c.name}: exceeds 20MB`);continue}let a=URL.createObjectURL(c);b.push({id:crypto.randomUUID(),file:c,preview:a,status:"pending"})}b.length>0&&v(a=>[...a,...b])},[]),D=(0,c.useCallback)(a=>{a.preventDefault(),A(!1),C(a.dataTransfer.files)},[C]),E=(a,b)=>{v(c=>c.map(c=>c.id===a?{...c,...b}:c))},G=async a=>{try{E(a.id,{status:"uploading"});let b=new FormData;b.append("file",a.file),b.append("tags",JSON.stringify(["prompt-source"]));let c=await fetch("/api/assets/upload",{method:"POST",body:b}),d=await c.json();if(!c.ok)return void E(a.id,{status:"error",error:d.error||"Upload failed"});let f=d.asset?.id||null;E(a.id,{assetId:f}),E(a.id,{status:"analyzing"});let g=await new Promise((b,c)=>{let d=new FileReader;d.onload=a=>{let c=a.target?.result;b(c.split(",")[1])},d.onerror=c,d.readAsDataURL(a.file)}),h=await fetch("/api/prompts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e,image_base64:g,content_type:a.file.type,custom_instructions:q.trim()||void 0,variation_count:s})}),i=await h.json();if(!h.ok)return void E(a.id,{status:"error",error:i.error||"Generation failed"});let j=i.prompts||[i.prompt];E(a.id,{status:"saving"});let k=j.map((a,b)=>({model_id:null,source_image_id:f,prompt_text:a.trim(),prompt_index:b,variation_label:j.length>1?`Variation ${b+1}`:"",metadata:{provider:e,bulk:!0}})),l=await N(k);if(!l.success)return void E(a.id,{status:"error",error:l.error||"Save failed"});E(a.id,{status:"done",promptCount:j.length})}catch(b){E(a.id,{status:"error",error:b instanceof Error?b.message:"Processing failed"})}},H=async()=>{let b=u.filter(a=>"pending"===a.status);if(0===b.length)return void p.toast.error("No images to process");for(let a of(x(!0),p.toast.info(`Processing ${b.length} image${b.length>1?"s":""}...`),b))await G(a);x(!1),u.filter(a=>"done"===a.status).length,b.filter(a=>!0).length,p.toast.success("Bulk processing complete!"),a()},I=u.filter(a=>"pending"===a.status).length,J=u.filter(a=>"uploading"===a.status||"analyzing"===a.status||"saving"===a.status).length,P=u.filter(a=>"done"===a.status).length,Q=u.filter(a=>"error"===a.status).length,R=P+Q;u.filter(a=>"done"!==a.status&&"error"!==a.status).length;let S=u.length>0?Math.round(R/u.length*100):0;return(0,b.jsxs)("div",{className:"space-y-4 rounded-lg bg-card border border-border p-6 transition-colors duration-200 hover:bg-card-hover",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Bulk Analyze Images"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Upload multiple images. Each will be analyzed and prompts auto-saved."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{children:"AI Provider"}),(0,b.jsxs)(j.Select,{value:e,onValueChange:a=>f(a),disabled:w,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"google",children:"Google Gemini (Recommended)"}),(0,b.jsx)(j.SelectItem,{value:"openai",children:"OpenAI (GPT-4o)"}),(0,b.jsx)(j.SelectItem,{value:"anthropic",children:"Claude (Anthropic)"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.Label,{children:"Variations per Image"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:s})]}),(0,b.jsx)(i.Slider,{value:[s],onValueChange:([a])=>t(a),min:1,max:10,step:1,disabled:w}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:1===s?"1 prompt per image":`${s} variations per image (different outfits & backgrounds)`})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(g.Label,{children:["Custom Instructions"," ",(0,b.jsx)("span",{className:"text-muted-foreground font-normal",children:"(optional)"})]}),(0,b.jsx)(h.Textarea,{placeholder:"Applied to all images...",value:q,onChange:a=>r(a.target.value),rows:2,disabled:w})]}),!w&&(0,b.jsxs)("div",{onClick:()=>B.current?.click(),onDrop:D,onDragOver:a=>{a.preventDefault(),A(!0)},onDragLeave:a=>{a.preventDefault(),A(!1)},className:(0,F.cn)("flex flex-col items-center justify-center gap-2 rounded-lg border-2 border-dashed p-6 cursor-pointer transition-colors",z?"border-accent-blue bg-accent-blue/5":"border-muted-foreground/25 hover:border-muted-foreground/50"),children:[z?(0,b.jsx)(m.Upload,{className:"h-6 w-6 text-accent-blue"}):(0,b.jsx)(o.ImageIcon,{className:"h-6 w-6 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:z?"Drop images here":"Click or drag to add images"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"JPEG, PNG, WebP, or GIF (max 20MB each)"})]}),(0,b.jsx)("input",{ref:B,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",multiple:!0,onChange:a=>{a.target.files&&C(a.target.files),a.target.value=""},className:"hidden"}),u.length>0&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(g.Label,{className:"text-base",children:["Images (",u.length,")"]}),!w&&(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>{u.forEach(a=>URL.revokeObjectURL(a.preview)),v([])},className:"text-xs text-muted-foreground",children:"Clear All"})]}),(0,b.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2",children:u.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsxs)("div",{className:(0,F.cn)("aspect-square rounded-md overflow-hidden border-2 transition-colors","done"===a.status&&"border-green-500/50","error"===a.status&&"border-destructive/50","pending"===a.status&&"border-transparent",("uploading"===a.status||"analyzing"===a.status||"saving"===a.status)&&"border-accent-blue/50"),children:[(0,b.jsx)("img",{src:a.preview,alt:a.file.name,className:"h-full w-full object-cover"}),"pending"!==a.status&&"done"!==a.status&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:"error"===a.status?(0,b.jsx)(M.AlertCircle,{className:"h-5 w-5 text-destructive"}):(0,b.jsx)(k.Loader2,{className:"h-5 w-5 text-white animate-spin"})}),"done"===a.status&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:(0,b.jsx)(L.CheckCircle2,{className:"h-5 w-5 text-green-400"})})]}),!w&&"pending"===a.status&&(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void v(a=>{let c=a.find(a=>a.id===b);return c&&URL.revokeObjectURL(c.preview),a.filter(a=>a.id!==b)})},className:"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(n.X,{className:"h-3 w-3"})}),"done"===a.status&&a.promptCount&&(0,b.jsx)(y.Badge,{variant:"secondary",className:"absolute bottom-1 right-1 text-[9px] px-1 py-0",children:a.promptCount})]},a.id))}),u.filter(a=>"error"===a.status&&a.error).map(a=>(0,b.jsxs)("p",{className:"text-xs text-destructive",children:[a.file.name,": ",a.error]},a.id))]}),w&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin text-accent-blue"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Processing ",R," of ",u.length," images..."]})]}),(0,b.jsx)(K.Progress,{value:S,className:"h-2"}),(0,b.jsxs)("div",{className:"flex gap-2 text-xs text-muted-foreground",children:[P>0&&(0,b.jsxs)("span",{className:"text-green-600",children:[P," done"]}),Q>0&&(0,b.jsxs)("span",{className:"text-destructive",children:[Q," failed"]}),J>0&&(0,b.jsxs)("span",{children:[J," processing"]})]})]}),(0,b.jsx)(d.Button,{onClick:H,disabled:w||0===I,className:"w-full",size:"lg",children:w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Sparkles,{className:"h-4 w-4 mr-2"}),"Analyze ",I," Image",1!==I?"s":"",s>1&&` (${I*s} prompts)`]})})]})}var Q=a.i(14548),R=a.i(17545);let S=(0,G.createServerReference)("4080a7ba85e37fafbc4df09efa7c0c457b39cf3d12",G.callServer,void 0,G.findSourceMapURL,"getPromptsAction");function T({initialPrompts:a}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,q]=(0,c.useState)(!1),[r,t]=(0,c.useState)(a),u=async()=>{if(0===g.length)return;q(!0);let a=g.map((a,b)=>({model_id:null,source_image_id:l,prompt_text:a,prompt_index:b,variation_label:g.length>1?`Variation ${b+1}`:""})),b=await N(a);q(!1),b.success?(p.toast.success(a.length>1?`${a.length} prompts saved!`:"Prompt saved!"),h([]),j(null),m(null),v()):p.toast.error(b.error||"Failed to save")},v=(0,c.useCallback)(async()=>{let a=await S({limit:50});a.error||t(a.prompts)},[]);return(0,b.jsxs)("div",{className:"space-y-8 max-w-3xl",children:[(0,b.jsxs)(f.Tabs,{defaultValue:"single",className:"w-full",children:[(0,b.jsxs)(f.TabsList,{className:"grid w-full grid-cols-2 max-w-xs",children:[(0,b.jsxs)(f.TabsTrigger,{value:"single",className:"gap-1.5",children:[(0,b.jsx)(o.ImageIcon,{className:"h-3.5 w-3.5"}),"Single Image"]}),(0,b.jsxs)(f.TabsTrigger,{value:"bulk",className:"gap-1.5",children:[(0,b.jsx)(R.Layers,{className:"h-3.5 w-3.5"}),"Bulk Upload"]})]}),(0,b.jsxs)(f.TabsContent,{value:"single",className:"mt-4",children:[(0,b.jsx)(s,{onGenerated:(a,b,c)=>{h(a),j(b),m(c)}}),g.length>0&&(0,b.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Generated Prompt",g.length>1?"s":"",g.length>1&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground font-normal ml-2",children:["(",g.length," variations)"]})]}),(0,b.jsx)(d.Button,{onClick:u,disabled:n,children:n?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Q.Save,{className:"h-4 w-4 mr-2"}),"Save ",g.length>1?"All":"Prompt"]})})]}),i&&(0,b.jsxs)("div",{className:"flex gap-3 items-center rounded-md p-3 bg-muted/30",children:[(0,b.jsx)("img",{src:i,alt:"Analyzed",className:"h-16 w-16 rounded-md object-cover"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:g.length>1?`${g.length} prompt variations generated from this image`:"Prompt generated from this image"})]}),(0,b.jsx)("div",{className:"space-y-3",children:g.map((a,c)=>(0,b.jsxs)("div",{children:[g.length>1&&(0,b.jsxs)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Variation ",c+1]}),(0,b.jsx)(x,{prompt:a,onPromptChange:a=>{h(b=>b.map((b,d)=>d===c?a:b))}})]},c))})]})]}),(0,b.jsx)(f.TabsContent,{value:"bulk",className:"mt-4",children:(0,b.jsx)(P,{onComplete:v})})]}),r.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Separator,{}),(0,b.jsx)(J,{prompts:r,onPromptsChange:v})]})]})}a.s(["PromptGenerator",()=>T],2109)}];

//# sourceMappingURL=src_components_prompts_prompt-generator_tsx_cafd5251._.js.map