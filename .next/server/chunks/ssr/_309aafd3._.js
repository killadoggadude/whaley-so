module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},3006,a=>{"use strict";var b=a.i(16349);let c="assets";async function d(a){let d=await (0,b.createClient)(),{data:e,error:f}=await d.storage.from(c).createSignedUrl(a,3600);if(f)throw Error(`Failed to create signed URL: ${f.message}`);return e.signedUrl}async function e(a){let d=await (0,b.createClient)(),{error:e}=await d.storage.from(c).remove([a]);if(e)throw Error(`Failed to delete file: ${e.message}`)}a.s(["deleteStorageFile",()=>e,"getSignedUrl",()=>d])},73370,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(3006);async function f(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{assets:[],total:0,error:"Not authenticated"};let f=b.from("assets").select("*",{count:"exact"}).eq("user_id",c.id);if(a?.file_type&&(f=f.eq("file_type",a.file_type)),a?.is_favorite!==void 0&&(f=f.eq("is_favorite",a.is_favorite)),a?.tags&&a.tags.length>0&&(f=f.contains("tags",a.tags)),a?.search&&(f=f.ilike("filename",`%${a.search}%`)),a?.ai_model_id!==void 0&&(f=null===a.ai_model_id?f.is("ai_model_id",null):f.eq("ai_model_id",a.ai_model_id)),a?.ids){let b=a.ids.split(",");f=f.in("id",b)}let g=a?.sort_by||"created_at",h=a?.sort_order||"desc";f=f.order(g,{ascending:"asc"===h});let i=a?.limit||24,j=a?.offset||0;f=f.range(j,j+i-1);let{data:k,error:l,count:m}=await f;if(l)return{assets:[],total:0,error:l.message};return{assets:await Promise.all((k||[]).map(async a=>{try{let b=await (0,e.getSignedUrl)(a.file_path);return{...a,signed_url:b}}catch{return{...a,signed_url:""}}})),total:m||0}}catch(a){return{assets:[],total:0,error:a instanceof Error?a.message:"Failed to fetch assets"}}}async function g(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{data:f}=await b.from("assets").select("is_favorite").eq("id",a).eq("user_id",e.id).single();if(!f)return{success:!1,error:"Asset not found"};let{error:g}=await b.from("assets").update({is_favorite:!f.is_favorite}).eq("id",a).eq("user_id",e.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to toggle favorite"}}}async function h(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};let{error:g}=await e.from("assets").update({tags:b}).eq("id",a).eq("user_id",f.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update tags"}}}async function i(a){try{let b=await (0,d.createClient)(),{data:{user:f}}=await b.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};let{data:g}=await b.from("assets").select("file_path").eq("id",a).eq("user_id",f.id).single();if(!g)return{success:!1,error:"Asset not found"};try{await (0,e.deleteStorageFile)(g.file_path)}catch{console.error("Failed to delete storage file:",g.file_path)}let{error:h}=await b.from("assets").delete().eq("id",a).eq("user_id",f.id);if(h)return{success:!1,error:h.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete asset"}}}async function j(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return[];let{data:c}=await a.from("assets").select("tags").eq("user_id",b.id);if(!c)return[];let e=c.flatMap(a=>a.tags||[]);return[...new Set(e)].sort()}catch{return[]}}async function k(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,deletedCount:0,error:"Not authenticated"};if(0===a.length)return{success:!1,deletedCount:0,error:"No assets specified"};let{data:f}=await b.from("assets").select("id, file_path").in("id",a).eq("user_id",e.id);if(!f||0===f.length)return{success:!1,deletedCount:0,error:"No assets found"};let g=f.map(a=>a.file_path);try{await b.storage.from("assets").remove(g)}catch{console.error("Failed to batch-delete storage files")}let h=f.map(a=>a.id),{error:i}=await b.from("assets").delete().in("id",h).eq("user_id",e.id);if(i)return{success:!1,deletedCount:0,error:i.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0,deletedCount:h.length}}catch(a){return{success:!1,deletedCount:0,error:a instanceof Error?a.message:"Failed to bulk delete assets"}}}async function l(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};if(0===a.length)return{success:!1,error:"No assets specified"};if(b){let{data:a}=await e.from("ai_models").select("id").eq("id",b).eq("user_id",f.id).single();if(!a)return{success:!1,error:"Model not found"}}let{error:g}=await e.from("assets").update({ai_model_id:b}).in("id",a).eq("user_id",f.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/assets"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to assign model to assets"}}}async function m(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{urls:[],error:"Not authenticated"};if(0===a.length)return{urls:[],error:"No assets specified"};let{data:f}=await b.from("assets").select("id, filename, file_path").in("id",a).eq("user_id",c.id);if(!f||0===f.length)return{urls:[],error:"No assets found"};return{urls:(await Promise.all(f.map(async a=>{try{let b=await (0,e.getSignedUrl)(a.file_path);return{id:a.id,filename:a.filename,url:b}}catch{return{id:a.id,filename:a.filename,url:""}}}))).filter(a=>a.url)}}catch(a){return{urls:[],error:a instanceof Error?a.message:"Failed to get download URLs"}}}async function n(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return{models:[],error:"Not authenticated"};let{data:c,error:e}=await a.from("ai_models").select("id, name").eq("user_id",b.id).eq("is_active",!0).order("name",{ascending:!0});if(e)return{models:[],error:e.message};return{models:c||[]}}catch(a){return{models:[],error:a instanceof Error?a.message:"Failed to fetch models"}}}(0,a.i(13095).ensureServerEntryExports)([f,g,h,i,j,k,l,m,n]),(0,b.registerServerReference)(f,"40053fe9a2f7c6e98c710addb551de7b067aafee8f",null),(0,b.registerServerReference)(g,"400f9cd13317e2cd5ffcd01c986e487acfed902af0",null),(0,b.registerServerReference)(h,"602e1c845f8630f5f412531edc4cf883cf93a23a97",null),(0,b.registerServerReference)(i,"401a61d277e1e8de37b642ff39d23bca1ab85e7ae1",null),(0,b.registerServerReference)(j,"00e62f429024c16383a5ef0f4854051bd69a26996f",null),(0,b.registerServerReference)(k,"40b258e326f20bb2dbc968a496bcf015cdae5e7353",null),(0,b.registerServerReference)(l,"607eee48e074499ac9911884e2acd0c8a36b9c8806",null),(0,b.registerServerReference)(m,"4066e82f12aa11473234b4a7222a4f5877a074ce8b",null),(0,b.registerServerReference)(n,"00dbb8c71377858bf5f6437fd9bbf73a69066a70b9",null),a.s(["bulkAssignModelAction",()=>l,"bulkDeleteAssetsAction",()=>k,"deleteAssetAction",()=>i,"getAssetsAction",()=>f,"getModelsListAction",()=>n,"getSignedUrlsAction",()=>m,"getUserTagsAction",()=>j,"toggleFavoriteAction",()=>g,"updateTagsAction",()=>h])},46770,a=>{"use strict";var b=a.i(73370);a.s([],8751),a.i(8751),a.s(["00dbb8c71377858bf5f6437fd9bbf73a69066a70b9",()=>b.getModelsListAction,"00e62f429024c16383a5ef0f4854051bd69a26996f",()=>b.getUserTagsAction,"40053fe9a2f7c6e98c710addb551de7b067aafee8f",()=>b.getAssetsAction,"400f9cd13317e2cd5ffcd01c986e487acfed902af0",()=>b.toggleFavoriteAction,"401a61d277e1e8de37b642ff39d23bca1ab85e7ae1",()=>b.deleteAssetAction,"4066e82f12aa11473234b4a7222a4f5877a074ce8b",()=>b.getSignedUrlsAction,"40b258e326f20bb2dbc968a496bcf015cdae5e7353",()=>b.bulkDeleteAssetsAction,"602e1c845f8630f5f412531edc4cf883cf93a23a97",()=>b.updateTagsAction,"607eee48e074499ac9911884e2acd0c8a36b9c8806",()=>b.bulkAssignModelAction],46770)}];

//# sourceMappingURL=_309aafd3._.js.map