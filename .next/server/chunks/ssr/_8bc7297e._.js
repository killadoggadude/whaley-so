module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},43957,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349);function e(a){let b=a.match(/instagram\.com\/(?:[^/]+\/)?(?:reel|p)\/([A-Za-z0-9_-]+)/);return b?b[1]:null}let f="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36";async function g(a){try{let b=`https://www.instagram.com/reel/${a}/`,c=await fetch(b,{headers:{"User-Agent":"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",Accept:"text/html"},redirect:"follow"});if(!c.ok)return null;let d=await c.text(),e=d.match(/"og:image"\s*[^>]*content="([^"]+)"/);if(!e){let a=d.match(/property="og:image"\s*content="([^"]+)"/);if(!a)return null;return h(a[1])}return h(e[1])}catch{return null}}async function h(a){try{let b=a.replace(/&amp;/g,"&"),c=await fetch(b,{headers:{"User-Agent":f},redirect:"follow"});if(!c.ok||!(c.headers.get("content-type")||"").startsWith("image/"))return null;let d=await c.arrayBuffer();return Buffer.from(d)}catch{return null}}async function i(a){try{let b=`https://www.tiktok.com/oembed?url=${encodeURIComponent(a)}`,c=await fetch(b,{headers:{"User-Agent":f}});if(!c.ok)return null;let d=(await c.json()).thumbnail_url;if(!d)return null;let e=await fetch(d,{headers:{"User-Agent":f}});if(!e.ok)return null;let g=await e.arrayBuffer();return Buffer.from(g)}catch{return null}}async function j(a){try{let b=function(a){let b=a.match(/youtu\.be\/([A-Za-z0-9_-]{11})/);if(b)return b[1];let c=a.match(/youtube\.com\/(?:watch\?.*v=|shorts\/|embed\/)([A-Za-z0-9_-]{11})/);return c?c[1]:null}(a);if(!b)return null;for(let a of[`https://img.youtube.com/vi/${b}/maxresdefault.jpg`,`https://img.youtube.com/vi/${b}/hqdefault.jpg`]){let b=await fetch(a);if(b.ok&&(b.headers.get("content-type")||"").startsWith("image/")){let a=await b.arrayBuffer();return Buffer.from(a)}}return null}catch{return null}}async function k(a,b,c){switch(b){case"instagram":{let b=c||e(a);if(!b)return null;return g(b)}case"tiktok":return i(a);case"youtube":return j(a);default:return null}}let l="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36";async function m(a,b){switch(b){case"instagram":return n(a);case"tiktok":return p(a);case"youtube":return q(a);default:return 0}}async function n(a){let b=e(a);if(!b)return 0;try{let a=`https://www.instagram.com/reel/${b}/`,c=await fetch(a,{headers:{"User-Agent":"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",Accept:"text/html"},redirect:"follow"});if(c.ok){let a=await c.text(),d=a.match(/userInteractionCount["']?\s*[:=]\s*["']?(\d[\d,]*)/i);if(d){let a=parseInt(d[1].replace(/,/g,""),10);if(a>0)return console.log(`[View Count] Instagram scrape found: ${a} views for ${b}`),a}for(let c of[/(\d[\d,.]*[KMB]?)\s*(?:views|plays|Aufrufe)/i,/video_view_count["']?\s*[:=]\s*["']?(\d[\d,]*)/i,/play_count["']?\s*[:=]\s*["']?(\d[\d,]*)/i,/"view_count"\s*:\s*(\d+)/i]){let d=a.match(c);if(d){let a=function(a){if(!a)return 0;let b=a.replace(/,/g,"").trim(),c=b.match(/^(\d+\.?\d*)\s*([KMB])$/i);if(c){let a=parseFloat(c[1]);switch(c[2].toUpperCase()){case"K":return Math.round(1e3*a);case"M":return Math.round(1e6*a);case"B":return Math.round(1e9*a)}}let d=parseInt(b,10);return isNaN(d)?0:d}(d[1]);if(a>0)return console.log(`[View Count] Instagram pattern found: ${a} views for ${b}`),a}}}}catch(a){console.warn("[View Count] Instagram page scrape failed:",a)}return await o(a)}async function o(a){try{let b=`https://www.instagram.com/api/v1/oembed/?url=${encodeURIComponent(a)}`,c=await fetch(b,{headers:{"User-Agent":l}});if(!c.ok)return 0;let d=await c.json(),e=d.view_count||d.video_view_count||d.play_count||0;return"number"==typeof e?e:0}catch(a){return console.warn("[View Count] Instagram oEmbed failed:",a),0}}async function p(a){try{let b=`https://www.tiktok.com/oembed?url=${encodeURIComponent(a)}`;return!(await fetch(b,{headers:{"User-Agent":l}})).ok,0}catch(a){return console.warn("[View Count] TikTok oEmbed failed:",a),0}}async function q(a){let b=process.env.YOUTUBE_API_KEY;if(!b)return 0;try{let c=function(a){let b=a.match(/youtu\.be\/([A-Za-z0-9_-]{11})/);if(b)return b[1];let c=a.match(/youtube\.com\/(?:watch\?.*v=|shorts\/|embed\/)([A-Za-z0-9_-]{11})/);return c?c[1]:null}(a);if(!c)return 0;let d=`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${c}&key=${b}`,e=await fetch(d);if(!e.ok)return console.error("[View Count] YouTube API failed:",await e.text()),0;let f=await e.json(),g=f.items?.[0]?.statistics?.viewCount;return g?parseInt(g,10):0}catch(a){return console.error("[View Count] YouTube API error:",a),0}}async function r(a){try{let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{reels:[],total:0,error:"Not authenticated"};let e=b.from("viral_reels").select("*",{count:"exact"}).eq("user_id",c.id);a?.search&&(e=e.ilike("notes",`%${a.search}%`)),a?.is_favorite!==void 0&&(e=e.eq("is_favorite",a.is_favorite)),a?.min_views!==void 0&&(e=e.gte("view_count",a.min_views)),a?.max_views!==void 0&&(e=e.lte("view_count",a.max_views)),a?.tags&&a.tags.length>0&&(e=e.overlaps("tags",a.tags));let f=a?.limit||12,g=a?.offset||0;e=e.order("created_at",{ascending:!1}).range(g,g+f-1);let{data:h,error:i,count:j}=await e;if(i)return{reels:[],total:0,error:i.message};return{reels:h||[],total:j||0}}catch(a){return{reels:[],total:0,error:a instanceof Error?a.message:"Failed to fetch viral reels"}}}async function s(a){try{let b=await (0,d.createClient)(),{data:{user:f}}=await b.auth.getUser();if(!f)return{error:"Not authenticated"};let g=a.url.trim();if(!g)return{error:"URL is required"};let h=g.includes("instagram.com")?"instagram":g.includes("tiktok.com")?"tiktok":g.includes("youtube.com")||g.includes("youtu.be")?"youtube":null;if(!h)return{error:"Unsupported URL. Please use an Instagram reel link."};if("instagram"===h&&!/^https?:\/\/(www\.)?instagram\.com\/([^/]+\/)?(reel|p)\/[A-Za-z0-9_-]+/.test(g))return{error:"Invalid Instagram reel URL. Use format: instagram.com/reel/..."};let i="instagram"===h?e(g):null,{data:j,error:l}=await b.from("viral_reels").insert({user_id:f.id,url:g,platform:h,shortcode:i,notes:a.notes?.trim()||"",tags:a.tags||[]}).select().single();if(l){if("23505"===l.code)return{error:"You've already saved this reel."};return{error:l.message}}try{let c=a.viewCount||0;c||(c=await m(g,h));let d=a.tags||[];await b.from("viral_reels").update({view_count:c,tags:d}).eq("id",j.id),j.view_count=c,j.tags=d}catch(a){console.error("Failed to fetch view count:",a)}try{let a=await k(g,h,i);if(a&&j){let c=`thumbnails/viral-reels/${j.id}.jpg`,{error:d}=await b.storage.from("assets").upload(c,a,{contentType:"image/jpeg",upsert:!0});d||(await b.from("viral_reels").update({thumbnail_url:c}).eq("id",j.id),j.thumbnail_url=c)}}catch{}return(0,c.revalidatePath)("/dashboard/viral-reels"),{reel:j}}catch(a){return{error:a instanceof Error?a.message:"Failed to add viral reel"}}}async function t(a,b){try{let e=await (0,d.createClient)(),{data:{user:f}}=await e.auth.getUser();if(!f)return{success:!1,error:"Not authenticated"};let g={updated_at:new Date().toISOString()};void 0!==b.notes&&(g.notes=b.notes.trim()),void 0!==b.tags&&(g.tags=b.tags);let{error:h}=await e.from("viral_reels").update(g).eq("id",a).eq("user_id",f.id);if(h)return{success:!1,error:h.message};return(0,c.revalidatePath)("/dashboard/viral-reels"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update viral reel"}}}async function u(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{data:f}=await b.from("viral_reels").select("is_favorite").eq("id",a).eq("user_id",e.id).single();if(!f)return{success:!1,error:"Reel not found"};let{error:g}=await b.from("viral_reels").update({is_favorite:!f.is_favorite}).eq("id",a).eq("user_id",e.id);if(g)return{success:!1,error:g.message};return(0,c.revalidatePath)("/dashboard/viral-reels"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to toggle favorite"}}}async function v(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{error:f}=await b.from("viral_reels").delete().eq("id",a).eq("user_id",e.id);if(f)return{success:!1,error:f.message};return(0,c.revalidatePath)("/dashboard/viral-reels"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete viral reel"}}}async function w(a){try{let b=await (0,d.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{success:!1,deletedCount:0,error:"Not authenticated"};if(0===a.length)return{success:!1,deletedCount:0,error:"No reels specified"};let{error:f,count:g}=await b.from("viral_reels").delete({count:"exact"}).in("id",a).eq("user_id",e.id);if(f)return{success:!1,deletedCount:0,error:f.message};return(0,c.revalidatePath)("/dashboard/viral-reels"),{success:!0,deletedCount:g||0}}catch(a){return{success:!1,deletedCount:0,error:a instanceof Error?a.message:"Failed to bulk delete viral reels"}}}async function x(){try{let a=await (0,d.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return[];let{data:c}=await a.from("viral_reels").select("tags").eq("user_id",b.id);if(!c)return[];let e=c.flatMap(a=>a.tags||[]);return[...new Set(e)].sort()}catch{return[]}}(0,a.i(13095).ensureServerEntryExports)([r,s,t,u,v,w,x]),(0,b.registerServerReference)(r,"40ee820b5d7fede4d20c0ae70ca799e972272788fe",null),(0,b.registerServerReference)(s,"40945b4657fbbc84854f55e077ec83fce6396ebaf6",null),(0,b.registerServerReference)(t,"609877132c564638c22b09d71f8ad02b8cdc0d045c",null),(0,b.registerServerReference)(u,"403eb245afb5826b6b80265661ba0eff0df1e0f6b2",null),(0,b.registerServerReference)(v,"40e6bfcc2e50502a85d47d4fb21cef385976e4ab82",null),(0,b.registerServerReference)(w,"404b7f00ef4752c44c0f4db313046725fd1d05c718",null),(0,b.registerServerReference)(x,"00554dc6f872061ea18cf7d867f09baf126b22a4cb",null),a.s(["addViralReelAction",()=>s,"bulkDeleteReelsAction",()=>w,"deleteViralReelAction",()=>v,"getReelTagsAction",()=>x,"getViralReelsAction",()=>r,"toggleReelFavoriteAction",()=>u,"updateViralReelAction",()=>t],43957)},51288,a=>{"use strict";var b=a.i(43957);a.s([],19418),a.i(19418),a.s(["00554dc6f872061ea18cf7d867f09baf126b22a4cb",()=>b.getReelTagsAction,"403eb245afb5826b6b80265661ba0eff0df1e0f6b2",()=>b.toggleReelFavoriteAction,"404b7f00ef4752c44c0f4db313046725fd1d05c718",()=>b.bulkDeleteReelsAction,"40945b4657fbbc84854f55e077ec83fce6396ebaf6",()=>b.addViralReelAction,"40e6bfcc2e50502a85d47d4fb21cef385976e4ab82",()=>b.deleteViralReelAction,"40ee820b5d7fede4d20c0ae70ca799e972272788fe",()=>b.getViralReelsAction,"609877132c564638c22b09d71f8ad02b8cdc0d045c",()=>b.updateViralReelAction],51288)}];

//# sourceMappingURL=_8bc7297e._.js.map