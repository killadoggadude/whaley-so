module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},3600,78725,a=>{"use strict";var b=a.i(16349),c=a.i(54799);let d="aes-256-gcm";function e(){let a=process.env.API_KEY_ENCRYPTION_SECRET;if(!a)throw Error("API_KEY_ENCRYPTION_SECRET is not set");return Buffer.from(a,"hex")}function f(a){let b=e(),f=c.default.randomBytes(16),g=c.default.createCipheriv(d,b,f),h=g.update(a,"utf8","hex");h+=g.final("hex");let i=g.getAuthTag();return`${f.toString("hex")}:${i.toString("hex")}:${h}`}function g(a){let b=e(),f=a.split(":");if(3!==f.length)throw Error("Invalid encrypted data format");let g=Buffer.from(f[0],"hex"),h=Buffer.from(f[1],"hex"),i=f[2],j=c.default.createDecipheriv(d,b,g);j.setAuthTag(h);let k=j.update(i,"hex","utf8");return k+j.final("utf8")}async function h(){let a=await (0,b.createClient)(),{data:{user:c}}=await a.auth.getUser();if(!c)throw Error("Not authenticated");let{data:d,error:e}=await a.from("user_api_keys").select("service, encrypted_api_key, created_at, updated_at").eq("user_id",c.id);if(e)throw Error(`Failed to fetch API keys: ${e.message}`);return(d||[]).map(a=>{var b;return{service:a.service,masked_key:(b=g(a.encrypted_api_key)).length<=4?"••••":"••••••••••"+b.slice(-4),created_at:a.created_at,updated_at:a.updated_at}})}async function i(a,c){let d=await (0,b.createClient)(),{data:{user:e}}=await d.auth.getUser();if(!e)throw Error("Not authenticated");let g=f(c),{data:h}=await d.from("user_api_keys").select("id").eq("user_id",e.id).eq("service",a).single();if(h){let{error:b}=await d.from("user_api_keys").update({encrypted_api_key:g}).eq("user_id",e.id).eq("service",a);if(b)throw Error(`Failed to update API key: ${b.message}`)}else{let{error:b}=await d.from("user_api_keys").insert({user_id:e.id,service:a,encrypted_api_key:g});if(b)throw Error(`Failed to save API key: ${b.message}`)}}async function j(a){let c=await (0,b.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)throw Error("Not authenticated");let{error:e}=await c.from("user_api_keys").delete().eq("user_id",d.id).eq("service",a);if(e)throw Error(`Failed to delete API key: ${e.message}`)}a.s(["deleteApiKey",()=>j,"getMaskedKeys",()=>h,"upsertApiKey",()=>i],3600);var k=a.i(37936);async function l(a){let b=new URLSearchParams({grant_type:"th_refresh_token",access_token:a}),c=await fetch(`https://graph.threads.net/refresh_access_token?${b.toString()}`);if(!c.ok){let a=await c.text();throw Error(`Failed to refresh token: ${a}`)}let d=await c.json();return{access_token:d.access_token,expires_in:d.expires_in}}function m(a){let b=new Date(a),c=new Date,d=b.getTime()-c.getTime();return d<=0?"expired":d<=6048e5?"expiring_soon":"valid"}async function n(){let a=await (0,b.createClient)(),{data:{user:c}}=await a.auth.getUser();if(!c)throw Error("Not authenticated");let{data:d,error:e}=await a.from("threads_accounts").select("*").eq("user_id",c.id).order("created_at",{ascending:!1});if(e)throw Error(`Failed to fetch Threads accounts: ${e.message}`);return{accounts:(d||[]).map(a=>({id:a.id,user_id:a.user_id,threads_user_id:a.threads_user_id,username:a.username,profile_pic_url:a.profile_pic_url,token_expires_at:a.token_expires_at,is_active:a.is_active,created_at:a.created_at,updated_at:a.updated_at,token_status:m(a.token_expires_at)}))}}async function o(a){let c=await (0,b.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return{success:!1,error:"Not authenticated"};let{data:e,error:h}=await c.from("threads_accounts").select("*").eq("id",a).eq("user_id",d.id).single();if(h||!e)return{success:!1,error:"Account not found"};try{var i;let b=(i=e.access_token,g(i)),h=m(e.token_expires_at);if("expired"===h)return{success:!1,error:"Token has expired. Please reconnect your Threads account."};let{access_token:j,expires_in:k}=await l(b),n=f(j),o=new Date(Date.now()+1e3*k).toISOString(),{error:p}=await c.from("threads_accounts").update({access_token:n,token_expires_at:o}).eq("id",a).eq("user_id",d.id);if(p)return{success:!1,error:"Failed to save refreshed token"};return{success:!0}}catch(a){return console.error("Token refresh error:",a),{success:!1,error:"Failed to refresh token. Please reconnect your account."}}}async function p(a){let c=await (0,b.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return{success:!1,error:"Not authenticated"};let{error:e}=await c.from("threads_accounts").delete().eq("id",a).eq("user_id",d.id);return e?{success:!1,error:"Failed to disconnect account"}:{success:!0}}async function q(a,c){let d=await (0,b.createClient)(),{data:{user:e}}=await d.auth.getUser();if(!e)return{success:!1,error:"Not authenticated"};let{error:f}=await d.from("threads_accounts").update({is_active:c}).eq("id",a).eq("user_id",e.id);return f?{success:!1,error:"Failed to update account"}:{success:!0}}(0,a.i(13095).ensureServerEntryExports)([n,o,p,q]),(0,k.registerServerReference)(n,"00dfa082f13118a893a3287a138690eae3ecd174cb",null),(0,k.registerServerReference)(o,"40ebede4a23e2e7dd4f1eb6b249ec3a0bd044da631",null),(0,k.registerServerReference)(p,"4034bfbcb3bb5e9a50aae756fafc590c863d8baafc",null),(0,k.registerServerReference)(q,"6094ff390220b11237cc3d065ce48e36c4ec4e19da",null),a.s(["disconnectThreadsAction",()=>p,"getThreadsAccountsAction",()=>n,"refreshTokenAction",()=>o,"toggleThreadsActiveAction",()=>q],78725)},14887,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(3600);async function e(a,b){try{if(!b||0===b.trim().length)return{success:!1,error:"API key cannot be empty"};return await (0,d.upsertApiKey)(a,b.trim()),(0,c.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to save API key"}}}async function f(a){try{return await (0,d.deleteApiKey)(a),(0,c.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete API key"}}}(0,a.i(13095).ensureServerEntryExports)([e,f]),(0,b.registerServerReference)(e,"6099e9cb2faad4ef580894dabc806fdb087b33e0ea",null),(0,b.registerServerReference)(f,"40686b42855a566696d8a473cc04cfda72769a2bbc",null);var g=a.i(78725);a.s([],22637),a.i(22637),a.s(["00dfa082f13118a893a3287a138690eae3ecd174cb",()=>g.getThreadsAccountsAction,"4034bfbcb3bb5e9a50aae756fafc590c863d8baafc",()=>g.disconnectThreadsAction,"40686b42855a566696d8a473cc04cfda72769a2bbc",()=>f,"40ebede4a23e2e7dd4f1eb6b249ec3a0bd044da631",()=>g.refreshTokenAction,"6094ff390220b11237cc3d065ce48e36c4ec4e19da",()=>g.toggleThreadsActiveAction,"6099e9cb2faad4ef580894dabc806fdb087b33e0ea",()=>e],14887)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__41186628._.js.map