{"version":3,"sources":["../../../../src/components/dancing-reel/dancing-reel-tabs.tsx","../../../../src/components/dancing-reel/single-dancing-reel.tsx","../../../../src/components/dancing-reel/bulk-dancing-reel.tsx"],"sourcesContent":["\"use client\";\n\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { SingleDancingReel } from \"./single-dancing-reel\";\nimport { BulkDancingReel } from \"./bulk-dancing-reel\";\nimport { Music, Layers } from \"lucide-react\";\nimport type { AiModelWithImages } from \"@/types\";\n\ninterface DancingReelTabsProps {\n  aiModels: AiModelWithImages[];\n}\n\nexport function DancingReelTabs({ aiModels }: DancingReelTabsProps) {\n  return (\n    <Tabs defaultValue=\"single\" className=\"space-y-4\">\n      <TabsList>\n        <TabsTrigger value=\"single\" className=\"gap-1.5\">\n          <Music className=\"h-3.5 w-3.5\" />\n          Single Video\n        </TabsTrigger>\n        <TabsTrigger value=\"bulk\" className=\"gap-1.5\">\n          <Layers className=\"h-3.5 w-3.5\" />\n          Bulk Generate\n        </TabsTrigger>\n      </TabsList>\n\n      <TabsContent value=\"single\">\n        <SingleDancingReel aiModels={aiModels} />\n      </TabsContent>\n\n      <TabsContent value=\"bulk\">\n        <BulkDancingReel aiModels={aiModels} />\n      </TabsContent>\n    </Tabs>\n  );\n}\n","\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Loader2,\n  Music,\n  AlertCircle,\n  CheckCircle2,\n  RefreshCw,\n  Upload,\n  Search,\n  ImageIcon,\n  Download,\n  Save,\n  Check,\n  Clock,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport { getAssetsAction } from \"@/app/dashboard/assets/actions\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport type { AiModelWithImages, AssetWithUrl } from \"@/types\";\n\ninterface SingleDancingReelProps {\n  aiModels: AiModelWithImages[];\n}\n\nconst DEFAULT_PROMPT =\n  \"natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion\";\n\nconst POLL_INTERVAL_MS = 5000;\nconst MAX_POLL_ATTEMPTS = 200; // ~16 minutes\n\ntype GenerationState =\n  | \"idle\"\n  | \"submitting\"\n  | \"polling\"\n  | \"completed\"\n  | \"failed\";\n\nexport function SingleDancingReel({ aiModels }: SingleDancingReelProps) {\n  // Image selection\n  const [images, setImages] = useState<AssetWithUrl[]>([]);\n  const [total, setTotal] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [search, setSearch] = useState(\"\");\n  const [showAll, setShowAll] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [selectedImageId, setSelectedImageId] = useState<string | null>(null);\n  const [selectedImageUrl, setSelectedImageUrl] = useState<string | null>(null);\n  const [selectedModelId, setSelectedModelId] = useState<string>(\"\");\n\n  // Prompt & settings\n  const [prompt, setPrompt] = useState(DEFAULT_PROMPT);\n  const [duration, setDuration] = useState<5 | 10>(5);\n\n  // Generation state\n  const [state, setState] = useState<GenerationState>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n  const [pollCount, setPollCount] = useState(0);\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\n  const [savedAssetId, setSavedAssetId] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const pollingRef = useRef(false);\n\n  const selectedModel = aiModels.find((m) => m.id === selectedModelId) || null;\n  const modelImages = selectedModel?.reference_images || [];\n  const hasModelImages = modelImages.length > 0;\n\n  // Fetch all images from asset library\n  const fetchImages = useCallback(\n    async (append: boolean) => {\n      setLoading(true);\n      const offset = append ? images.length : 0;\n      const result = await getAssetsAction({\n        file_type: \"image\",\n        search: search || undefined,\n        sort_by: \"created_at\",\n        sort_order: \"desc\",\n        limit: 30,\n        offset,\n      });\n\n      if (append) {\n        setImages((prev) => [...prev, ...result.assets]);\n      } else {\n        setImages(result.assets);\n      }\n      setTotal(result.total);\n      setLoading(false);\n    },\n    [search, images.length]\n  );\n\n  useEffect(() => {\n    fetchImages(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleSearchChange = (value: string) => {\n    setSearch(value);\n    const timeout = setTimeout(() => fetchImages(false), 300);\n    return () => clearTimeout(timeout);\n  };\n\n  const handleImageSelect = (id: string, signedUrl: string) => {\n    setSelectedImageId(id);\n    setSelectedImageUrl(signedUrl);\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith(\"image/\")) {\n      toast.error(\"Please select an image file\");\n      return;\n    }\n    if (file.size > 50 * 1024 * 1024) {\n      toast.error(\"File exceeds 50MB size limit\");\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const supabase = createClient();\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        toast.error(\"Not authenticated\");\n        return;\n      }\n\n      const uuid = crypto.randomUUID();\n      const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\");\n      const filePath = `${user.id}/image/${uuid}_${safeName}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from(\"assets\")\n        .upload(filePath, file, { contentType: file.type, upsert: false });\n\n      if (uploadError) {\n        toast.error(`Upload failed: ${uploadError.message}`);\n        return;\n      }\n\n      const { data: asset, error: dbError } = await supabase\n        .from(\"assets\")\n        .insert({\n          user_id: user.id,\n          filename: file.name,\n          file_path: filePath,\n          file_type: \"image\",\n          mime_type: file.type,\n          file_size: file.size,\n          tags: [\"dancing-reel\", \"portrait\"],\n          metadata: {},\n        })\n        .select(\"id\")\n        .single();\n\n      if (dbError) {\n        await supabase.storage.from(\"assets\").remove([filePath]);\n        toast.error(`Database error: ${dbError.message}`);\n        return;\n      }\n\n      const { data: urlData } = await supabase.storage\n        .from(\"assets\")\n        .createSignedUrl(filePath, 3600);\n\n      if (urlData?.signedUrl) {\n        setSelectedImageId(asset.id);\n        setSelectedImageUrl(urlData.signedUrl);\n        toast.success(\"Image uploaded!\");\n        // Refresh images list\n        fetchImages(false);\n      }\n    } catch {\n      toast.error(\"Failed to upload image\");\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  };\n\n  // Cleanup polling on unmount\n  useEffect(() => {\n    return () => {\n      pollingRef.current = false;\n    };\n  }, []);\n\n  const startPolling = useCallback(\n    async (taskId: string) => {\n      pollingRef.current = true;\n      let attempts = 0;\n      let consecutiveErrors = 0;\n\n      while (pollingRef.current && attempts < MAX_POLL_ATTEMPTS) {\n        attempts++;\n        setPollCount(attempts);\n\n        try {\n          const res = await fetch(\n            `/api/talking-head/status?taskId=${encodeURIComponent(taskId)}`\n          );\n          const data = await res.json();\n\n          if (data.status === \"completed\" && data.videoUrl) {\n            pollingRef.current = false;\n            setVideoUrl(data.videoUrl);\n            setState(\"completed\");\n            toast.success(\"Dancing reel generated!\");\n            return;\n          }\n\n          if (data.status === \"failed\") {\n            pollingRef.current = false;\n            setState(\"failed\");\n            setError(data.error || \"Video generation failed\");\n            return;\n          }\n\n          consecutiveErrors = 0;\n          await new Promise((r) => setTimeout(r, POLL_INTERVAL_MS));\n        } catch {\n          consecutiveErrors++;\n          if (consecutiveErrors >= 3) {\n            pollingRef.current = false;\n            setState(\"failed\");\n            setError(\"Network error after multiple retries\");\n            return;\n          }\n          await new Promise((r) => setTimeout(r, POLL_INTERVAL_MS));\n        }\n      }\n\n      if (pollingRef.current) {\n        pollingRef.current = false;\n        setState(\"failed\");\n        setError(`Timed out after ${attempts} polls (~${Math.round(attempts * POLL_INTERVAL_MS / 1000)}s)`);\n      }\n    },\n    []\n  );\n\n  const handleGenerate = async () => {\n    if (!selectedImageUrl) {\n      toast.error(\"Select an image first\");\n      return;\n    }\n    if (!prompt.trim()) {\n      toast.error(\"Enter a prompt\");\n      return;\n    }\n\n    setState(\"submitting\");\n    setError(null);\n    setPollCount(0);\n    setVideoUrl(null);\n    setSavedAssetId(null);\n\n    try {\n      const res = await fetch(\"/api/dancing-reel/submit\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          imageUrl: selectedImageUrl,\n          prompt: prompt.trim(),\n          duration,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        setState(\"failed\");\n        setError(data.error || \"Failed to submit dancing reel generation\");\n        return;\n      }\n\n      setState(\"polling\");\n      toast.info(\"Dancing reel generation started...\");\n      startPolling(data.taskId);\n    } catch {\n      setState(\"failed\");\n      setError(\"Failed to submit dancing reel generation\");\n    }\n  };\n\n  const handleSave = async () => {\n    if (!videoUrl) return;\n    setSaving(true);\n    try {\n      const res = await fetch(\"/api/dancing-reel/save\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ videoUrl }),\n      });\n      const data = await res.json();\n      if (res.ok) {\n        setSavedAssetId(data.assetId);\n        toast.success(\"Video saved to library!\");\n      } else {\n        toast.error(data.error || \"Failed to save\");\n      }\n    } catch {\n      toast.error(\"Failed to save video\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleReset = () => {\n    setState(\"idle\");\n    setError(null);\n    setPollCount(0);\n    setVideoUrl(null);\n    setSavedAssetId(null);\n    pollingRef.current = false;\n  };\n\n  const displayImages = !showAll && hasModelImages ? modelImages : images;\n  const isProcessing = state === \"submitting\" || state === \"polling\";\n  const elapsedSeconds = pollCount * (POLL_INTERVAL_MS / 1000);\n  const progressPercent = Math.min((pollCount / MAX_POLL_ATTEMPTS) * 100, 95);\n\n  const estimatedCost = duration === 5 ? 0.35 : 0.70;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Step 1: Select Image */}\n      <div className=\"rounded-lg border border-border bg-card p-5 space-y-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold\">\n            1\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"text-base font-semibold\">Select Image</h3>\n            <p className=\"text-sm text-muted-foreground mt-0.5\">\n              Choose a portrait image (ideally 9:16 aspect ratio) to animate into a dancing video.\n            </p>\n          </div>\n        </div>\n\n        {/* Model filter + Upload row */}\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          {aiModels.length > 0 && (\n            <select\n              value={selectedModelId}\n              onChange={(e) => {\n                setSelectedModelId(e.target.value);\n                setShowAll(!e.target.value);\n              }}\n              className=\"h-9 rounded-md border border-input bg-background px-3 text-sm\"\n            >\n              <option value=\"\">All Images</option>\n              {aiModels.map((m) => (\n                <option key={m.id} value={m.id}>\n                  {m.name} ({m.reference_images.length})\n                </option>\n              ))}\n            </select>\n          )}\n\n          <div className=\"ml-auto\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleUpload}\n              className=\"hidden\"\n            />\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => fileInputRef.current?.click()}\n              disabled={uploading || isProcessing}\n            >\n              {uploading ? (\n                <Loader2 className=\"h-4 w-4 mr-1.5 animate-spin\" />\n              ) : (\n                <Upload className=\"h-4 w-4 mr-1.5\" />\n              )}\n              {uploading ? \"Uploading...\" : \"Upload Image\"}\n            </Button>\n          </div>\n        </div>\n\n        {/* Search */}\n        {(showAll || !hasModelImages) && (\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search images...\"\n              value={search}\n              onChange={(e) => handleSearchChange(e.target.value)}\n              className=\"pl-9\"\n            />\n          </div>\n        )}\n\n        {/* Image grid */}\n        {displayImages.length === 0 && !loading ? (\n          <div className=\"flex flex-col items-center justify-center py-8\">\n            <p className=\"text-sm text-muted-foreground\">\n              No images found. Upload an image above or add images in the{\" \"}\n              <a href=\"/dashboard/assets\" className=\"underline font-medium\">\n                Asset Library\n              </a>.\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2\">\n            {displayImages.map((image) => {\n              const isSelected = selectedImageId === image.id;\n              return (\n                <button\n                  key={image.id}\n                  type=\"button\"\n                  disabled={isProcessing}\n                  className={cn(\n                    \"relative aspect-[9/16] overflow-hidden rounded-md border-2 transition-all\",\n                    isSelected\n                      ? \"border-accent-blue ring-2 ring-accent-blue/20\"\n                      : \"border-transparent hover:border-muted-foreground/30\",\n                    isProcessing && \"opacity-50 pointer-events-none\"\n                  )}\n                  onClick={() => handleImageSelect(image.id, image.signed_url)}\n                >\n                  <img\n                    src={image.signed_url}\n                    alt={image.filename}\n                    className=\"h-full w-full object-cover\"\n                    loading=\"lazy\"\n                  />\n                  {isSelected && (\n                    <div className=\"absolute inset-0 bg-accent-blue/20 flex items-center justify-center\">\n                      <div className=\"h-6 w-6 rounded-full bg-accent-blue flex items-center justify-center\">\n                        <Check className=\"h-4 w-4 text-primary-foreground\" />\n                      </div>\n                    </div>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Load more */}\n        {(showAll || !hasModelImages) && images.length < total && (\n          <div className=\"flex justify-center\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => fetchImages(true)}\n              disabled={loading}\n            >\n              {loading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Load More\"}\n            </Button>\n          </div>\n        )}\n\n        {selectedImageId && (\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              <Check className=\"h-3 w-3\" />\n              Image selected\n            </Badge>\n          </div>\n        )}\n      </div>\n\n      {/* Step 2: Prompt & Settings */}\n      <div className=\"rounded-lg border border-border bg-card p-5 space-y-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold\">\n            2\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"text-base font-semibold\">Prompt & Settings</h3>\n            <p className=\"text-sm text-muted-foreground mt-0.5\">\n              Customize the dance prompt and choose video duration. The default prompt works well for most cases.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <div className=\"space-y-1.5\">\n            <Label>Dance Prompt</Label>\n            <Textarea\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              placeholder=\"Describe the dancing motion...\"\n              rows={4}\n              className=\"resize-y text-sm\"\n              disabled={isProcessing}\n            />\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs text-muted-foreground\">\n                {prompt.trim().split(/\\s+/).filter(Boolean).length} words\n              </span>\n              {prompt !== DEFAULT_PROMPT && (\n                <button\n                  type=\"button\"\n                  onClick={() => setPrompt(DEFAULT_PROMPT)}\n                  className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n                  disabled={isProcessing}\n                >\n                  Reset to default\n                </button>\n              )}\n            </div>\n          </div>\n\n          <div className=\"space-y-1.5\">\n            <Label>Duration</Label>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={duration === 5 ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setDuration(5)}\n                disabled={isProcessing}\n                className=\"flex-1\"\n              >\n                <Clock className=\"h-3.5 w-3.5 mr-1.5\" />\n                5 seconds (~$0.35)\n              </Button>\n              <Button\n                variant={duration === 10 ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setDuration(10)}\n                disabled={isProcessing}\n                className=\"flex-1\"\n              >\n                <Clock className=\"h-3.5 w-3.5 mr-1.5\" />\n                10 seconds (~$0.70)\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Step 3: Generate */}\n      <div className=\"rounded-lg border border-border bg-card p-5 space-y-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold\">\n            3\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"text-base font-semibold\">Generate</h3>\n            <p className=\"text-sm text-muted-foreground mt-0.5\">\n              Generate the dancing reel video. This typically takes 2-5 minutes.\n            </p>\n          </div>\n        </div>\n\n        {/* Progress */}\n        {isProcessing && (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-2\">\n              <Loader2 className=\"h-4 w-4 animate-spin text-accent-blue\" />\n              <span className=\"text-sm font-medium\">\n                {state === \"submitting\" && \"Submitting to Kling 2.6 Pro...\"}\n                {state === \"polling\" && \"Generating dancing video...\"}\n              </span>\n              {state === \"polling\" && (\n                <span className=\"text-xs text-muted-foreground ml-auto\">\n                  {Math.round(elapsedSeconds)}s elapsed\n                </span>\n              )}\n            </div>\n            <Progress value={progressPercent} className=\"h-2\" />\n            <p className=\"text-xs text-muted-foreground text-center\">\n              {state === \"polling\" && pollCount < 20 &&\n                \"Processing your video. This usually takes 2-5 minutes...\"}\n              {state === \"polling\" && pollCount >= 20 && pollCount < 60 &&\n                \"Still processing. Kling 2.6 Pro generates high-quality output...\"}\n              {state === \"polling\" && pollCount >= 60 &&\n                \"Almost there. Please wait...\"}\n            </p>\n          </div>\n        )}\n\n        {/* Completed */}\n        {state === \"completed\" && videoUrl && (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n              <span className=\"text-sm font-medium\">Dancing reel generated!</span>\n            </div>\n            <video\n              controls\n              src={videoUrl}\n              className=\"w-full max-h-[400px] rounded-md bg-black\"\n              preload=\"metadata\"\n            />\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  const a = document.createElement(\"a\");\n                  a.href = videoUrl;\n                  a.download = `dancing-reel-${duration}s.mp4`;\n                  a.target = \"_blank\";\n                  a.click();\n                }}\n              >\n                <Download className=\"h-3.5 w-3.5 mr-1\" />\n                Download\n              </Button>\n              {savedAssetId ? (\n                <Badge variant=\"secondary\" className=\"gap-1\">\n                  <CheckCircle2 className=\"h-3 w-3\" />\n                  Saved\n                </Badge>\n              ) : (\n                <Button size=\"sm\" onClick={handleSave} disabled={saving}>\n                  {saving ? (\n                    <Loader2 className=\"h-3.5 w-3.5 mr-1 animate-spin\" />\n                  ) : (\n                    <Save className=\"h-3.5 w-3.5 mr-1\" />\n                  )}\n                  {saving ? \"Saving...\" : \"Save to Library\"}\n                </Button>\n              )}\n              <Button variant=\"outline\" size=\"sm\" onClick={handleReset}>\n                <RefreshCw className=\"h-3.5 w-3.5 mr-1\" />\n                New Video\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Error */}\n        {error && (\n          <Alert variant=\"destructive\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        )}\n\n        {/* Generate button */}\n        {state === \"idle\" && (\n          <Button\n            onClick={handleGenerate}\n            className=\"w-full\"\n            size=\"lg\"\n            disabled={!selectedImageId || !prompt.trim()}\n          >\n            <Music className=\"h-4 w-4 mr-2\" />\n            Generate Dancing Reel ({duration}s) â€” Est. ${estimatedCost.toFixed(2)}\n          </Button>\n        )}\n\n        {state === \"failed\" && (\n          <Button onClick={handleReset} variant=\"outline\" className=\"w-full\">\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Try Again\n          </Button>\n        )}\n\n        <p className=\"text-xs text-muted-foreground text-center\">\n          Powered by WaveSpeed Kling 2.6 Pro Image-to-Video. Sound is disabled (add music in post).\n        </p>\n      </div>\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Plus,\n  Trash2,\n  Loader2,\n  Music,\n  AlertCircle,\n  CheckCircle2,\n  Upload,\n  Search,\n  ImageIcon,\n  Download,\n  Save,\n  X,\n  Info,\n  Clock,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { getAssetsAction } from \"@/app/dashboard/assets/actions\";\nimport type { AiModelWithImages, AssetWithUrl } from \"@/types\";\n\ninterface BulkDancingReelProps {\n  aiModels: AiModelWithImages[];\n}\n\ninterface DancingJob {\n  id: string;\n  imageId: string | null;\n  imageUrl: string | null;\n  status: \"pending\" | \"submitting\" | \"polling\" | \"completed\" | \"failed\";\n  error?: string;\n  taskId?: string;\n  videoUrl?: string;\n  videoAssetId?: string;\n  pollCount?: number;\n}\n\nconst DEFAULT_PROMPT =\n  \"natural, energetic and realistic sexy dance moves, she is dancing sexy to a tiktok trend music and moving her hips and arms as if she is dancing to a trending song for a tiktok dance video, not talking, no slow motion\";\n\nconst POLL_INTERVAL_MS = 5000;\nconst MAX_POLL_ATTEMPTS = 200;\n\nfunction StepSection({\n  step,\n  title,\n  description,\n  children,\n}: {\n  step: number;\n  title: string;\n  description: string;\n  children: React.ReactNode;\n}) {\n  return (\n    <div className=\"rounded-lg border border-border bg-card p-5 space-y-4\">\n      <div className=\"flex items-start gap-3\">\n        <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold\">\n          {step}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"text-base font-semibold\">{title}</h3>\n            <Info className=\"h-4 w-4 text-muted-foreground\" />\n          </div>\n          <p className=\"text-sm text-muted-foreground mt-0.5\">{description}</p>\n        </div>\n      </div>\n      {children}\n    </div>\n  );\n}\n\nexport function BulkDancingReel({ aiModels }: BulkDancingReelProps) {\n  // Shared settings\n  const [prompt, setPrompt] = useState(DEFAULT_PROMPT);\n  const [duration, setDuration] = useState<5 | 10>(5);\n\n  // Jobs\n  const [jobs, setJobs] = useState<DancingJob[]>([\n    { id: crypto.randomUUID(), imageId: null, imageUrl: null, status: \"pending\" },\n  ]);\n  const [running, setRunning] = useState(false);\n  const pollingRefs = useRef<Map<string, boolean>>(new Map());\n\n  // Image picker dialog\n  const [pickerJobId, setPickerJobId] = useState<string | null>(null);\n  const [pickerImages, setPickerImages] = useState<AssetWithUrl[]>([]);\n  const [pickerTotal, setPickerTotal] = useState(0);\n  const [pickerLoading, setPickerLoading] = useState(false);\n  const [pickerSearch, setPickerSearch] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n  const [dragOverJobId, setDragOverJobId] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Bulk image pool\n  const [bulkImagePool, setBulkImagePool] = useState<Array<{ id: string; url: string }>>([]);\n  const [bulkUploading, setBulkUploading] = useState(false);\n  const [bulkDragOver, setBulkDragOver] = useState(false);\n  const bulkFileInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    return () => {\n      pollingRefs.current.forEach((_, key) => pollingRefs.current.set(key, false));\n    };\n  }, []);\n\n  const addJob = () => {\n    setJobs((prev) => [...prev, { id: crypto.randomUUID(), imageId: null, imageUrl: null, status: \"pending\" }]);\n  };\n\n  const removeJob = (id: string) => {\n    if (jobs.length <= 1) return;\n    pollingRefs.current.set(id, false);\n    setJobs((prev) => prev.filter((j) => j.id !== id));\n  };\n\n  const updateJob = (id: string, updates: Partial<DancingJob>) => {\n    setJobs((prev) => prev.map((j) => (j.id === id ? { ...j, ...updates } : j)));\n  };\n\n  // ---- Image Picker ----\n\n  const fetchPickerImages = useCallback(async (append: boolean) => {\n    setPickerLoading(true);\n    const offset = append ? pickerImages.length : 0;\n    const result = await getAssetsAction({\n      file_type: \"image\",\n      search: pickerSearch || undefined,\n      sort_by: \"created_at\",\n      sort_order: \"desc\",\n      limit: 30,\n      offset,\n    });\n    if (append) {\n      setPickerImages((prev) => [...prev, ...result.assets]);\n    } else {\n      setPickerImages(result.assets);\n    }\n    setPickerTotal(result.total);\n    setPickerLoading(false);\n  }, [pickerSearch, pickerImages.length]);\n\n  useEffect(() => {\n    if (pickerJobId) {\n      setPickerSearch(\"\");\n      fetchPickerImages(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pickerJobId]);\n\n  const handlePickerSearch = (value: string) => {\n    setPickerSearch(value);\n    const t = setTimeout(() => fetchPickerImages(false), 300);\n    return () => clearTimeout(t);\n  };\n\n  const handlePickerSelect = (image: AssetWithUrl) => {\n    if (pickerJobId) {\n      updateJob(pickerJobId, { imageId: image.id, imageUrl: image.signed_url });\n      setPickerJobId(null);\n    }\n  };\n\n  /**\n   * Upload a single image directly to Supabase Storage from the browser.\n   */\n  const handleImageUpload = async (file: File, targetJobId?: string) => {\n    if (!file || !file.type.startsWith(\"image/\")) return null;\n    if (file.size > 50 * 1024 * 1024) {\n      toast.error(\"File exceeds 50MB size limit\");\n      return null;\n    }\n\n    setUploading(true);\n    try {\n      const supabase = createClient();\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        toast.error(\"Not authenticated\");\n        return null;\n      }\n\n      const uuid = crypto.randomUUID();\n      const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\");\n      const filePath = `${user.id}/image/${uuid}_${safeName}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from(\"assets\")\n        .upload(filePath, file, { contentType: file.type, upsert: false });\n\n      if (uploadError) {\n        toast.error(`Upload failed: ${uploadError.message}`);\n        return null;\n      }\n\n      const { data: asset, error: dbError } = await supabase\n        .from(\"assets\")\n        .insert({\n          user_id: user.id,\n          filename: file.name,\n          file_path: filePath,\n          file_type: \"image\",\n          mime_type: file.type,\n          file_size: file.size,\n          tags: [\"dancing-reel\", \"portrait\"],\n          metadata: {},\n        })\n        .select(\"id\")\n        .single();\n\n      if (dbError) {\n        await supabase.storage.from(\"assets\").remove([filePath]);\n        toast.error(`Database error: ${dbError.message}`);\n        return null;\n      }\n\n      const { data: urlData } = await supabase.storage\n        .from(\"assets\")\n        .createSignedUrl(filePath, 3600);\n\n      const uploaded = { id: asset.id, url: urlData?.signedUrl || \"\" };\n      const jobIdToUpdate = targetJobId || pickerJobId;\n      if (jobIdToUpdate) {\n        updateJob(jobIdToUpdate, { imageId: uploaded.id, imageUrl: uploaded.url });\n        if (!targetJobId) setPickerJobId(null);\n      }\n\n      return uploaded;\n    } catch {\n      toast.error(\"Failed to upload image\");\n      return null;\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handlePickerUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) await handleImageUpload(file);\n  };\n\n  const handleDragOver = (e: React.DragEvent, jobId: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!running) setDragOverJobId(jobId);\n  };\n\n  const handleDragLeave = () => {\n    setDragOverJobId(null);\n  };\n\n  const handleDrop = async (e: React.DragEvent, jobId: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOverJobId(null);\n    if (running) return;\n\n    const files = e.dataTransfer.files;\n    if (!files || files.length === 0) return;\n    const file = files[0];\n\n    if (!file.type.startsWith(\"image/\")) {\n      toast.error(\"Only image files are supported\");\n      return;\n    }\n\n    await handleImageUpload(file, jobId);\n  };\n\n  // ---- Bulk Image Pool ----\n\n  const uploadBulkImages = async (files: File[] | FileList) => {\n    setBulkUploading(true);\n\n    const supabase = createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      toast.error(\"Not authenticated\");\n      setBulkUploading(false);\n      return;\n    }\n\n    const validFiles: File[] = [];\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      if (!file.type.startsWith(\"image/\")) continue;\n      if (file.size > 50 * 1024 * 1024) {\n        toast.error(`File \"${file.name}\" exceeds 50MB limit`);\n        continue;\n      }\n      validFiles.push(file);\n    }\n\n    if (validFiles.length === 0) {\n      setBulkUploading(false);\n      return;\n    }\n\n    const CONCURRENCY = 3;\n    const uploadedImages: Array<{ id: string; url: string }> = [];\n    let failedCount = 0;\n\n    for (let i = 0; i < validFiles.length; i += CONCURRENCY) {\n      const batch = validFiles.slice(i, i + CONCURRENCY);\n      const batchResults = await Promise.all(\n        batch.map(async (file) => {\n          try {\n            const uuid = crypto.randomUUID();\n            const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\");\n            const filePath = `${user.id}/image/${uuid}_${safeName}`;\n\n            const { error: uploadError } = await supabase.storage\n              .from(\"assets\")\n              .upload(filePath, file, { contentType: file.type, upsert: false });\n\n            if (uploadError) return null;\n\n            const { data: asset, error: dbError } = await supabase\n              .from(\"assets\")\n              .insert({\n                user_id: user.id,\n                filename: file.name,\n                file_path: filePath,\n                file_type: \"image\",\n                mime_type: file.type,\n                file_size: file.size,\n                tags: [\"dancing-reel\", \"portrait\"],\n                metadata: {},\n              })\n              .select(\"id\")\n              .single();\n\n            if (dbError) {\n              await supabase.storage.from(\"assets\").remove([filePath]);\n              return null;\n            }\n\n            const { data: urlData } = await supabase.storage\n              .from(\"assets\")\n              .createSignedUrl(filePath, 3600);\n\n            if (!urlData?.signedUrl) return null;\n            return { id: asset.id, url: urlData.signedUrl };\n          } catch {\n            return null;\n          }\n        })\n      );\n\n      for (const result of batchResults) {\n        if (result) {\n          uploadedImages.push(result);\n        } else {\n          failedCount++;\n        }\n      }\n    }\n\n    if (uploadedImages.length > 0) {\n      setBulkImagePool((prev) => [...prev, ...uploadedImages]);\n      toast.success(`${uploadedImages.length} image${uploadedImages.length === 1 ? \"\" : \"s\"} uploaded to pool`);\n      if (failedCount > 0) {\n        toast.error(`${failedCount} image${failedCount === 1 ? \"\" : \"s\"} failed to upload`);\n      }\n    } else {\n      toast.error(\"Failed to upload images\");\n    }\n\n    setBulkUploading(false);\n  };\n\n  const handleBulkFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files && files.length > 0) {\n      await uploadBulkImages(files);\n    }\n    if (bulkFileInputRef.current) bulkFileInputRef.current.value = \"\";\n  };\n\n  const handleBulkDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!running) setBulkDragOver(true);\n  };\n\n  const handleBulkDragLeave = () => {\n    setBulkDragOver(false);\n  };\n\n  const handleBulkDrop = async (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setBulkDragOver(false);\n    if (running) return;\n\n    const files = e.dataTransfer.files;\n    if (!files || files.length === 0) return;\n\n    const imageFiles = Array.from(files).filter((f) => f.type.startsWith(\"image/\"));\n    if (imageFiles.length === 0) {\n      toast.error(\"Only image files are supported\");\n      return;\n    }\n\n    await uploadBulkImages(imageFiles);\n  };\n\n  const removeBulkImage = (id: string) => {\n    setBulkImagePool((prev) => prev.filter((img) => img.id !== id));\n  };\n\n  const clearBulkPool = () => {\n    setBulkImagePool([]);\n  };\n\n  const assignPoolImages = () => {\n    const emptyJobs = jobs.filter((j) => j.status === \"pending\" && !j.imageId && !j.imageUrl);\n    if (emptyJobs.length === 0 || bulkImagePool.length === 0) return { assignedCount: 0 };\n\n    const available = [...bulkImagePool].sort(() => Math.random() - 0.5);\n    const assignCount = Math.min(emptyJobs.length, available.length);\n\n    const updatedJobs: Array<{ id: string; imageId: string; imageUrl: string }> = [];\n    for (let i = 0; i < assignCount; i++) {\n      updatedJobs.push({ id: emptyJobs[i].id, imageId: available[i].id, imageUrl: available[i].url });\n    }\n    setJobs((prev) =>\n      prev.map((j) => {\n        const update = updatedJobs.find((u) => u.id === j.id);\n        return update ? { ...j, imageId: update.imageId, imageUrl: update.imageUrl } : j;\n      })\n    );\n\n    return { assignedCount: assignCount };\n  };\n\n  // ---- Processing ----\n\n  const pollJob = useCallback(async (jobId: string, taskId: string) => {\n    pollingRefs.current.set(jobId, true);\n    let attempts = 0;\n    let consecutiveErrors = 0;\n\n    while (pollingRefs.current.get(jobId) && attempts < MAX_POLL_ATTEMPTS) {\n      attempts++;\n      updateJob(jobId, { pollCount: attempts });\n\n      try {\n        const res = await fetch(`/api/talking-head/status?taskId=${encodeURIComponent(taskId)}`);\n        const data = await res.json();\n\n        if (data.status === \"completed\" && data.videoUrl) {\n          pollingRefs.current.set(jobId, false);\n          updateJob(jobId, { status: \"completed\", videoUrl: data.videoUrl });\n          return;\n        }\n\n        if (data.status === \"failed\") {\n          pollingRefs.current.set(jobId, false);\n          updateJob(jobId, { status: \"failed\", error: data.error || \"Video generation failed\" });\n          return;\n        }\n\n        consecutiveErrors = 0;\n        await new Promise((r) => setTimeout(r, POLL_INTERVAL_MS));\n      } catch (err) {\n        consecutiveErrors++;\n        console.warn(`Poll error for dancing job ${jobId} (attempt ${attempts}):`, err);\n\n        if (consecutiveErrors >= 3) {\n          pollingRefs.current.set(jobId, false);\n          updateJob(jobId, { status: \"failed\", error: \"Network error after multiple retries\" });\n          return;\n        }\n\n        await new Promise((r) => setTimeout(r, POLL_INTERVAL_MS));\n      }\n    }\n\n    if (pollingRefs.current.get(jobId)) {\n      pollingRefs.current.set(jobId, false);\n      updateJob(jobId, { status: \"failed\", error: `Timed out after ${attempts} polls (~${Math.round(attempts * POLL_INTERVAL_MS / 1000)}s)` });\n    }\n  }, []);\n\n  const processJob = useCallback(\n    async (job: DancingJob) => {\n      updateJob(job.id, { status: \"submitting\" });\n      try {\n        const res = await fetch(\"/api/dancing-reel/submit\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            imageUrl: job.imageUrl,\n            prompt: prompt.trim(),\n            duration,\n          }),\n        });\n\n        const data = await res.json();\n        if (!res.ok) {\n          updateJob(job.id, { status: \"failed\", error: data.error || \"Submit failed\" });\n          return;\n        }\n\n        updateJob(job.id, { status: \"polling\", taskId: data.taskId, pollCount: 0 });\n        pollJob(job.id, data.taskId);\n      } catch (err) {\n        updateJob(job.id, { status: \"failed\", error: err instanceof Error ? err.message : \"Processing failed\" });\n      }\n    },\n    [prompt, duration, pollJob]\n  );\n\n  const handleRunAll = async () => {\n    if (!prompt.trim()) {\n      toast.error(\"Enter a prompt first\");\n      return;\n    }\n\n    // Auto-assign pool images to jobs that need them\n    const emptyJobs = jobs.filter((j) => j.status === \"pending\" && !j.imageId && !j.imageUrl);\n    if (emptyJobs.length > 0) {\n      if (bulkImagePool.length < emptyJobs.length) {\n        toast.error(`Not enough images. Need ${emptyJobs.length} more, have ${bulkImagePool.length} in pool. Add more images or remove jobs.`);\n        return;\n      }\n      assignPoolImages();\n      await new Promise((resolve) => setTimeout(resolve, 50));\n    }\n\n    const validJobs = jobs.filter((j) => j.status === \"pending\" && j.imageId && j.imageUrl);\n    if (validJobs.length === 0) {\n      toast.error(\"No valid jobs to process. Each needs an image.\");\n      return;\n    }\n\n    setRunning(true);\n    toast.info(`Starting ${validJobs.length} dancing reel generation${validJobs.length > 1 ? \"s\" : \"\"}...`);\n\n    for (const job of validJobs) {\n      processJob(job);\n    }\n  };\n\n  const handleSaveVideo = async (jobId: string, videoUrl: string) => {\n    try {\n      const res = await fetch(\"/api/dancing-reel/save\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ videoUrl }),\n      });\n      const data = await res.json();\n      if (res.ok) {\n        updateJob(jobId, { videoAssetId: data.assetId });\n        toast.success(\"Video saved to library!\");\n      } else {\n        toast.error(data.error || \"Failed to save\");\n      }\n    } catch {\n      toast.error(\"Failed to save video\");\n    }\n  };\n\n  const completedCount = jobs.filter((j) => j.status === \"completed\").length;\n  const failedCount = jobs.filter((j) => j.status === \"failed\").length;\n  const processingCount = jobs.filter((j) => j.status === \"submitting\" || j.status === \"polling\").length;\n  const allDone = running && processingCount === 0;\n  const emptyJobsCount = jobs.filter((j) => j.status === \"pending\" && !j.imageId && !j.imageUrl).length;\n  const canRun = !running && prompt.trim() && jobs.some((j) => j.imageId || bulkImagePool.length >= emptyJobsCount);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Step 1: Prompt & Settings */}\n      <StepSection\n        step={1}\n        title=\"Prompt & Duration\"\n        description=\"Set the dance prompt and video duration. These settings apply to all videos in this batch.\"\n      >\n        <div className=\"space-y-3\">\n          <div className=\"space-y-1.5\">\n            <Label>Dance Prompt</Label>\n            <Textarea\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              placeholder=\"Describe the dancing motion...\"\n              rows={4}\n              className=\"resize-y text-sm\"\n              disabled={running}\n            />\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs text-muted-foreground\">\n                {prompt.trim().split(/\\s+/).filter(Boolean).length} words\n              </span>\n              {prompt !== DEFAULT_PROMPT && (\n                <button\n                  type=\"button\"\n                  onClick={() => setPrompt(DEFAULT_PROMPT)}\n                  className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n                  disabled={running}\n                >\n                  Reset to default\n                </button>\n              )}\n            </div>\n          </div>\n\n          <div className=\"space-y-1.5\">\n            <Label>Duration</Label>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={duration === 5 ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setDuration(5)}\n                disabled={running}\n                className=\"flex-1\"\n              >\n                <Clock className=\"h-3.5 w-3.5 mr-1.5\" />\n                5 seconds (~$0.35/video)\n              </Button>\n              <Button\n                variant={duration === 10 ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setDuration(10)}\n                disabled={running}\n                className=\"flex-1\"\n              >\n                <Clock className=\"h-3.5 w-3.5 mr-1.5\" />\n                10 seconds (~$0.70/video)\n              </Button>\n            </div>\n          </div>\n        </div>\n      </StepSection>\n\n      {/* Step 2: Upload Images */}\n      <StepSection\n        step={2}\n        title=\"Upload Images\"\n        description=\"Upload portrait images for your dancing reels. Images are randomly assigned to jobs that don't have a manually selected image.\"\n      >\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-base\">Bulk Image Pool</Label>\n            {bulkImagePool.length > 0 && (\n              <button\n                type=\"button\"\n                onClick={clearBulkPool}\n                className=\"text-xs text-muted-foreground hover:text-destructive transition-colors\"\n              >\n                Clear All\n              </button>\n            )}\n          </div>\n\n          <div\n            onDragOver={handleBulkDragOver}\n            onDragLeave={handleBulkDragLeave}\n            onDrop={handleBulkDrop}\n            onClick={() => !running && !bulkUploading && bulkFileInputRef.current?.click()}\n            className={cn(\n              \"border-2 border-dashed rounded-lg p-4 transition-all cursor-pointer\",\n              bulkDragOver ? \"border-accent-blue bg-accent-blue/5\" : \"hover:border-accent-blue/50\",\n              running ? \"opacity-50 pointer-events-none\" : \"\"\n            )}\n          >\n            <input\n              ref={bulkFileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              multiple\n              onChange={handleBulkFileSelect}\n              className=\"hidden\"\n            />\n\n            {bulkImagePool.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center gap-2 text-muted-foreground\">\n                {bulkUploading ? (\n                  <>\n                    <Loader2 className=\"h-8 w-8 animate-spin\" />\n                    <p className=\"text-sm\">Uploading images...</p>\n                  </>\n                ) : (\n                  <>\n                    <Upload className=\"h-8 w-8\" />\n                    <p className=\"text-sm\">Drop images here or click to browse</p>\n                  </>\n                )}\n              </div>\n            ) : (\n              <div className=\"space-y-2\" onClick={(e) => e.stopPropagation()}>\n                <p className=\"text-xs text-muted-foreground\">\n                  {bulkImagePool.length} image{bulkImagePool.length === 1 ? \"\" : \"s\"} in pool (randomly assigned to videos without images)\n                </p>\n                <div className=\"flex gap-2 overflow-x-auto pb-1\">\n                  {bulkImagePool.map((img) => (\n                    <div key={img.id} className=\"relative group flex-shrink-0\">\n                      <img src={img.url} alt=\"\" className=\"h-16 w-16 rounded-md object-cover border\" />\n                      <button\n                        type=\"button\"\n                        onClick={() => removeBulkImage(img.id)}\n                        className=\"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                      >\n                        <X className=\"h-3 w-3\" />\n                      </button>\n                    </div>\n                  ))}\n                </div>\n                <div\n                  onClick={() => bulkFileInputRef.current?.click()}\n                  className=\"border border-dashed rounded-md px-3 py-1 text-xs text-muted-foreground hover:text-accent-blue cursor-pointer inline-flex items-center gap-1 w-fit\"\n                >\n                  <Plus className=\"h-3 w-3\" /> Add more\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </StepSection>\n\n      {/* Step 3: Jobs */}\n      <StepSection\n        step={3}\n        title=\"Videos\"\n        description=\"Each row becomes a separate dancing reel. Add more rows for more videos. You can manually assign images or let the pool handle it.\"\n      >\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-base\">Videos ({jobs.length})</Label>\n            <Button variant=\"outline\" size=\"sm\" onClick={addJob} disabled={running}>\n              <Plus className=\"h-4 w-4 mr-1.5\" />\n              Add Video\n            </Button>\n          </div>\n\n          {jobs.map((job, idx) => (\n            <div\n              key={job.id}\n              className={cn(\n                \"rounded-lg border p-4 space-y-3\",\n                job.status === \"completed\" && \"border-green-500 bg-green-500/5\",\n                job.status === \"failed\" && \"border-destructive bg-destructive/5\",\n                job.status === \"pending\" && \"border-border\"\n              )}\n            >\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Video {idx + 1}</span>\n                <div className=\"flex items-center gap-2\">\n                  <JobStatusBadge status={job.status} pollCount={job.pollCount} />\n                  {!running && jobs.length > 1 && (\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => removeJob(job.id)} className=\"h-7 w-7 p-0\">\n                      <Trash2 className=\"h-3.5 w-3.5\" />\n                    </Button>\n                  )}\n                </div>\n              </div>\n\n              {job.status === \"pending\" && (\n                <div\n                  className=\"flex items-center gap-3\"\n                  onDragOver={(e) => handleDragOver(e, job.id)}\n                  onDragLeave={handleDragLeave}\n                  onDrop={(e) => handleDrop(e, job.id)}\n                >\n                  <div className=\"space-y-1.5\">\n                    <Label className=\"text-xs\">Image</Label>\n                    {job.imageUrl ? (\n                      <div className=\"relative group\">\n                        <img\n                          src={job.imageUrl}\n                          alt=\"Selected\"\n                          className={cn(\n                            \"h-[80px] w-[45px] rounded-md object-cover border cursor-pointer\",\n                            dragOverJobId === job.id ? \"ring-2 ring-accent-blue ring-offset-2\" : \"\"\n                          )}\n                          onClick={() => !running && setPickerJobId(job.id)}\n                        />\n                        {!running && (\n                          <button\n                            type=\"button\"\n                            onClick={() => updateJob(job.id, { imageId: null, imageUrl: null })}\n                            className=\"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </button>\n                        )}\n                      </div>\n                    ) : (\n                      <button\n                        type=\"button\"\n                        onClick={() => setPickerJobId(job.id)}\n                        disabled={running}\n                        className={cn(\n                          \"h-[80px] w-[45px] rounded-md border-2 border-dashed flex flex-col items-center justify-center gap-1 text-muted-foreground transition-colors\",\n                          dragOverJobId === job.id ? \"border-accent-blue bg-accent-blue/10\" : \"hover:border-accent-blue/50 hover:text-accent-blue\"\n                        )}\n                      >\n                        <ImageIcon className=\"h-4 w-4\" />\n                        <span className=\"text-[9px]\">\n                          {dragOverJobId === job.id ? \"Drop\" : \"Select\"}\n                        </span>\n                      </button>\n                    )}\n                  </div>\n\n                  <div className=\"flex-1 text-sm text-muted-foreground\">\n                    {job.imageId ? (\n                      <Badge variant=\"secondary\" className=\"gap-1 text-xs\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Image ready\n                      </Badge>\n                    ) : (\n                      <span className=\"text-xs\">No image â€” will use pool</span>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {job.status !== \"pending\" && job.status !== \"completed\" && job.status !== \"failed\" && (\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Loader2 className=\"h-3.5 w-3.5 animate-spin text-accent-blue\" />\n                    <span className=\"text-xs\">\n                      {job.status === \"submitting\" && \"Submitting to Kling 2.6 Pro...\"}\n                      {job.status === \"polling\" && `Generating video... ${Math.round((job.pollCount || 0) * 5)}s`}\n                    </span>\n                  </div>\n                  {job.status === \"polling\" && (\n                    <Progress value={Math.min(((job.pollCount || 0) / MAX_POLL_ATTEMPTS) * 100, 95)} className=\"h-1.5\" />\n                  )}\n                </div>\n              )}\n\n              {job.status === \"failed\" && job.error && (\n                <p className=\"text-xs text-destructive\">{job.error}</p>\n              )}\n\n              {job.status === \"completed\" && job.videoUrl && (\n                <div className=\"space-y-2\">\n                  <video\n                    controls\n                    src={job.videoUrl}\n                    className=\"w-full max-h-[200px] rounded-md bg-black\"\n                    preload=\"metadata\"\n                  />\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        const a = document.createElement(\"a\");\n                        a.href = job.videoUrl!;\n                        a.download = `dancing-reel-${idx + 1}.mp4`;\n                        a.target = \"_blank\";\n                        a.click();\n                      }}\n                    >\n                      <Download className=\"h-3.5 w-3.5 mr-1\" />\n                      Download\n                    </Button>\n                    {job.videoAssetId ? (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Saved\n                      </Badge>\n                    ) : (\n                      <Button size=\"sm\" onClick={() => handleSaveVideo(job.id, job.videoUrl!)}>\n                        <Save className=\"h-3.5 w-3.5 mr-1\" />\n                        Save to Library\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </StepSection>\n\n      {/* Status summary */}\n      {running && (\n        <div className=\"flex items-center gap-3 text-sm\">\n          {processingCount > 0 && (\n            <Badge variant=\"secondary\">\n              <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n              {processingCount} processing\n            </Badge>\n          )}\n          {completedCount > 0 && (\n            <Badge variant=\"secondary\" className=\"text-green-600\">\n              <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n              {completedCount} completed\n            </Badge>\n          )}\n          {failedCount > 0 && (\n            <Badge variant=\"destructive\">\n              <AlertCircle className=\"h-3 w-3 mr-1\" />\n              {failedCount} failed\n            </Badge>\n          )}\n        </div>\n      )}\n\n      {/* Run button */}\n      <div className=\"flex gap-2\">\n        <Button onClick={handleRunAll} disabled={!canRun} size=\"lg\" className=\"flex-1\">\n          <Music className=\"h-4 w-4 mr-2\" />\n          {running\n            ? allDone\n              ? \"All Done\"\n              : `Processing ${processingCount} video${processingCount !== 1 ? \"s\" : \"\"}...`\n            : `Generate ${jobs.filter((j) => j.imageId || bulkImagePool.length).length} Dancing Reel${jobs.length > 1 ? \"s\" : \"\"} (${duration}s each)`}\n        </Button>\n\n        {allDone && (\n          <Button\n            variant=\"outline\"\n            size=\"lg\"\n            onClick={() => {\n              setRunning(false);\n              setJobs([{ id: crypto.randomUUID(), imageId: null, imageUrl: null, status: \"pending\" }]);\n            }}\n          >\n            Start New Batch\n          </Button>\n        )}\n      </div>\n\n      {/* Image Picker Dialog */}\n      <Dialog open={pickerJobId !== null} onOpenChange={(open) => !open && setPickerJobId(null)}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Select Image</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"flex items-center gap-2\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input placeholder=\"Search images...\" value={pickerSearch} onChange={(e) => handlePickerSearch(e.target.value)} className=\"pl-9\" />\n            </div>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handlePickerUpload}\n              className=\"hidden\"\n            />\n            <Button variant=\"outline\" size=\"sm\" onClick={() => fileInputRef.current?.click()} disabled={uploading}>\n              {uploading ? (\n                <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\n              ) : (\n                <Upload className=\"h-4 w-4 mr-1\" />\n              )}\n              Upload\n            </Button>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto min-h-0\">\n            {pickerImages.length === 0 && !pickerLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <p className=\"text-sm text-muted-foreground\">No images found.</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-4 sm:grid-cols-5 gap-2 pb-2\">\n                {pickerImages.map((image) => (\n                  <button\n                    key={image.id}\n                    type=\"button\"\n                    className=\"relative aspect-[9/16] overflow-hidden rounded-md border-2 border-transparent hover:border-accent-blue/50 transition-all\"\n                    onClick={() => handlePickerSelect(image)}\n                  >\n                    <img src={image.signed_url} alt={image.filename} className=\"h-full w-full object-cover\" loading=\"lazy\" />\n                  </button>\n                ))}\n              </div>\n            )}\n\n            {pickerImages.length < pickerTotal && (\n              <div className=\"flex justify-center py-2\">\n                <Button variant=\"outline\" size=\"sm\" onClick={() => fetchPickerImages(true)} disabled={pickerLoading}>\n                  {pickerLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Load More\"}\n                </Button>\n              </div>\n            )}\n          </div>\n\n          {pickerJobId && (\n            <p className=\"text-xs text-muted-foreground\">\n              Click an image to select it for this video. Uploaded images are auto-saved to your asset library.\n            </p>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nfunction JobStatusBadge({ status, pollCount }: { status: DancingJob[\"status\"]; pollCount?: number }) {\n  switch (status) {\n    case \"pending\":\n      return <Badge variant=\"outline\" className=\"text-xs\">Pending</Badge>;\n    case \"submitting\":\n      return (\n        <Badge variant=\"secondary\" className=\"text-xs gap-1\">\n          <Loader2 className=\"h-3 w-3 animate-spin\" />\n          Submitting\n        </Badge>\n      );\n    case \"polling\":\n      return (\n        <Badge variant=\"secondary\" className=\"text-xs gap-1\">\n          <Loader2 className=\"h-3 w-3 animate-spin\" />\n          {Math.round((pollCount || 0) * 5)}s\n        </Badge>\n      );\n    case \"completed\":\n      return (\n        <Badge variant=\"secondary\" className=\"text-xs gap-1 text-green-600\">\n          <CheckCircle2 className=\"h-3 w-3\" />\n          Done\n        </Badge>\n      );\n    case \"failed\":\n      return (\n        <Badge variant=\"destructive\" className=\"text-xs gap-1\">\n          <AlertCircle className=\"h-3 w-3\" />\n          Failed\n        </Badge>\n      );\n  }\n}\n"],"names":[],"mappings":"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"}