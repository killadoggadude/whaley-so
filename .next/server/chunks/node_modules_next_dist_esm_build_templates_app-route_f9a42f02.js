module.exports=[88241,e=>{"use strict";var t=e.i(47909),o=e.i(74017),r=e.i(96250),i=e.i(59756),a=e.i(61916),n=e.i(74677),l=e.i(69741),s=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),p=e.i(66012),g=e.i(70101),h=e.i(26937),f=e.i(10372),m=e.i(93695);e.i(52474);var w=e.i(5232),F=e.i(89171),C=e.i(26500),y=e.i(33405),v=e.i(24868),b=e.i(14747),x=e.i(46786);let R=[{id:"classic-tiktok",name:"Classic TikTok",settings:{fontFamily:"Impact",fontSize:60,textColor:"#FFFFFF",highlightColor:"#FFFF00",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:3,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-yellow-400"},{id:"capcut-pop",name:"CapCut Pop",settings:{fontFamily:"Arial",fontSize:64,textColor:"#FFFFFF",highlightColor:"#00D9FF",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:4,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-cyan-400"},{id:"neon-highlight",name:"Neon Highlight",settings:{fontFamily:"Arial",fontSize:58,textColor:"#FFFFFF",highlightColor:"#39FF14",backgroundColor:"",backgroundOpacity:60,outlineColor:"#00FF00",outlineWidth:2,bold:!0,italic:!1,wordsPerPage:3,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-lime-400"},{id:"bold-minimal",name:"Bold Minimal",settings:{fontFamily:"Arial",fontSize:56,textColor:"#FFFFFF",highlightColor:"#FFFFFF",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:1,bold:!0,italic:!1,wordsPerPage:3,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-white"},{id:"warm-viral",name:"Warm Viral",settings:{fontFamily:"Arial",fontSize:62,textColor:"#FFFFFF",highlightColor:"#FF6B35",backgroundColor:"",backgroundOpacity:60,outlineColor:"#4A2C2A",outlineWidth:3,bold:!0,italic:!1,wordsPerPage:2,position:"center",verticalPosition:50},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-orange-500"},{id:"clean-subtitle",name:"Clean Subtitle",settings:{fontFamily:"Arial",fontSize:52,textColor:"#FFFFFF",highlightColor:"#87CEEB",backgroundColor:"",backgroundOpacity:60,outlineColor:"#000000",outlineWidth:2,bold:!1,italic:!1,wordsPerPage:3,position:"bottom",verticalPosition:70},previewBg:"bg-black",previewText:"text-white",previewHighlight:"text-sky-400"}].map(e=>S(e.id,e.name,e.settings,e.previewBg,e.previewText,e.previewHighlight));function k(e,t=0){let o=e.replace("#","");if(6!==o.length)return"&H00FFFFFF";let r=o.substring(0,2),i=o.substring(2,4),a=o.substring(4,6),n=Math.round(t/100*255).toString(16).padStart(2,"0").toUpperCase();return`&H${n}${a}${i}${r}`.toUpperCase()}function S(e,t,o,r="bg-black",i="text-white",a="text-yellow-400"){let n=Math.round((1-o.verticalPosition/100)*1920),l=o.verticalPosition<=33?8:o.verticalPosition<=66?5:2;return{id:e,name:t,fontFamily:o.fontFamily,fontSize:o.fontSize,primaryColor:k(o.textColor),highlightColor:k(o.highlightColor),outlineColor:k(o.outlineColor),shadowColor:o.backgroundColor?k(o.backgroundColor,100-o.backgroundOpacity):k("#000000",80),backgroundColor:o.backgroundColor?k(o.backgroundColor,100-o.backgroundOpacity):"",outlineWidth:o.outlineWidth,shadowDepth:2*!o.backgroundColor,bold:o.bold,italic:o.italic,alignment:l,marginV:n,wordsPerPage:o.wordsPerPage,previewBg:r,previewText:i,previewHighlight:a}}function P(e){let t=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60),i=Math.round(e%1*100);return`${t}:${String(o).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(i).padStart(2,"0")}`}function $(e,t){if(0===e.length)return"";let o="id"in t?t:S("custom","Custom",t),r=o.backgroundColor&&""!==o.backgroundColor,i=r?o.backgroundColor:o.shadowColor,a=`[Script Info]
Title: Captions
ScriptType: v4.00+
PlayResX: 1080
PlayResY: 1920
WrapStyle: 0
ScaledBorderAndShadow: yes

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,${o.fontFamily},${o.fontSize},${o.primaryColor},${o.highlightColor},${o.outlineColor},${i},${o.bold?-1:0},${o.italic?-1:0},0,0,100,100,0,0,${r?3:1},${o.outlineWidth},${o.shadowDepth},${o.alignment},40,40,${o.marginV},1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text`,n=[];for(let t=0;t<e.length;t+=o.wordsPerPage)n.push(e.slice(t,t+o.wordsPerPage));let l=[];for(let e of n){if(0===e.length)continue;let t=e[e.length-1].end;for(let r=0;r<e.length;r++){let i=e[r].start,a=r<e.length-1?e[r+1].start:t,n=e.map((e,t)=>t===r?`{\\c${o.highlightColor}}${e.word}{\\c${o.primaryColor}}`:e.word).join(" ");l.push(`Dialogue: 0,${P(i)},${P(a)},Default,,0,0,0,,${n}`)}}return`${a}
${l.join("\n")}
`}async function E(){let t=[(0,b.join)(process.cwd(),"node_modules","ffmpeg-static","ffmpeg"),(0,b.join)(process.cwd(),"..","node_modules","ffmpeg-static","ffmpeg"),"/usr/local/bin/ffmpeg","/usr/bin/ffmpeg","ffmpeg"];for(let e of t)try{return await (0,v.access)(e),e}catch{}try{let t=e.r(9e3);if(t)return t}catch{}throw Error("FFmpeg binary not found. Searched: "+t.join(", "))}async function A(t){let o=null;try{var r,i,a,n,l;let s=await (0,C.createClient)(),{data:{user:d}}=await s.auth.getUser();if(!d)return F.NextResponse.json({error:"Unauthorized"},{status:401});let{videoUrl:c,words:u,customSettings:p,styleId:g}=await t.json();if(!c)return F.NextResponse.json({error:"videoUrl is required"},{status:400});if(!u||!Array.isArray(u)||0===u.length)return F.NextResponse.json({error:"words array with timestamps is required"},{status:400});if(!p&&!g)return F.NextResponse.json({error:"Either customSettings or styleId is required"},{status:400});o=await (0,v.mkdtemp)((0,b.join)((0,x.tmpdir)(),"caption-"));let h=(0,b.join)(o,"input.mp4"),f=(0,b.join)(o,"subs.ass"),m=(0,b.join)(o,"output.mp4"),w=(0,b.join)(o,"fonts"),k=(0,b.join)(process.cwd(),"fonts");try{let{mkdir:t}=await e.A(60815);await t(w,{recursive:!0});let o=await (0,v.readdir)(k);for(let e of o)(e.endsWith(".ttf")||e.endsWith(".otf"))&&await (0,v.copyFile)((0,b.join)(k,e),(0,b.join)(w,e));console.log(`Copied ${o.length} font files to ${w}`)}catch(e){console.warn("Could not copy fonts to temp dir:",e)}let S=await fetch(c);if(!S.ok)return F.NextResponse.json({error:`Failed to download video: ${S.status}`},{status:500});let P=Buffer.from(await S.arrayBuffer());await (0,v.writeFile)(h,P);let A=p?$(u,p):$(u,R.find(e=>e.id===g)||R[0]);if(!A)return F.NextResponse.json({error:"Failed to generate subtitle content"},{status:500});A=A.replace(/^(Style: Default,)[^,]+(,.*)$/m,"$1Liberation Sans$2"),await (0,v.writeFile)(f,A,"utf-8");let T=await E();await (r=T,i=h,a=f,n=m,l=w,new Promise((e,t)=>{let o=a.replace(/\\/g,"/").replace(/:/g,"\\:"),s=l?l.replace(/\\/g,"/").replace(/:/g,"\\:"):null,d=["-i",i,"-c:v","libx264","-vf",s?`ass='${o}':fontsdir='${s}'`:`ass='${o}'`,"-c:a","copy","-map_metadata","-1","-metadata","com.apple.quicktime.make=Apple","-metadata","com.apple.quicktime.model=iPhone 14","-metadata","com.apple.quicktime.software=17.4.1","-metadata","com.apple.quicktime.creationdate="+new Date().toISOString(),"-metadata","encoder=Apple iPhone 14","-metadata","creation_time="+new Date().toISOString(),"-y",n];console.log("Running FFmpeg:",r,d.join(" ")),(0,y.execFile)(r,d,{timeout:24e4},(o,r,i)=>{o?(console.error("FFmpeg error:",o.message),console.error("FFmpeg stderr:",i),t(Error(`FFmpeg failed: ${o.message}`))):e()})}));let N=await (0,v.readFile)(m),j=crypto.randomUUID(),O=`talking-head-captioned_${j.slice(0,8)}.mp4`,_=`${d.id}/video/${j}_${O}`,{error:H}=await s.storage.from("assets").upload(_,N,{contentType:"video/mp4",upsert:!1});if(H)return F.NextResponse.json({error:`Storage upload failed: ${H.message}`},{status:500});let{data:U,error:D}=await s.from("assets").insert({user_id:d.id,filename:O,file_path:_,file_type:"video",mime_type:"video/mp4",file_size:N.byteLength,tags:["talking-head","captioned","lip-sync"],metadata:{source:"caption-generator",caption_style:p?"custom":g,word_count:u.length}}).select("id").single();if(D)return await s.storage.from("assets").remove([_]),F.NextResponse.json({error:`Database error: ${D.message}`},{status:500});let{data:M}=await s.storage.from("assets").createSignedUrl(_,3600);return F.NextResponse.json({assetId:U.id,signedUrl:M?.signedUrl||null},{status:201})}catch(e){return console.error("Add captions error:",e),F.NextResponse.json({error:e instanceof Error?e.message:"Failed to add captions"},{status:500})}finally{if(o)try{for(let e of["input.mp4","subs.ass","output.mp4"])try{await (0,v.unlink)((0,b.join)(o,e))}catch{}let t=(0,b.join)(o,"fonts");try{for(let e of(await (0,v.readdir)(t)))try{await (0,v.unlink)((0,b.join)(t,e))}catch{}let{rmdir:o}=await e.A(60815);await o(t)}catch{}let{rmdir:r}=await e.A(60815);await r(o)}catch{}}}e.s(["POST",()=>A,"maxDuration",0,300],92324);var T=e.i(92324);let N=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/talking-head/add-captions/route",pathname:"/api/talking-head/add-captions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/talking-head/add-captions/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:j,workUnitAsyncStorage:O,serverHooks:_}=N;function H(){return(0,r.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:O})}async function U(e,t,r){N.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let F="/api/talking-head/add-captions/route";F=F.replace(/\/index$/,"")||"/";let C=await N.prepare(e,t,{srcPage:F,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:v,nextConfig:b,parsedUrl:x,isDraftMode:R,prerenderManifest:k,routerServerContext:S,isOnDemandRevalidate:P,revalidateOnlyGenerated:$,resolvedPathname:E,clientReferenceManifest:A,serverActionsManifest:T}=C,j=(0,l.normalizeAppPath)(F),O=!!(k.dynamicRoutes[j]||k.routes[E]),_=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,x,!1):t.end("This page could not be found"),null);if(O&&!R){let e=!!k.routes[E],t=k.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await _();throw new m.NoFallbackError}}let H=null;!O||N.isDev||R||(H="/index"===(H=E)?"/":H);let U=!0===N.isDev||!O,D=O&&!U;T&&A&&(0,n.setManifestsSingleton)({page:F,clientReferenceManifest:A,serverActionsManifest:T});let M=e.method||"GET",I=(0,a.getTracer)(),q=I.getActiveScopeSpan(),B={params:v,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r,i)=>N.onRequestError(e,t,r,i,S)},sharedContext:{buildId:y}},W=new s.NodeNextRequest(e),z=new s.NodeNextResponse(t),L=d.NextRequestAdapter.fromNodeNextRequest(W,(0,d.signalFromNodeResponse)(t));try{let n=async e=>N.handle(L,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=I.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${M} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${F}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var a,s;let d=async({previousCacheEntry:o})=>{try{if(!l&&P&&$&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=B.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)(W,z,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,S),t}},c=await N.handleResponse({req:e,nextConfig:b,cacheKey:H,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:$,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!O)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(s=c.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&O||m.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(W,z,new Response(c.value.body,{headers:m,status:c.value.status||200})),null};q?await s(q):await I.withPropagatedContext(e.headers,()=>I.trace(c.BaseServerSpan.handleRequest,{spanName:`${M} ${F}`,kind:a.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},s))}catch(t){if(t instanceof m.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,S),O)throw t;return await (0,p.sendResponse)(W,z,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>H,"routeModule",()=>N,"serverHooks",()=>_,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>O],88241)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_f9a42f02.js.map